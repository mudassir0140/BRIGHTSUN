(function(g){var window=this;'use strict';var jix=function(x){var S=new g.Qb("und",new g.Kp("Default","und",!0));S.captionTracks=x.captionTracks;return S},ZMt=function(x){return new g.Va(function(S,Z){var k=x.length,e=[];
if(k)for(var u=function(J,X){k--;e[J]=X;k==0&&S(e)},C=function(J){Z(J)},L,c=0;c<x.length;c++)L=x[c],g.mrR(L,g.ah(u,c),C);
else S(e)})},m2=function(x){this.S=x},oV=function(){m2.apply(this,arguments)},kiH=function(){oV.apply(this,arguments)},ezH=function(){oV.apply(this,arguments)},us9=function(){oV.apply(this,arguments)},CuH=function(){oV.apply(this,arguments)},tMv=function(){oV.apply(this,arguments)},Ljx=function(){oV.apply(this,arguments)},csJ=function(){oV.apply(this,arguments)},Jst=function(){m2.apply(this,arguments)},X_9=function(){oV.apply(this,arguments)},alb=function(){oV.apply(this,arguments)},Fjt=function(){oV.apply(this,
arguments)},qn$=function(){oV.apply(this,arguments)},dMm=function(){oV.apply(this,arguments)},zz$=function(){oV.apply(this,arguments)},TUx=function(){oV.apply(this,arguments)},Puh=function(){oV.apply(this,arguments)},vL9=function(){oV.apply(this,arguments)},Wjs=function(){oV.apply(this,arguments)},YnR=function(){oV.apply(this,arguments)},Ilt=function(){oV.apply(this,arguments)},NUx=function(){m2.apply(this,arguments)},rsH=function(){oV.apply(this,arguments)},iMb=function(){oV.apply(this,arguments)},
Qin=function(){oV.apply(this,arguments)},siJ=function(){oV.apply(this,arguments)},flt=function(){oV.apply(this,arguments)},ELv=function(){oV.apply(this,arguments)},BUJ=function(){oV.apply(this,arguments)},VMb=function(){oV.apply(this,arguments)},nL$=function(){oV.apply(this,arguments)},KjR=function(){m2.apply(this,arguments)},GiR=function(){m2.apply(this,arguments)},bMJ=function(){m2.apply(this,arguments)},mM$=function(){oV.apply(this,arguments)},oLh=function(){oV.apply(this,arguments)},OMt=function(){oV.apply(this,
arguments)},hzt=function(){oV.apply(this,arguments)},HMm=function(){oV.apply(this,arguments)},UMH=function(){oV.apply(this,arguments)},Asx=function(){oV.apply(this,arguments)},RzH=function(){oV.apply(this,arguments)},w_R=function(){oV.apply(this,arguments)},DMJ=function(){oV.apply(this,arguments)},MMJ=function(){oV.apply(this,arguments)},gLs=function(){oV.apply(this,arguments)},llJ=function(){oV.apply(this,arguments)},ysb=function(){oV.apply(this,arguments)},p_J=function(){oV.apply(this,arguments)},
$MS=function(){oV.apply(this,arguments)},x5J=function(){oV.apply(this,arguments)},SD9=function(){oV.apply(this,arguments)},jLt=function(){oV.apply(this,arguments)},ZW9=function(){oV.apply(this,arguments)},kh9=function(){oV.apply(this,arguments)},eGb=function(){oV.apply(this,arguments)},uit=function(){oV.apply(this,arguments)},CDJ=function(){oV.apply(this,arguments)},trh=function(){oV.apply(this,arguments)},LGR=function(){oV.apply(this,arguments)},ch$=function(){oV.apply(this,arguments)},JhJ=function(){oV.apply(this,
arguments)},Xut=function(){oV.apply(this,arguments)},aab=function(){m2.apply(this,arguments)},FGb=function(){oV.apply(this,arguments)},qD9=function(){oV.apply(this,arguments)},d5H=function(){oV.apply(this,arguments)},zGs=function(){oV.apply(this,arguments)},TOH=function(){oV.apply(this,arguments)},PDR=function(){oV.apply(this,arguments)},v$v=function(){oV.apply(this,arguments)},WG$=function(){oV.apply(this,arguments)},YDs=function(){oV.apply(this,arguments)},Ian=function(){oV.apply(this,arguments)},
NOn=function(){oV.apply(this,arguments)},rhR=function(){oV.apply(this,arguments)},iW9=function(){oV.apply(this,arguments)},QL$=function(){oV.apply(this,arguments)},sLS=function(){oV.apply(this,arguments)},fa$=function(){oV.apply(this,arguments)},E$R=function(){oV.apply(this,arguments)},BOJ=function(){oV.apply(this,arguments)},Vr9=function(){oV.apply(this,arguments)},n$R=function(){oV.apply(this,arguments)},KGm=function(){oV.apply(this,arguments)},GhR=function(){oV.apply(this,arguments)},bWs=function(){oV.apply(this,
arguments)},m5t=function(){oV.apply(this,arguments)},o$x=function(){oV.apply(this,arguments)},OWm=function(){oV.apply(this,arguments)},hGH=function(){oV.apply(this,arguments)},HWm=function(){oV.apply(this,arguments)},U5s=function(){oV.apply(this,arguments)},Aht=function(){oV.apply(this,arguments)},RGx=function(){oV.apply(this,arguments)},wub=function(){oV.apply(this,arguments)},D5x=function(){oV.apply(this,arguments)},MrR=function(){oV.apply(this,arguments)},g$9=function(x){x=x.key||x.id;
if(!x)throw Error("Entity key is missing");return x},la9=function(){if(OW)return OW();
var x={};OW=g.xg("PersistentEntityStoreDb",{P6:(x.EntityStore={hk:1},x.EntityAssociationStore={hk:2},x),shared:!1,upgrade:function(S,Z){Z(1)&&g.Ga(g.fQ(S,"EntityStore",{keyPath:"key"}),"entityType","entityType");Z(2)&&(S=g.fQ(S,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Ga(S,"byParentEntityKey","parentEntityKey"),g.Ga(S,"byChildEntityKey","childEntityKey"))},
version:3});return OW()},yh$=function(x){return g.Ai(la9(),x)},put=function(x){return g.Ai((0,g.QP9)(),x)},hB=function(x){this.token=x},H0=function(x,S){S=S===void 0?{}:S;
g.MG.call(this,g.sPn[x],Object.assign({},{name:"PESEncoderError",type:x},S));this.type=x;this.level="WARNING";Object.setPrototypeOf(this,H0.prototype)},$5J=function(x){return new H0("WRONG_DATA_TYPE",{ze:x})},xTJ=function(x){return x instanceof Error?new H0("UNKNOWN_ENCODE_ERROR",{originalMessage:x.message}):new H0("UNKNOWN_ENCODE_ERROR")},SRm=function(x){return x instanceof Error?new H0("UNKNOWN_DECODE_ERROR",{originalMessage:x.message}):new H0("UNKNOWN_DECODE_ERROR")},jT9=function(x,S){x=x instanceof
H0?x:S(x);
g.BF(x);throw x;},ZRb=function(){},k2H=function(x,S,Z){try{return x.D(S,Z)}catch(k){jT9(k,xTJ)}},en$=function(x){x=(new TextEncoder).encode(x).subarray(0,16);
var S=new Uint8Array(16);S.set(x);return S},UW=function(x){this.S=x},CUn=function(x){var S=uFn[x];
if(S)return S;g.nn(new g.MG("Entity model not found.",{entityType:x}))},tEb=function(x,S){this.S=x;
this.Y=S;this.D={}},czb=function(x,S){a:{x=LXJ(x.Y,S.version);
try{var Z=x.Y(S.data,S.key);break a}catch(k){jT9(k,SRm)}Z=void 0}return Z},AB=function(x,S,Z){return x.S.objectStore("EntityStore").get(S).then(function(k){if(k){if(Z&&k.entityType!==Z)throw Error("Incorrect entity type");
return czb(x,k)}})},RV=function(x,S,Z){return Z?(Z=Z.map(function(k){return AB(x,k,S)}),g.WR.all(Z)):x.S.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(S)).then(function(k){return k.map(function(e){return czb(x,e)})})},D6=function(x,S,Z){var k=g$9(S),e=LXJ(x.Y,1),u=Object.assign({},S);
return x.S.objectStore("EntityStore").get(k).then(function(C){if(C){if(C.entityType!==Z)throw Error("Incorrect entity type");u.entityMetadata||(C=czb(x,C),u.entityMetadata=C.entityMetadata)}}).then(function(){var C={key:k,
entityType:Z,data:k2H(e,u,k),version:1};return g.WR.all([g.V3(x.S.objectStore("EntityStore"),C),Jzh(x,u,Z)])}).then(function(){wf(x,k,Z);
return k})},X39=function(x,S,Z){S=S.map(function(k){return D6(x,k,Z)});
return g.WR.all(S)},M0=function(x,S,Z){if(Z==null?0:Z.B5){var k=new Set;
return aP$(x,S,k).then(function(){for(var u=[],C=g.v(k),L=C.next();!L.done;L=C.next())u.push(M0(x,L.value));return g.WR.all(u).then(function(){})})}var e=g.xl(S).entityType;
return g.WR.all([x.S.objectStore("EntityStore").delete(S),FXn(x,S)]).then(function(){wf(x,S,e)})},qRJ=function(x,S){return g.O_(x.S.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(S)},function(Z){return g.WR.all([Z.delete(),
FXn(x,Z.cursor.primaryKey)]).then(function(){wf(x,Z.cursor.primaryKey,S);return g.mV(Z)})})},dTb=function(x,S,Z,k){var e=LXJ(x.Y,1);
return AB(x,S,k).then(function(u){if(u){u=g.t9(u,Z);var C={key:S,entityType:k,data:k2H(e,u,S),version:1};return g.WR.all([g.V3(x.S.objectStore("EntityStore"),C),Jzh(x,u,k)])}}).then(function(){wf(x,S,k);
return S})},wf=function(x,S,Z){var k=x.D[Z];
k||(k=new Set,x.D[Z]=k);k.add(S)},znm=function(x,S,Z){var k=g$9(S);
Z=CUn(Z);if(!Z)return g.WR.resolve([]);Z=new Z(S);x=x.S.objectStore("EntityAssociationStore");S=[];Z=g.v(Z.Y());for(var e=Z.next();!e.done;e=Z.next())S.push(g.V3(x,{parentEntityKey:k,childEntityKey:e.value}));return g.WR.all(S).then(function(u){return u.map(function(C){return C[1]})})},FXn=function(x,S){return x.S.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(S))},Jzh=function(x,S,Z){var k=g$9(S);
return FXn(x,k).then(function(){return znm(x,S,Z)})},aP$=function(x,S,Z){if(Z.has(S))return g.WR.resolve(void 0);
Z.add(S);return TzJ(x,S).then(function(k){return x.S.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(S)).then(function(){return k})}).then(function(k){var e=g.WR.resolve(void 0);
k=g.v(k);for(var u=k.next(),C={};!u.done;C={NZ:void 0},u=k.next())C.NZ=u.value,e=e.then(function(L){return function(){return aP$(x,L.NZ,Z)}}(C));
return e}).then(function(){})},TzJ=function(x,S){var Z=x.S.objectStore("EntityAssociationStore");
return Z.index("byParentEntityKey").getAll(IDBKeyRange.only(S)).then(function(k){var e=[];k=g.v(k);for(var u=k.next();!u.done;u=k.next())u=u.value,e.push(Z.index("byChildEntityKey").getAll(u.childEntityKey));return g.WR.all(e)}).then(function(k){var e=[];
k=g.v(k);for(var u=k.next();!u.done;u=k.next())u=u.value,u.length===1&&e.push(u[0].childEntityKey);return e})},gf=function(){},PU$=function(){this.S={};
this.S[0]=new gf;if(!g.NS("aes_pes_encoder_killswitch")){var x=this.S;try{var S=g.g3();var Z=en$(S);var k=new UW(new g.qo(Z),new g.dC(Z))}catch(e){throw x=e instanceof Error?new H0("KEY_CREATION_FAILED",{originalMessage:e.message}):new H0("KEY_CREATION_FAILED"),g.BF(x),x;}x[1]=k}},LXJ=function(x,S){S=S===void 0?0:S;
x=x.S[S];if(!x)throw S=new H0("INVALID_ENCODER_VERSION",{ze:S}),g.BF(S),S;return x},la=function(x,S){g.m.call(this);
this.token=x;this.S=S;this.observers=[];x=new g.$b.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.g3());x.onmessage=this.Y.bind(this);this.channel=x},y9=function(x,S,Z){var k,e,u,C;
return g.V(function(L){if(L.S==1)return g.B(L,yh$(x.token),2);if(L.S!=3)return k=L.Y,g.B(L,g.BR(k,["EntityStore","EntityAssociationStore"],S,function(c){e=new tEb(c,x.S);return Z(e)}),3);
u=L.Y;e&&(C=e.D,Object.keys(C).length>0&&(x.channel.postMessage(C),v0R(x,C)));return L.return(u)})},p5=function(x,S,Z){return y9(x,{mode:"readwrite",
tS:!0},function(k){return D6(k,S,Z)})},WXv=function(x,S){return y9(x,{mode:"readwrite",
tS:!0},function(Z){return X39(Z,S,"offlineOrchestrationActionWrapperEntity")})},YRH=function(x,S){return y9(x,{mode:"readwrite",
tS:!0},function(Z){return M0(Z,S)})},IPn=function(x){return y9(x,{mode:"readwrite",
tS:!0},function(S){return qRJ(S,"videoPlaybackPositionEntity")})},$i=function(x,S,Z){return y9(x,{mode:"readonly",
tS:!0},function(k){return AB(k,S,Z)})},xq=function(x,S,Z){return y9(x,{mode:"readonly",
tS:!0},function(k){return RV(k,S,Z)})},v0R=function(x,S){x=g.v(x.observers);
for(var Z=x.next();!Z.done;Z=x.next())Z=Z.value,Z(S)},NzJ=function(){var x,S,Z;
return g.V(function(k){if(k.S==1)return g.Nc(k,2),g.B(k,g.pQ(),4);if(k.S!=2){x=k.Y;if(!x||!g.lk()||typeof g.$b.BroadcastChannel==="undefined")return k.return();S=new PU$;return k.return(new la(x,S))}Z=g.EO(k);Z instanceof Error&&g.BF(Z);return k.return()})},Sc=function(){rzH||(rzH=NzJ());
return rzH},iRs=function(x){var S;
x=(S=x.options)==null?void 0:S.persistenceOption;return x==="ENTITY_PERSISTENCE_OPTION_PERSIST"||x==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},QTv=function(x){var S;
return g.V(function(Z){return Z.S==1?g.B(Z,Sc(),2):(S=Z.Y)?g.B(Z,y9(S,"readwrite",function(k){for(var e={},u=g.v(x),C=u.next(),L={};!C.done;L={Hw:void 0,Sw:void 0},C=u.next())L.Hw=C.value,L.Hw.entityKey&&iRs(L.Hw)&&(L.Sw=g.C2(L.Hw.payload),C=void 0,L.Hw.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(C=function(c){return function(){return D6(k,c.Hw.payload[c.Sw],c.Sw)}}(L)),L.Hw.type==="ENTITY_MUTATION_TYPE_DELETE"&&(C=function(c){return function(){return M0(k,c.Hw.entityKey)}}(L)),L.Hw.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(C=function(c){return function(){return dTb(k,c.Hw.entityKey,c.Hw.payload[c.Sw],c.Sw)}}(L)),C&&(e[L.Hw.entityKey]=e[L.Hw.entityKey]?e[L.Hw.entityKey].then(C):C()));
return g.WR.all(Object.values(e))}),0):Z.return()})},sTS=function(x){var S;
return g.V(function(Z){if(Z.S==1){S=x.mutations;if(!S||S.length<=0)return Z.return();if(g.E2){var k={type:"ENTITY_LOADED"};S!==void 0&&(k.payload=S);g.E2.dispatch(k)}return g.B(Z,QTv(S),2)}S.length=0;g.Iq(Z)})},fPR=function(x){return x!==void 0},E0v=function(x){var S=g.u5();
S=Object.assign({},S);x=Object.assign({},x);for(var Z in S)x[Z]?(S[Z]!==4&&(S[Z]=x[Z]),delete x[Z]):S[Z]!==2&&(S[Z]=4);Object.assign(S,x);g.p5O(S);JSON.stringify(S);return S},Bz$=function(x){var S,Z;
return g.V(function(k){if(k.S==1)return g.B(k,g.pQ(),2);if(k.S!=3)return(S=k.Y)?g.B(k,g.LT(S),3):k.return();Z=k.Y;return k.return(g.BR(Z,["index","media","captions"],{mode:"readwrite",tS:!0},function(e){var u=IDBKeyRange.bound(x+"|",x+"~");e=[e.objectStore("index").delete(u),e.objectStore("media").delete(u),e.objectStore("captions").delete(u)];return g.WR.all(e).then(function(){})}))})},VEn=function(){var x,S;
return g.V(function(Z){if(Z.S==1)return g.B(Z,g.pQ(),2);if(Z.S!=3){x=Z.Y;if(!x)throw g.PR("rvdfd");return g.B(Z,g.LT(x),3)}S=Z.Y;return Z.return(g.BR(S,["index","media"],{mode:"readwrite",tS:!0},function(k){var e={};return g.bn(k.objectStore("index"),{},function(u){var C=u.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),L=g.WR.resolve(void 0);if(C){var c=C[1];C=C[2];e[c]=e[c]||{};var J;e[c][C]=g.Z3g((J=u.getValue())==null?void 0:J.fmts)}else L=u.delete().then(function(){});
return g.WR.all([g.mV(u),L]).then(function(X){return g.v(X).next().value})}).then(function(){for(var u={},C=g.v(Object.keys(e)),L=C.next();!L.done;L=C.next()){L=L.value;
var c=e[L].v;u[L]=e[L].a&&c?1:2}var J=E0v(u);return g.sNx(k.objectStore("media"),{},function(X){var a=X.cursor.key.match(g.CES);a&&u[a[1]]||k.objectStore("media").delete(X.cursor.key);return g.PCb(X)}).then(function(){return J})})}))})},n0b=function(x,S){var Z,k;
return g.V(function(e){if(e.S==1)return g.B(e,g.pQ(),2);if(e.S!=3){Z=e.Y;if(!Z)throw g.PR("wct");return g.B(e,g.LT(Z),3)}k=e.Y;return g.B(e,g.BR(k,["captions"],{mode:"readwrite",tS:!0},function(u){var C=[];u=u.objectStore("captions");for(var L=0;L<S.length;L++){var c=g.V3(u,S[L],x+"|"+S[L].metadata.vss_id);C.push(c)}return g.WR.all(C)}),0)})},KXs=function(x){var S,Z,k;
return g.V(function(e){if(e.S==1)return S=IDBKeyRange.bound(x+"|",x+"~"),g.B(e,g.pQ(),2);if(e.S!=3){Z=e.Y;if(!Z)throw g.PR("gactfv");return g.B(e,g.LT(Z),3)}k=e.Y;return e.return(k.getAll("captions",S))})},G2R=function(x){return g.V(function(S){g.t_(x,0);
return S.return(Bz$(x))})},bRH=function(x){return{context:g.xJ(),
videoIds:x}},mTh=function(x){return{context:g.xJ(),
playlistIds:x}},o0$=function(x){return{context:g.xJ(),
offlinePlaylistSyncChecks:x}},ORx=function(){this.S=new Map},HRJ=function(){hnx||(hnx=new ORx);
return hnx},UTH=function(x,S){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:x},metadata:S,statusCode:void 0,csn:void 0,can:void 0}},Az9=function(x,S,Z){if(!Z){var k=k===void 0?!1:k;
Z=x.S.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!Z||k)Z=g.PS(16),x.S.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",Z)}x={flowNonce:Z,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:S.eventType};S.metadata&&(x.flowMetadata=S.metadata);S.statusCode!==void 0&&(x.flowEventStatus=S.statusCode);S.csn&&(x.csn=S.csn);S.can&&(x.can=S.can);g.TR("flowEvent",x,void 0)},Rn$=function(x){var S,Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b,h,l,A,kb,cx,eQ,aq,SQ,Wx,ly,Xv,J$,hg,VR,kX,Km,UH,L2,E,n2;
return g.V(function(Qt){if(Qt.S==1)return g.B(Qt,y9(x,{mode:"readonly",tS:!0},function(Zu){return RV(Zu,"playbackData").then(function(sH){var Y=sH.map(function(oh){return oh.transfer}).filter(function(oh){return!!oh}),jQ=sH.map(function(oh){return oh.offlineVideoPolicy}).filter(function(oh){return!!oh}),sV=sH.filter(function(oh){return!!oh.key}).map(function(oh){return g.S5(g.xl(oh.key).entityId,"downloadStatusEntity")});
Y=RV(Zu,"transfer",Y);jQ=RV(Zu,"offlineVideoPolicy",jQ);sV=RV(Zu,"downloadStatusEntity",sV);var $X=Y.then(function(oh){oh=oh.reduce(function(Rq,jx){(jx==null?0:jx.offlineVideoStreams)&&Rq.push.apply(Rq,g.qc(jx.offlineVideoStreams));return Rq},[]).filter(function(Rq){return!!Rq});
return RV(Zu,"offlineVideoStreams",oh)});
return g.WR.all([Y,jQ,$X,sV]).then(function(oh){var Rq=g.v(oh);oh=Rq.next().value;var jx=Rq.next().value;var eb=Rq.next().value;Rq=Rq.next().value;return[sH,oh,jx,eb,Rq]})})}),2);
if(Qt.S!=3)return S=Qt.Y,g.B(Qt,y9(x,{mode:"readonly",tS:!0},function(Zu){return RV(Zu,"mainDownloadsListEntity").then(function(sH){var Y,jQ;return(jQ=(Y=sH[0])==null?void 0:Y.downloads)!=null?jQ:[]})}),3);
Z=Qt.Y;k=g.v(S);e=k.next().value;u=k.next().value;C=k.next().value;L=k.next().value;c=k.next().value;J=e;X=u;a=C;F=L;q=c;d={};W={};I={};f={};Q={};n=[];b=g.v(X);for(h=b.next();!h.done;h=b.next())(l=h.value)&&(d[l.key]=l);A=g.v(a);for(kb=A.next();!kb.done;kb=A.next())(cx=kb.value)&&(W[cx.key]=cx);eQ=g.v(q);for(aq=eQ.next();!aq.done;aq=eQ.next())(SQ=aq.value)&&(I[SQ.key]=SQ);Wx=g.v(F);for(ly=Wx.next();!ly.done;ly=Wx.next())(Xv=ly.value)&&(f[Xv.key]=Xv);J$=g.v(Z);for(hg=J$.next();!hg.done;hg=J$.next())VR=
hg.value,kX=void 0,Q[(kX=VR.videoItem)!=null?kX:""]=!0,VR.videoItem&&(UH=Km=void 0,L2=(UH=(Km=g.xl(VR.videoItem))==null?void 0:Km.entityId)!=null?UH:"",n.push({externalVideoId:L2}));E=J.filter(function(Zu){if(!Zu||!Zu.key||!Zu.offlineVideoPolicy)return!1;Zu=g.xl(Zu.key).entityId;Zu=g.S5(Zu,"downloadStatusEntity");var sH;return!(Zu&&((sH=I[Zu])==null?void 0:sH.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
n2=E.map(function(Zu){var sH=d[Zu.transfer],Y=[];if(sH==null?0:sH.offlineVideoStreams)for(var jQ=g.v(sH.offlineVideoStreams),sV=jQ.next();!sV.done;sV=jQ.next())(sV=f[sV.value])&&Y.push(sV);jQ=W[Zu.offlineVideoPolicy];sV=Q;var $X=Zu==null?void 0:Zu.playerResponseTimestamp,oh=g.xl(jQ.key).entityId;Zu=g.S5(oh,"mainVideoEntity");if(jQ.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var Rq="OFFLINE_VIDEO_STATE_DISABLED";jQ.expirationTimestamp&&Number(jQ.expirationTimestamp)<Date.now()/1E3&&(Rq="OFFLINE_VIDEO_STATE_EXPIRED")}else if(jQ.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")Rq="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(sH==null?void 0:sH.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":Rq="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":Rq="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":Rq="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":Rq="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":Rq="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":Rq="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:Rq="OFFLINE_VIDEO_STATE_UNKNOWN"}if(Rq==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(sH==null?void 0:sH.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":Rq="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":Rq="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":Rq=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}oh={id:oh,videoState:Rq};if(sH==null?0:sH.cotn)oh.cotn=sH.cotn;if(sH==null?0:sH.maximumDownloadQuality)oh.selectedVideoQuality=sH==null?void 0:sH.maximumDownloadQuality;if(sH==null?0:sH.lastProgressTimeMs)oh.lastProgressTimeMs=sH.lastProgressTimeMs;$X&&(oh.playerResponseSavedTimeMs=String(Number($X)*1E3));sH=String;$X=0;Y=g.v(Y);for(Rq=Y.next();!Rq.done;Rq=Y.next())if(Rq=Rq.value,Rq.streamsProgress){Rq=g.v(Rq.streamsProgress);for(var jx=Rq.next();!jx.done;jx=Rq.next()){var eb=
void 0;$X+=Number((eb=jx.value.numBytesDownloaded)!=null?eb:0)}}oh.downloadedBytes=sH($X);oh.selectedOfflineMode=sV[Zu]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";jQ.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(oh.offlinePlaybackDisabledReason=jQ.offlinePlaybackDisabledReason);return oh});
return Qt.return({offlineVideos:n2,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:n}}})})},w3R=function(){this.locks=navigator.locks},DTn=function(){try{var x=g.Sx("ytglobal.locks_");
if(x)return x;var S;if(S=navigator){var Z=navigator;S="locks"in Z&&!!Z.locks}if(S)return g.$b.localStorage&&g.$b.localStorage.getItem("noop"),x=new w3R,g.xn("ytglobal.locks_",x),x}catch(k){}},jc=function(){},MEH=function(){},g0v=function(x){if(x.includes(":"))throw Error("Invalid user cache name: "+x);
return x+":"+g.g3("CacheStorage get")},lPh=function(){return g.V(function(x){if(ZG!==void 0)return x.return(ZG);
ZG=new Promise(function(S){var Z;return g.V(function(k){switch(k.S){case 1:return g.Nc(k,2),g.B(k,kq.open("test-only"),4);case 4:return g.B(k,kq.delete("test-only"),5);case 5:g.f4(k,3);break;case 2:if(Z=g.EO(k),Z instanceof Error&&Z.name==="SecurityError")return S(!1),k.return();case 3:S("caches"in window),g.Iq(k)}})});
return x.return(ZG)})},p3R=function(){return g.V(function(x){if(x.S==1)return g.B(x,lPh(),2);
if(!x.Y)return x.return(void 0);yzS||(yzS=new MEH);return x.return(yzS)})},ec=function(x,S,Z){g.nn(new g.MG("Woffle: "+x,Z?{cotn:Z}:""));
S instanceof Error&&g.nn(S)},$TS=function(x){var S;
return g.V(function(Z){if(Z.S==1)return g.B(Z,Rn$(x),2);S=Z.Y;g.TR("offlineStateSnapshot",S);g.Iq(Z)})},ug=function(x){g.m.call(this);
var S=this;this.api=x;this.S2={k7r:function(){return S.S},
ZAL:function(){return S.Y}};
typeof g.$b.BroadcastChannel!=="undefined"&&(this.S=new g.$b.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.g3()),this.S.onmessage=this.D.bind(this),this.Y=new g.$b.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.g3()),this.Y.onmessage=this.G.bind(this))},Cs=function(x,S){x.api.XL("onOfflineOperationFailure",S);
var Z;(Z=x.S)==null||Z.postMessage(S)},xhS=function(x,S,Z){var k=this;
this.X=x;this.j=S;this.visibility=Z;this.B=this.N=this.L=this.D=this.S=!1;this.G=new g.xN(function(){k.MA()});
this.S2={LJ:function(){return k.Y},
MA:function(){k.MA()},
Jmr:function(){return k.G}};
this.visibility.subscribe("visibilitystatechange",function(){k.Kb()})},S4h=function(x){if(!x.D&&!x.S){var S=DTn();
if(S){x.D=!0;var Z=g.g3("OfflineLockManager");S.request("woffle_orchestration_leader:"+Z,{},function(){var k,e;return g.V(function(u){switch(u.S){case 1:return g.Nc(u,2),x.Y=new g.qT,x.S=!0,x.D=!1,g.B(u,x.X(),4);case 4:return g.B(u,x.Y.promise,5);case 5:g.f4(u,0);break;case 2:k=g.EO(u),x.MA(),k instanceof Error&&(e=k,e.args=[{name:"WoLockManagerError",U1:k.name}],g.BF(e)),g.Iq(u)}})})}}},jNt=function(x){x.S&&(x.B=!0,tL(x))},ZgR=function(x,S){x.S&&(x.L=S,tL(x))},kyx=function(x,S){x.S&&(x.N=S,tL(x))},
tL=function(x){x.N&&x.L&&x.B&&x.visibility.isBackground()?g.Sh(x.G,6E4):x.G.stop()},Ls=function(x){var S;
x.offlineDeleteReason=(S=x.offlineDeleteReason)!=null?S:"OFFLINE_DELETE_REASON_UNKNOWN";var Z;x.offlineModeType=(Z=x.offlineModeType)!=null?Z:"OFFLINE_NOW";g.TR("offlineDeleteEvent",x)},cL=function(x,S){var Z=S.videoId;
var k=S.X8;S=S.offlineModeType;x.encryptedVideoId=Z;x.cotn=k==null?void 0:k.cotn;x.offlineabilityFormatType=k==null?void 0:k.maximumDownloadQuality;var e;x.isRefresh=(e=k==null?void 0:k.isRefresh)!=null?e:!1;var u;x.softErrorCount=(u=k==null?void 0:k.transferRetryCount)!=null?u:0;x.offlineModeType=S!=null?S:"OFFLINE_NOW";(x.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&x.statusType==="UNKNOWN_STATUS_TYPE"||!x.transferStatusType&&!x.statusType)&&g.nn(Error("Woffle unknown transfer status"));
g.TR("offlineTransferStatusChanged",x)},e9m=function(x){cL({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},x)},uxh=function(x,S,Z,k){k={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!k};S&&Z&&(S=Math.floor(S/1024).toFixed(),Z=Math.floor(Z/1024).toFixed(),k.alreadyDownloadedKbytes=S,k.totalFetchedKbytes=S,k.totalContentKbytes=Z);cL(k,x)},CCR=function(x){cL({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},x)},t4R=function(x){cL({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},x)},Lkh=function(x){switch(x){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
JL=function(x){var S,Z,k;
return((k=(S=x.actionMetadata)==null?void 0:(Z=S.retryScheduleIntervalsInSeconds)==null?void 0:Z.length)!=null?k:0)>0},Xd=function(x){return x.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!x.entityKey},af=function(x){return x.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!x.entityKey},Fd=function(x){return x.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!x.entityKey},cts=function(x){return x.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!x.entityKey},
qP=function(x,S,Z,k,e){e=e===void 0?!1:e;
var u,C,L,c,J,X;return g.V(function(a){if(a.S==1)return u=g.S5(x,S),C=g.S5(x,"downloadStatusEntity"),g.B(a,y9(Z,{mode:"readonly",tS:!0},function(F){return g.WR.all([AB(F,u,S),AB(F,C,"downloadStatusEntity")])}),2);
L=a.Y;c=L.length?L[0]:void 0;if(!c)return a.OT(0);J=Jtt;if(X=L.length>1?L[1]:void 0){if(X.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!e)return a.return();X.downloadState=k}else X={key:C,downloadState:k};g.oa(c,J,X);return g.B(a,y9(Z,{mode:"readwrite",tS:!0},function(F){return g.WR.all([D6(F,c,S),D6(F,X,"downloadStatusEntity")])}),0)})},dM=function(x,S){return x.actionType===S.actionType&&x.entityKey===S.entityKey},z6=function(x,S){if(x&&x.transferState!=="TRANSFER_STATE_COMPLETE"&&x.transferState!==
"TRANSFER_STATE_FAILED"){var Z=g.xl(x.key).entityId;
cL({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:Z,X8:x,offlineModeType:S})}},T6=function(x){if(!x||!x.thumbnails)return[];
var S=[];x=g.v(x.thumbnails);for(var Z=x.next();!Z.done;Z=x.next())Z=Z.value,Z.url&&S.push(Z.url);return S},XZb=function(x,S,Z){Z=Z===void 0?[]:Z;
var k,e,u,C,L,c,J,X,a,F,q,d,W;return g.V(function(I){if(I.S==1)return Z.length?g.B(I,xq(x,S),2):I.return([]);k=I.Y;e=new Set;u=g.v(k);for(C=u.next();!C.done;C=u.next())if(L=C.value,c=L.id||L.key)J=g.xl(c).entityId,e.add(J);X=[];a=g.v(Z);for(F=a.next();!F.done;F=a.next())q=F.value,d=q.offlineVideoData,W=void 0,((W=d)==null?0:W.videoId)&&!e.has(d.videoId)&&X.push(q);return I.return(X)})},a$R=function(x,S,Z){return new g.WK(x,{cotn:S,
raw_player_response:Z,download_media:!0,start:Infinity,disable_watch_next:!0})},Fkt=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},PL=function(x,S,Z,k,e,u,C,L,c,J,X){this.entityType=x;
this.actionId=S;this.action=Z;this.parentActionId=k;this.rootActionId=e===void 0?S:e;this.childActionIds=u;this.prereqActionId=C;this.postreqActionIds=L;this.hasChildActionFailed=J;this.retryScheduleIndex=0;this.S=X||Date.now();this.retryScheduleIndex=c||0},vL=function(x){if(!x.key)throw Error("Entity key is required.");
if(!x.actionProto)throw Error("OfflineOrchestrationAction is required.");var S=g.xl(x.key),Z=g.xl(x.actionProto.entityKey);return new PL(Z.entityType,S.entityId,x.actionProto,x.parentActionId,x.rootActionId,x.childActionIds,x.prereqActionId,x.postreqActionIds,x.retryScheduleIndex,x.hasChildActionFailed,Number(x.enqueueTimeSec)*1E3)},WL=function(x){return{key:g.S5(x.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:x.action,parentActionId:x.parentActionId,rootActionId:x.rootActionId,childActionIds:x.childActionIds,prereqActionId:x.prereqActionId,postreqActionIds:x.postreqActionIds,retryScheduleIndex:x.retryScheduleIndex,hasChildActionFailed:x.hasChildActionFailed,enqueueTimeSec:(x.S/1E3).toFixed()}},q4J=function(){var x;
return g.V(function(S){return S.S==1?g.B(S,p3R(),2):(x=S.Y)?S.return(x.delete("yt-player-local-img")):S.return(!0)})},Yq=function(x){var S,Z;
return g.V(function(k){if(k.S==1)return g.B(k,p3R(),2);if(k.S!=3){S=k.Y;if(!S)throw Error("Cache API not supported");return x.length?g.B(k,S.open("yt-player-local-img"),3):k.return()}Z=k.Y;return g.B(k,Promise.all(x.map(function(e){return Z.delete(e)})),0)})},If=function(x){var S,Z;
return g.V(function(k){if(k.S==1)return g.B(k,p3R(),2);if(k.S!=3){S=k.Y;if(!S)throw Error("Cache API not supported");return x.length?g.B(k,S.open("yt-player-local-img"),3):k.return()}Z=k.Y;return g.B(k,Z.addAll(x),0)})},NP=function(x,S,Z,k,e){var u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b,h,l,A,kb,cx,eQ,aq,SQ,Wx,ly,Xv,J$,hg,VR,kX;
return g.V(function(Km){switch(Km.S){case 1:return u=g.S5(x,"mainVideoEntity"),C=g.S5(x,"ytMainChannelEntity"),L=g.S5(x,"transfer"),c=g.S5(x,"videoDownloadContextEntity"),g.B(Km,y9(S,{mode:"readonly",tS:!0},function(UH){return g.WR.all([AB(UH,u,"mainVideoEntity"),AB(UH,C,"ytMainChannelEntity"),AB(UH,L,"transfer"),AB(UH,c,"videoDownloadContextEntity"),RV(UH,"ytMainChannelEntity"),RV(UH,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:J=Km.Y;X=g.v(J);a=X.next().value;F=X.next().value;q=X.next().value;d=X.next().value;W=X.next().value;I=X.next().value;f=a;Q=F;n=q;b=d;h=W;l=I;if(!f&&!Q){Km.OT(3);break}A=f?T6(f.thumbnail):[];if(!Q){kb=[];Km.OT(4);break}return g.B(Km,dhs(Q,h),5);case 5:kb=Km.Y;case 4:return cx=kb,g.B(Km,Yq(A.concat(cx)),3);case 3:eQ=[];aq=g.S5(x,"downloadStatusEntity");SQ=g.v(l);for(Wx=SQ.next();!Wx.done;Wx=SQ.next())ly=Wx.value,Xv=g.xl(ly.key).entityId,J$=vL(ly),hg=g.xl(J$.action.entityKey).entityId,Xv!==x&&
hg!==x||dM(Z,ly.actionProto)||eQ.push(ly.key);return g.B(Km,y9(S,{mode:"readwrite",tS:!0},function(UH){var L2=eQ.map(function(E){return M0(UH,E)});
L2.push(M0(UH,u,{B5:!0}));L2.push(M0(UH,aq,{B5:!0}));return g.WR.all(L2)}),7);
case 7:kX=(VR=b)==null?void 0:VR.offlineModeType,e&&(Ls(e),e.offlineModeType&&(kX=e.offlineModeType)),z6(n,kX),Cs(k,{entityKey:u,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Iq(Km)}})},PCn=function(x,S,Z,k){var e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b,h,l,A,kb,cx,eQ,aq,SQ,Wx,ly,Xv,J$,hg,VR,kX,Km,UH,L2,E,n2,Qt,Zu,sH,Y,jQ,sV,$X,oh,Rq,jx,eb,D4,N;
return g.V(function(P){switch(P.S){case 1:return e=g.S5(x,"mainPlaylistEntity"),u=g.S5(x,"ytMainChannelEntity"),g.B(P,y9(S,{mode:"readonly",tS:!0},function(r){return g.WR.all([AB(r,e,"mainPlaylistEntity"),AB(r,u,"ytMainChannelEntity"),RV(r,"mainPlaylistEntity"),RV(r,"mainDownloadsListEntity"),RV(r,"ytMainChannelEntity"),RV(r,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:C=P.Y;L=g.v(C);c=L.next().value;J=L.next().value;X=L.next().value;a=L.next().value;F=L.next().value;q=L.next().value;d=c;W=J;I=X;f=a;Q=F;n=q;if(!d&&!W){P.OT(3);break}b=d?z9v(d):[];if(!W){h=[];P.OT(4);break}return g.B(P,dhs(W,Q),5);case 5:h=P.Y;case 4:return l=h,g.B(P,Yq(b.concat(l)),3);case 3:A=[];kb=new Map;if(!d){P.OT(7);break}return g.B(P,Tin(d,I,f),8);case 8:A=P.Y;cx=g.v(A);for(eQ=cx.next();!eQ.done;eQ=cx.next())aq=eQ.value,kb.set(aq,{videoId:aq,playlistId:x,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.B(P,y9(S,{mode:"readonly",tS:!0},function(r){return g.WR.all([RV(r,"transfer"),RV(r,"videoDownloadContextEntity")])}),9);
case 9:SQ=P.Y;Wx=g.v(SQ);ly=Wx.next().value;Xv=Wx.next().value;J$=ly;hg=Xv;VR=g.v(J$);for(kX=VR.next();!kX.done;kX=VR.next())Km=kX.value,UH=g.xl(Km.key).entityId,(L2=kb.get(UH))&&Km&&(L2.cotn=Km.cotn);E=g.v(hg);for(n2=E.next();!n2.done;n2=E.next())Qt=n2.value,Zu=g.xl(Qt.key).entityId,(sH=kb.get(Zu))&&Qt&&(sH.offlineModeType=Qt.offlineModeType);case 7:Y=[];jQ=g.v(n);for(sV=jQ.next();!sV.done;sV=jQ.next())$X=sV.value,oh=g.xl($X.key).entityId,Rq=vL($X),oh!==x&&Rq.rootActionId!==x||dM(Z,$X.actionProto)||
Y.push($X.key);jx=g.S5(x,"mainPlaylistEntity");return g.B(P,y9(S,{mode:"readwrite",tS:!0},function(r){var K=Y.map(function(w){return M0(r,w)});
K.push(M0(r,jx,{B5:!0}));return g.WR.all(K)}),10);
case 10:if(!d){P.OT(0);break}A.reverse();if(!A){P.OT(0);break}eb=g.v(A);D4=eb.next();case 13:if(D4.done){P.OT(0);break}N=D4.value;return g.B(P,NP(N,S,Z,k,kb.get(N)),14);case 14:D4=eb.next(),P.OT(13)}})},Wkm=function(x,S,Z,k){var e,u,C,L,c,J,X,a,F;
return g.V(function(q){if(q.S==1)return e=g.S5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),u=new Map,g.B(q,y9(x,{mode:"readwrite",tS:!0},function(d){var W=RV(d,"transfer"),I=RV(d,"offlineOrchestrationActionWrapperEntity"),f=RV(d,"videoDownloadContextEntity"),Q=AB(d,e,"mainDownloadsListEntity");return g.WR.all([W,I,f,Q]).then(function(n){n=g.v(n);var b=n.next().value;var h=n.next().value;var l=n.next().value;var A=n.next().value;n=vhS.map(function(cx){return qRJ(d,cx)});
h=g.v(h);for(var kb=h.next();!kb.done;kb=h.next())kb=kb.value,dM(S,kb.actionProto)||n.push(M0(d,kb.key,{B5:!0}));A&&(A.downloads=[],n.push(D6(d,A,"mainDownloadsListEntity")));if(l)for(l=g.v(l),A=l.next();!A.done;A=l.next())A=A.value,h=g.xl(A.key).entityId,h=g.S5(h,"transfer"),u.set(h,A.offlineModeType);return g.WR.all(n).then(function(){return b})})}),2);
C=q.Y;L=g.v(C);for(c=L.next();!c.done;c=L.next())J=c.value,z6(J,u.get(J.key)),X=g.xl(J.key).entityId,a={videoId:X,offlineDeleteReason:k,cotn:J.cotn,offlineModeType:u.get(J.key)},Ls(a),F=g.S5(X,"mainVideoEntity"),Cs(Z,{entityKey:F,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.B(q,q4J(),0)})},z9v=function(x,S){var Z=[];
if(x.thumbnailStyleData){x=g.v(x.thumbnailStyleData);for(var k=x.next();!k.done;k=x.next()){var e=void 0,u=void 0,C=void 0;Z=Z.concat(T6((e=k.value)==null?void 0:(u=e.value)==null?void 0:(C=u.collageThumbnail)==null?void 0:C.coverThumbnail))}}S=T6(S);return Z.concat(S)},Tin=function(x,S,Z){var k,e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b,h,l,A,kb,cx;
return g.V(function(eQ){k=[];e=new Set;if(Z.length)for(u=g.v(Z),C=u.next();!C.done;C=u.next())if(L=C.value,c=void 0,(c=L.downloads)==null?0:c.length)for(J=g.v(L.downloads),X=J.next();!X.done;X=J.next())a=X.value,a.videoItem&&(F=g.xl(a.videoItem).entityId,e.add(F));if(x.videos){q=g.v(x.videos);for(d=q.next();!d.done;d=q.next())W=d.value,I=JSON.parse(g.xl(W).entityId),I.videoId&&!e.has(I.videoId)&&k.push(I.videoId);f=g.v(S);for(Q=f.next();!Q.done;Q=f.next())if(n=Q.value,n.key!==x.key&&(b=n.videos))for(h=
g.v(b),l=h.next();!l.done;l=h.next())A=l.value,kb=JSON.parse(g.xl(A).entityId),kb.videoId&&(cx=k.indexOf(kb.videoId),cx!==-1&&k.splice(cx,1))}return eQ.return(k)})},dhs=function(x,S){var Z,k,e,u,C,L,c,J;
return g.V(function(X){Z=T6(x.avatar);k=g.v(S);for(e=k.next();!e.done;e=k.next())if(u=e.value,u.id!==x.id)for(C=g.v(T6(u.avatar)),L=C.next();!L.done;L=C.next())c=L.value,J=Z.indexOf(c),J!==-1&&Z.splice(J,1);return X.return(Z)})},Y4h=function(x){var S;
return g.V(function(Z){S=g.H(x.frameworkUpdates,rM);return x.frameworkUpdates&&S?g.B(Z,sTS(S),0):Z.return()})},Ni9=function(x){var S;
if((S=x.onResponseReceivedActions)!=null&&S.length){var Z;x=(Z=g.H(g.H(x.onResponseReceivedActions[0],I$H),g.YtJ))==null?void 0:Z.actions;if(x!=null&&x.length)return x}},rtx=function(x){var S,Z,k;
return g.V(function(e){if(e.S==1)return x?g.B(e,$i(x,g.mm,"mainDownloadsListEntity"),2):e.return([]);S=e.Y;return((Z=S)==null?0:(k=Z.downloads)==null?0:k.length)?e.return(S.downloads.map(function(u){var C;return(C=u.videoItem)!=null?C:""})):e.return([])})},QNh=function(x,S){var Z;
return g.V(function(k){return k.S==1?g.B(k,igm(x,S),2):(Z=k.Y)?g.B(k,y9(x,{mode:"readwrite",tS:!0},function(e){var u=[D6(e,Z.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];Z.mainDownloadsListEntity&&u.push(D6(e,Z.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.WR.all(u)}),0):k.OT(0)})},igm=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n;
return g.V(function(b){if(b.S==1)return Z=g.S5("main_downloads_library_id","mainDownloadsLibraryEntity"),k=g.S5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.B(b,y9(x,{mode:"readonly",tS:!0},function(h){return g.WR.all([AB(h,Z,"mainDownloadsLibraryEntity"),AB(h,k,"mainDownloadsListEntity")])}),2);
e=b.Y;u=g.v(e);C=u.next().value;L=u.next().value;c=C;J=L;c||(c={id:Z});X=g.v(S);for(a=X.next();!a.done;a=X.next())if(F=a.value,F===g.mm){if(c.smartDownloadsList)return b.return();c.smartDownloadsList=F}else if(q=g.xl(F).entityType,d={},q==="mainPlaylistEntity"?d.playlistItem=F:q==="mainVideoEntity"&&(d.videoItem=F),!g.qE(d)){W=void 0;if((W=J)==null?0:W.downloads){I=!1;f=g.v(J.downloads);for(Q=f.next();!Q.done;Q=f.next())if(n=Q.value,n.playlistItem===F||n.videoItem===F){I=!0;break}I||J.downloads.push(d)}else J=
{id:k,downloads:[d]};c.downloadsList=k}return b.return({mainDownloadsLibraryEntity:c,mainDownloadsListEntity:J})})},sNs=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I;
return g.V(function(f){if(f.S==1)return Z=g.S5("main_downloads_library_id","mainDownloadsLibraryEntity"),k=g.S5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.B(f,y9(x,{mode:"readonly",tS:!0},function(Q){return g.WR.all([AB(Q,Z,"mainDownloadsLibraryEntity"),AB(Q,k,"mainDownloadsListEntity"),AB(Q,g.mm,"mainDownloadsListEntity")])}),2);
e=f.Y;u=g.v(e);C=u.next().value;L=u.next().value;c=u.next().value;J=C;X=L;a=c;if(!J)return f.OT(0);if(S===g.mm&&((F=a)==null?0:F.downloads))a.downloads=[];else if((q=X)==null?0:q.downloads)for(d=g.xl(S).entityType,W=0;W<X.downloads.length;W++)if(I=X.downloads[W],d==="mainVideoEntity"&&I.videoItem===S){X.downloads.splice(W,1);break}else if(d==="mainPlaylistEntity"&&I.playlistItem===S){X.downloads.splice(W,1);break}return g.B(f,y9(x,{mode:"readwrite",tS:!0},function(Q){var n=[D6(Q,J,"mainDownloadsLibraryEntity")];
X&&n.push(D6(Q,X,"mainDownloadsListEntity"));a&&n.push(D6(Q,a,"mainDownloadsListEntity"));return g.WR.all(n)}),0)})},ig=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F;
return g.V(function(q){if(q.S==1)return Z=g.S5(S,"transfer"),k=g.S5(S,"videoDownloadContextEntity"),g.B(q,y9(x,{mode:"readonly",tS:!0},function(d){return g.WR.all([AB(d,Z,"transfer"),AB(d,k,"videoDownloadContextEntity")])}),2);
e=q.Y;u=g.v(e);C=u.next().value;L=u.next().value;c=C;J=L;F={videoId:S,cotn:(X=c)==null?void 0:X.cotn,offlineModeType:(a=J)==null?void 0:a.offlineModeType};return q.return(F)})},Q4=function(x,S,Z,k,e){var u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b,h,l,A,kb;
return g.V(function(cx){switch(cx.S){case 1:return u=g.S5(x,"musicTrack"),C=g.S5(x,"transfer"),g.B(cx,y9(S,{mode:"readonly",tS:!0},function(eQ){return g.WR.all([AB(eQ,u,"musicTrack"),AB(eQ,C,"transfer"),RV(eQ,"musicTrack"),RV(eQ,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:L=cx.Y;c=g.v(L);J=c.next().value;X=c.next().value;a=c.next().value;F=c.next().value;q=J;d=X;W=a;I=F;if(!q){cx.OT(3);break}return g.B(cx,f$J(q,W),4);case 4:return f=cx.Y,g.B(cx,Yq(f),3);case 3:Q=[];n=g.v(I);for(b=n.next();!b.done;b=n.next())h=b.value,l=g.xl(h.key).entityId,A=vL(h),kb=g.xl(A.action.entityKey).entityId,l!==x&&kb!==x||dM(Z,h.actionProto)||Q.push(h.key);return g.B(cx,y9(S,{mode:"readwrite",tS:!0},function(eQ){var aq=Q.map(function(SQ){return M0(eQ,SQ)});
aq.push(M0(eQ,u,{B5:!0}));return g.WR.all(aq)}),6);
case 6:z6(d),e&&Ls(e),Cs(k,{entityKey:u,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Iq(cx)}})},si=function(x,S,Z,k,e){var u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b,h,l,A,kb,cx,eQ,aq,SQ,Wx,ly,Xv,J$,hg,VR,kX,Km,UH,L2,E,n2;
return g.V(function(Qt){switch(Qt.S){case 1:return u=g.S5(x,S),C=g.S5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.B(Qt,y9(Z,{mode:"readonly",tS:!0},function(Zu){return g.WR.all([AB(Zu,u,S),AB(Zu,C,"musicDownloadsLibraryEntity"),RV(Zu,S),RV(Zu,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:L=Qt.Y;c=g.v(L);J=c.next().value;X=c.next().value;a=c.next().value;F=c.next().value;q=J;d=X;W=a;I=F;if(!q){Qt.OT(3);break}return g.B(Qt,f$J(q,W),4);case 4:return f=Qt.Y,g.B(Qt,Yq(f),3);case 3:Q=[];n=new Map;if(!q){Qt.OT(6);break}return g.B(Qt,EhR(q,W,d),7);case 7:Q=Qt.Y;b=g.v(Q);for(h=b.next();!h.done;h=b.next())l=h.value,A=g.xl(l).entityId,n.set(A,{videoId:A,playlistId:x,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.B(Qt,xq(Z,"transfer"),8);case 8:for(kb=Qt.Y,cx=
g.v(kb),eQ=cx.next();!eQ.done;eQ=cx.next())aq=eQ.value,SQ=g.xl(aq.key).entityId,(Wx=n.get(SQ))&&aq&&(Wx.cotn=aq.cotn);case 6:ly=[];Xv=g.v(I);for(J$=Xv.next();!J$.done;J$=Xv.next())hg=J$.value,VR=g.xl(hg.key).entityId,kX=vL(hg),VR!==x&&kX.rootActionId!==x||dM(k,hg.actionProto)||ly.push(hg.key);Km=g.S5(x,S);return g.B(Qt,y9(Z,{mode:"readwrite",tS:!0},function(Zu){var sH=ly.map(function(Y){return M0(Zu,Y)});
sH.push(M0(Zu,Km,{B5:!0}));return g.WR.all(sH)}),9);
case 9:if(!q){Qt.OT(0);break}Q.reverse();if(!Q.length){Qt.OT(0);break}UH=g.v(Q);L2=UH.next();case 12:if(L2.done){Qt.OT(0);break}E=L2.value;n2=g.xl(E).entityId;if(!n2){Qt.OT(13);break}return g.B(Qt,Q4(n2,Z,k,e,n.get(n2)),13);case 13:L2=UH.next(),Qt.OT(12)}})},fs=function(x,S,Z){var k,e,u,C,L,c,J;
return g.V(function(X){if(X.S==1)return g.B(X,y9(x,{mode:"readwrite",tS:!0},function(a){var F=RV(a,"transfer"),q=RV(a,"offlineOrchestrationActionWrapperEntity");return g.WR.all([F,q]).then(function(d){d=g.v(d);var W=d.next().value;var I=d.next().value;d=BiJ.map(function(b){return qRJ(a,b)});
I=g.v(I);for(var f=I.next();!f.done;f=I.next()){f=f.value;var Q=g.xl(f.actionProto.entityKey).entityType==="musicTrack",n=f.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";dM(S,f.actionProto)||Q&&(!Q||n)||d.push(M0(a,f.key,{B5:!0}))}return g.WR.all(d).then(function(){return W})})}),2);
k=X.Y;e=g.v(k);for(u=e.next();!u.done;u=e.next())C=u.value,z6(C),L=g.xl(C.key).entityId,c={videoId:L,offlineDeleteReason:void 0,cotn:C.cotn},Ls(c),J=g.S5(L,"musicTrack"),Cs(Z,{entityKey:J,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.B(X,q4J(),0)})},V4R=function(x){for(var S,Z=g.v(x.additionalMetadatas),k=Z.next();!k.done;k=Z.next())k=k.value,k.offlineMusicVideoData&&(S=k.offlineMusicVideoData);
var e,u,C,L,c;return{id:g.S5(x.videoId,"musicTrack"),videoId:x.videoId,title:x.title,thumbnailDetails:x.thumbnail,lengthMs:String(Number(x.lengthSeconds)*1E3),albumTitle:(e=S)==null?void 0:e.releaseTitle,musicVideoType:(u=S)==null?void 0:u.musicVideoType,contentRating:{explicitType:(C=S)==null?void 0:C.explicitType},artistNames:((L=S)==null?void 0:L.byline)||((c=S)==null?void 0:c.channelName),downloadMetadata:g.S5(x.videoId,"musicTrackDownloadMetadataEntity")}},EhR=function(x,S,Z){var k,e,u,C,L,c,
J,X,a,F,q,d,W,I,f,Q,n,b;
return g.V(function(h){k=[];e=new Set;if((u=Z)==null?0:(C=u.downloadedTracks)==null?0:C.length)for(L=g.v(Z.downloadedTracks),c=L.next();!c.done;c=L.next())J=c.value,e.add(J);if(x.tracks){X=g.v(x.tracks);for(a=X.next();!a.done;a=X.next())F=a.value,e.has(F)||k.push(F);q=g.v(S);for(d=q.next();!d.done;d=q.next())if(W=d.value,W.id!==x.id&&(I=W.tracks))for(f=g.v(I),Q=f.next();!Q.done;Q=f.next())n=Q.value,b=k.indexOf(n),b!==-1&&k.splice(b,1)}return h.return(k)})},f$J=function(x,S){var Z,k,e,u,C,L,c,J;
return g.V(function(X){Z=T6(x.thumbnailDetails);k=g.v(S);for(e=k.next();!e.done;e=k.next())if(u=e.value,u.id!==x.id)for(C=g.v(T6(u.thumbnailDetails)),L=C.next();!L.done;L=C.next())c=L.value,J=Z.indexOf(c),J!==-1&&Z.splice(J,1);return X.return(Z)})},nhx=function(x,S){var Z,k,e,u,C,L,c,J,X;
return g.V(function(a){if(a.S==1)return Z=g.S5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.B(a,$i(x,Z,"musicDownloadsLibraryEntity"),2);(k=a.Y)||(k={id:Z});e=g.xl(S).entityType;e==="musicTrack"?(u=k.downloadedTracks)!=null&&u.includes(S)||(k.downloadedTracks=((C=k.downloadedTracks)!=null?C:[]).concat(S)):e==="musicPlaylist"?(L=k.downloadedPlaylists)!=null&&L.includes(S)||(k.downloadedPlaylists=((c=k.downloadedPlaylists)!=null?c:[]).concat(S)):e!=="musicAlbumRelease"||(J=k.downloadedAlbumReleases)!=
null&&J.includes(S)||(k.downloadedAlbumReleases=((X=k.downloadedAlbumReleases)!=null?X:[]).concat(S));return g.B(a,p5(x,k,"musicDownloadsLibraryEntity"),0)})},Kk$=function(x,S){var Z,k,e,u,C,L,c;
return g.V(function(J){if(J.S==1)return Z=g.S5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.B(J,$i(x,Z,"musicDownloadsLibraryEntity"),2);k=J.Y;if(!k)return J.OT(0);e=g.xl(S).entityType;e==="musicTrack"?u=k.downloadedTracks:e==="musicPlaylist"&&(u=k.downloadedPlaylists);if((C=u)==null?0:C.length)for(L=0;L<u.length;L++)if(c=u[L],c===S){u.splice(L,1);break}return g.B(J,p5(x,k,"musicDownloadsLibraryEntity"),0)})},Gym=function(x){var S=x.videos;
x=[];var Z=[];if(S){S=g.v(S);for(var k=S.next();!k.done;k=S.next()){var e=k.value.offlineVideoData.videoId;k=g.S5(e,"musicTrack");e=g.S5(e,"musicTrackDownloadMetadataEntity");x.push(k);Z.push(e)}}return{t5:x,NI:Z}},Ei=function(x,S,Z){S={track:V4R(S)};
Z&&(S.playlistId=Z);if(x=g.H(x.actionMetadata,bgR))S.maximumDownloadQuality=x.maximumDownloadQuality;return{musicTrackEntityActionMetadata:S}},ohS=function(x){var S,Z,k,e,u,C,L,c;
return g.V(function(J){switch(J.S){case 1:return S=g.yA(),Z=bRH(x),k=g.Ze(mhH),g.Nc(J,2),u={pz:!0},g.B(J,g.Ox(S,Z,k,void 0,u),4);case 4:e=J.Y;g.f4(J,3);break;case 2:C=g.EO(J);if(C instanceof g.MC)throw L="GetOffline network manager error: "+C.message,ec(L,C),Error(L);ec("GetOffline fetch request error",C);throw Error("GetOffline fetch request error");case 3:c=BL(e);if(!e)throw ec("Network request failed"),Error("Network request failed");if(c!==void 0)V4(c);else if(!e.videos||!e.videos.length)throw ec("No data"),
Error("No data");return J.return(e.videos.map(function(X){return X.offlineVideoData}))}})},Ogn=function(x){var S,Z,k,e,u,C,L,c;
return g.V(function(J){switch(J.S){case 1:return S=g.yA(),Z=mTh(x),k=g.Ze(mhH),g.Nc(J,2),u={pz:!0},g.B(J,g.Ox(S,Z,k,void 0,u),4);case 4:e=J.Y;g.f4(J,3);break;case 2:C=g.EO(J);if(C instanceof g.MC)throw L="GetOffline network manager error for playlist: "+C.message,ec(L,C),Error(L);ec("GetOffline fetch request error for playlist",C);throw Error("GetOffline fetch request error for playlist");case 3:c=BL(e);if(!e)throw ec("Network request failed for playlist"),Error("Network request failed for playlist");
if(c!==void 0)V4(c,"playlist");else if(!e.playlists||!e.playlists.length)throw ec("No data for playlist"),Error("No data for playlist");return J.return(e.playlists.map(function(X){return X.offlinePlaylistData}))}})},Hgs=function(x,S,Z,k){var e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b,h,l,A,kb,cx,eQ,aq,SQ,Wx,ly,Xv,J$,hg;
return g.V(function(VR){switch(VR.S){case 1:return g.B(VR,Sc(),2);case 2:e=VR.Y;if(!e)return VR.return([]);u=[];if((C=k)==null?0:C.length){u=k;VR.OT(3);break}return g.B(VR,xq(e,"mainPlaylistEntity"),4);case 4:u=VR.Y;case 3:if(!u.length)return VR.return([]);L=[];c=Date.now()/1E3;J=g.v(u);X=J.next();case 5:if(X.done)return L.length?g.B(VR,h9n(L),10):VR.return([]);a=X.value;if(!a.downloadState){F=void 0;VR.OT(8);break}return g.B(VR,$i(e,a.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:F=
VR.Y;case 8:q=F;d=void 0;I=(W=(d=a)==null?void 0:d.entityMetadata)&&W.nextAutoRefreshIntervalSeconds?Number(W.nextAutoRefreshIntervalSeconds):NaN;f=Number.isNaN(I)?x:I;n=Q=void 0;b=((Q=q)==null?0:Q.lastSyncedTimestampMillis)?Number((n=q)==null?void 0:n.lastSyncedTimestampMillis)/1E3:0;l=h=void 0;A=((h=q)==null?0:h.addedTimestampMillis)?Number((l=q)==null?void 0:l.addedTimestampMillis)/1E3:0;if(Z||!W||b+f<=c){kb=[];cx=void 0;if((cx=a.videos)==null?0:cx.length)for(eQ=g.v(a.videos),aq=eQ.next();!aq.done;aq=
eQ.next())SQ=aq.value,Wx=JSON.parse(g.xl(SQ).entityId),Wx.videoId&&kb.push(Wx.videoId);ly="0";W&&(Xv=void 0,ly=String(Number((Xv=W.offlineLastModifiedTimestampSeconds)!=null?Xv:0).toFixed()));J$={playlistId:a.playlistId,videoIds:kb,offlineLastModifiedTimestamp:ly,autoSync:S,offlineDateAddedTimestamp:String(A.toFixed())};L.push(J$)}X=J.next();VR.OT(5);break;case 10:return hg=VR.Y,VR.return(hg)}})},Uht=function(){var x,S,Z,k,e;
return g.V(function(u){if(u.S==1)return g.B(u,Sc(),2);if(u.S!=3)return(x=u.Y)?g.B(u,xq(x,"refresh"),3):u.return(!1);S=u.Y;if((Z=S[0])==null||!Z.refreshTime)return u.return(!1);k=Number(S[0].refreshTime);e=Date.now()/1E3;return u.return(isFinite(k)&&e>=k)})},R9m=function(x,S){var Z,k,e;
return g.V(function(u){switch(u.S){case 1:return g.Nc(u,2),g.B(u,AtR(x,S),4);case 4:return k=u.Y,g.B(u,Y4h(k),5);case 5:Z=Ni9(k);g.f4(u,3);break;case 2:e=g.EO(u),ec("getAndProcessSmartDownloadsResponse request or processing error",e);case 3:return u.return(Z)}})},wZh=function(x,S,Z,k){var e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b,h,l,A,kb,cx,eQ,aq,SQ,Wx,ly,Xv,J$,hg;
return g.V(function(VR){switch(VR.S){case 1:return g.B(VR,Sc(),2);case 2:e=VR.Y;if(!e)return VR.return([]);u=[];if((C=k)==null?0:C.length){u=k;VR.OT(3);break}return g.B(VR,xq(e,"musicPlaylist"),4);case 4:u=VR.Y;case 3:if(!u.length)return VR.return([]);L=[];c=Date.now()/1E3;J=g.v(u);X=J.next();case 5:if(X.done)return L.length?g.B(VR,h9n(L),10):VR.return([]);a=X.value;F=void 0;d=(q=(F=a)==null?void 0:F.entityMetadata)&&q.nextAutoRefreshIntervalSeconds?Number(q.nextAutoRefreshIntervalSeconds):NaN;W=
Number.isNaN(d)?x:d;f=I=0;Q="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!a.downloadMetadata){VR.OT(8);break}return g.B(VR,$i(e,a.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:n=VR.Y,h=b=void 0,I=Number((h=(b=n)==null?void 0:b.addedTimestampMillis)!=null?h:"0")/1E3,A=l=void 0,f=Number((A=(l=n)==null?void 0:l.lastModifiedTimestampMillis)!=null?A:"0")/1E3,cx=kb=void 0,Q=(cx=(kb=n)==null?void 0:kb.syncState)!=null?cx:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:eQ=void 0;if(Z||Q!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!q||Number((eQ=q.lastSyncedTimestampSeconds)!=null?eQ:0)+W<=c){aq=[];SQ=void 0;if((SQ=a.tracks)==null?0:SQ.length)for(Wx=g.v(a.tracks),ly=Wx.next();!ly.done;ly=Wx.next())Xv=ly.value,aq.push(g.xl(Xv).entityId);J$={playlistId:a.playlistId,videoIds:aq,offlineLastModifiedTimestamp:String(f.toFixed()),autoSync:S,offlineDateAddedTimestamp:String(I.toFixed())};L.push(J$)}X=J.next();VR.OT(5);break;case 10:return hg=VR.Y,VR.return(hg)}})},AtR=function(x,S){var Z,k,e,u,C,L,c,J,X,a;
return g.V(function(F){switch(F.S){case 1:return Z=g.yA(),g.B(F,Sc(),2);case 2:k=F.Y;if(!k){F.OT(3);break}return g.B(F,Rn$(k),4);case 4:e=F.Y;case 3:var q=e;u={context:g.xJ(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:x},offlineClientState:q,clientStateRequestData:{preferredFormatType:S}}}};C=g.Ze(Dhb);g.Nc(F,5);c={pz:!0};return g.B(F,g.Ox(Z,u,C,void 0,c),7);case 7:L=F.Y;g.f4(F,6);break;case 5:J=g.EO(F);if(J instanceof g.MC)throw X=
"DPS network manager error for smart downloads: "+J.message,ec(X,J),Error(X);ec("DPS fetch request error for smart downloads",J);throw Error("DPS fetch request error for smart downloads");case 6:a=BL(L);if(L)a!==void 0&&V4(a,"smart downloads");else throw ec("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return F.return(L)}})},ghs=function(x,S){var Z,k,e,u,C,L,c,J;
return g.V(function(X){switch(X.S){case 1:return Z=g.yA(),k={context:g.xJ(),videoPlaybackPositionEntities:x,lastSyncTimestampUsec:S},e=g.Ze(M49),g.Nc(X,2),C={pz:!0},g.B(X,g.Ox(Z,k,e,void 0,C),4);case 4:u=X.Y;g.f4(X,3);break;case 2:L=g.EO(X);if(L instanceof g.MC)throw c="VPPS network manager error: "+L.message,ec(c,L),Error(c);ec("VPPS fetch request error",L);throw Error("VPPS fetch request error");case 3:J=BL(u);if(u)J!==void 0&&V4(J,"position sync");else throw ec("Network request failed for position sync"),
Error("Network request failed for position sync");return X.return(u)}})},ytv=function(x,S,Z){var k,e,u,C,L,c,J,X;
return g.V(function(a){switch(a.S){case 1:k=g.yA();var F=Z.refreshData,q=Z.isEnqueuedForExpiredStreamUrlRefetch,d=Z.YE,W=Z.offlineSourceData,I=Z.mediaCapabilities,f={entityKey:x};F&&(f.refreshData=F);q&&(f.isExpiredStreamUrlRefetch=q);d&&(f.downloadParameters=d);W&&(f.offlineSourceData=W);F={context:g.Qv(S),signatureTimestamp:20347,videos:[f]};I&&(F.mediaCapabilities=I);e=F;u=g.Ze(l$x);g.Nc(a,2);L={pz:!0};return g.B(a,g.Ox(k,e,u,void 0,L),4);case 4:C=a.Y;g.f4(a,3);break;case 2:c=g.EO(a);if(c instanceof
g.MC)throw J="GetPDE network manager error: "+c.message,ec(J,c),Error(J);ec("GetPDE fetch request error",c);throw Error("GetPDE fetch request error");case 3:X=BL(C);if(C)X!==void 0&&V4(X,"PDE");else throw ec("Network request failed for PDE"),Error("Network request failed for PDE");return a.return(C)}})},BL=function(x){var S;
return(S=x.errorMetadata)==null?void 0:S.status},V4=function(x,S){S=S?" for "+S:"";
if(x===0)throw x="Empty response body"+S,ec(x),Error(x);x="Response with error"+S;ec(x);throw Error(x);},h9n=function(x){var S,Z,k,e,u,C,L,c;
return g.V(function(J){switch(J.S){case 1:return S=g.yA(),Z=o0$(x),k=g.Ze(pZH),g.Nc(J,2),u={pz:!0},g.B(J,g.Ox(S,Z,k,void 0,u),4);case 4:e=J.Y;g.f4(J,3);break;case 2:C=g.EO(J);if(C instanceof g.MC)throw L="offlinePlaylistSyncCheck network manager error: "+C.message,ec(L,C),Error(L);ec("offlinePlaylistSyncCheck fetch request error",C);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:c=BL(e);if(!e)throw ec("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(c!==void 0)V4(c,"playlist sync");else if(!e.offlinePlaylistSyncCheckDatas||!e.offlinePlaylistSyncCheckDatas.length)throw ec("No data for playlist sync"),Error("No data for playlist sync");return J.return(e.offlinePlaylistSyncCheckDatas.map(function(X){return X.offlinePlaylistSyncCheckData}))}})},ns=function(x){this.S=x},$hv=function(x,S){var Z,k,e,u,C,L;
return g.V(function(c){switch(c.S){case 1:Z=new Map,k=g.v(S),e=k.next();case 2:if(e.done){c.OT(4);break}u=e.value;C=Z;L=C.set;return g.B(c,x.Y(u),5);case 5:L.call(C,u,c.Y);e=k.next();c.OT(2);break;case 4:return c.return(Z)}})},Ks=function(x,S,Z,k,e,u){S=g.S5(S,Z);
k=Object.assign({},u,{priority:k,retryScheduleIntervalsInSeconds:e});return{actionType:x,entityKey:S,actionMetadata:k}},G6=function(x,S,Z,k,e,u){this.status=x;
this.S=S;this.G=Z;this.Y=k;this.D=e;this.downloadState=u},xXh=function(x,S,Z){this.S=x;
this.Sy=S;this.D=Z},Z$$=function(x,S){var Z,k,e,u,C,L,c,J,X;
return g.V(function(a){switch(a.S){case 1:return Z=S.entityKey,e=(k=g.H(S.actionMetadata,bg))==null?void 0:k.isEnqueuedForExpiredStreamUrlRefetch,g.Nc(a,2),u=void 0,g.B(a,Sgn(x,S),4);case 4:u=a.Y;g.Nc(a,5);var F=(F=g.H(S.actionMetadata,bg))?{maximumDownloadQuality:F.maximumDownloadQuality}:void 0;return g.B(a,ytv(Z,x.Sy,{isEnqueuedForExpiredStreamUrlRefetch:e,YE:F,offlineSourceData:u}),7);case 7:C=a.Y;g.f4(a,6,2);break;case 5:return g.EO(a,2),L=JL(S)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",ec("PDE handleAdd error"),a.return(mH(S,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",L,"DOWNLOAD_STATE_FAILED"));case 6:return g.B(a,j3J(x,C,S),8);case 8:return a.return(mH(S,!0,C.orchestrationActions));case 2:return c=g.EO(a),J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.Ff&&c.type==="QUOTA_EXCEEDED"&&(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ec("PDE handleAdd error"),a.return(mH(S,!1,void 0,J,X,"DOWNLOAD_STATE_FAILED"))}})},uLn=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b,h,l,A,kb,cx;
return g.V(function(eQ){switch(eQ.S){case 1:return Z=S.entityKey,k=g.xl(Z).entityId,g.B(eQ,y9(x.S,{mode:"readonly",tS:!0},function(aq){var SQ=AB(aq,Z,"playbackData"),Wx=AB(aq,g.S5(k,"offlineVideoPolicy"),"offlineVideoPolicy");aq=AB(aq,g.S5(k,"transfer"),"transfer");return g.WR.all([SQ,Wx,aq])}),2);
case 2:e=eQ.Y;u=g.v(e);C=u.next().value;L=u.next().value;c=u.next().value;J=C;X=L;a=c;if(!J||!X)return eQ.return(mH(S,!0));F=[];W=((d=J)==null?0:d.playerResponseJson)?JSON.parse(J.playerResponseJson):null;if(!(a&&W&&x.Sy.Z("html5_refresh_deprecated_downloads"))){eQ.OT(3);break}q=kcv(x,W,a);return g.B(eQ,eqR(x,a),4);case 4:F=eQ.Y;case 3:I={lastPlayerResponseTimestampSeconds:J.playerResponseTimestamp,offlineToken:X.offlineToken,formatIds:F};f={};if((Q=a)==null?0:Q.maximumDownloadQuality)f.maximumDownloadQuality=
a.maximumDownloadQuality;g.Nc(eQ,5);n=void 0;return g.B(eQ,Sgn(x,S),7);case 7:return n=eQ.Y,g.Nc(eQ,8),g.B(eQ,ytv(Z,x.Sy,{refreshData:I,YE:f,offlineSourceData:n,mediaCapabilities:q}),10);case 10:b=eQ.Y;g.f4(eQ,9,5);break;case 8:return g.EO(eQ,5),h=JL(S)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",ec("PDE handleRefresh error"),eQ.return(mH(S,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",h,
"DOWNLOAD_STATE_FAILED"));case 9:return g.B(eQ,j3J(x,b,S),11);case 11:return eQ.return(mH(S,!0,b.orchestrationActions));case 5:return l=g.EO(eQ),A="PDE handleRefresh error",l instanceof Error&&(A="PDE handleRefresh error: "+l.message),kb="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",cx="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.Ff&&l.type==="QUOTA_EXCEEDED"&&(kb="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",cx="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
ec(A),eQ.return(mH(S,!1,void 0,kb,cx,"DOWNLOAD_STATE_FAILED"))}})},Sgn=function(x,S){var Z,k,e,u;
return g.V(function(C){if(C.S==1)return Z=g.xl(S.entityKey).entityId,k=g.S5(Z,"videoDownloadContextEntity"),g.B(C,$i(x.S,k,"videoDownloadContextEntity"),2);e=C.Y;return(u=e)!=null&&u.offlineModeType?C.return({offlineModeType:e.offlineModeType}):C.return(void 0)})},j3J=function(x,S,Z){var k,e,u,C,L;
return g.V(function(c){if(c.S==1){if(!S.frameworkUpdates||!g.H(S.frameworkUpdates,rM))return c.return();if(!(g.H(S.frameworkUpdates,rM).mutations&&g.H(S.frameworkUpdates,rM).mutations.length>0&&g.H(S.frameworkUpdates,rM).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return c.OT(2);k=g.xl(g.H(S.frameworkUpdates,rM).mutations[0].entityKey).entityId;return g.B(c,ig(x.S,k),3)}if(c.S!=2){e=c.Y;u=g.H(Z.actionMetadata,bg);if(L=(C=u)==null?void 0:C.playlistId)e.playlistId=L;e.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.iA(x.Sy)?g.B(c,NP(k,x.S,Z,x.D,e),2):g.o4(x.Sy)?g.B(c,Q4(k,x.S,Z,x.D),2):c.OT(2)}return g.B(c,sTS(g.H(S.frameworkUpdates,rM)),0)})},mH=function(x,S,Z,k,e,u){return new G6(S?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",JL(x),Z,k,e,u)},kcv=function(x,S,Z){S=a$R(x.Sy,Z.cotn,S);
Z=g.mK(S);return g.mmQ(S,Z,x.Sy)},eqR=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F;
return g.V(function(q){if(q.S==1)return Z=[],g.B(q,y9(x.S,{mode:"readonly",tS:!0},function(d){var W=[],I=S.offlineVideoStreams;if(I){I=g.v(I);for(var f=I.next();!f.done;f=I.next())W.push(AB(d,f.value,"offlineVideoStreams"))}return g.WR.all(W)}),2);
if(k=q.Y)for(e=g.v(k),u=e.next();!u.done;u=e.next())if(C=u.value,L=void 0,(L=C)==null?0:L.streamsProgress)for(c=C.streamsProgress,J=0;J<c.length;J++)X=c[J],a=JSON.parse(X.formatStreamBytes),F={itag:a.itag,lmt:a.lastModified,xtags:a.xtags},Z.push(F);return q.return(Z)})},C$H=function(x,S){this.S=x;
this.Sy=S},thR=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q;
return g.V(function(d){switch(d.S){case 1:return Z=JL(S),g.B(d,xq(x.S,"videoPlaybackPositionEntity"),2);case 2:k=d.Y;if(k.length===0)return d.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z));g.Nc(d,3);return g.B(d,hB.getInstance(),5);case 5:e=d.Y;if(!e)throw Error("prefStorage is undefined");return g.B(d,e.get("psi"),6);case 6:return u=d.Y,c=(L=(C=u)==null?void 0:C.Bs)!=null?L:"0",g.B(d,ghs(k,c),7);case 7:return J=d.Y,X={isPaused:J.watchHistoryPaused,Bs:J.syncTimestampUsec},g.B(d,e.set("psi",
X),8);case 8:if(X.isPaused){d.OT(9);break}a=g.H(J.frameworkUpdates,rM);if(!J.frameworkUpdates||!a){d.OT(9);break}return g.B(d,sTS(a),9);case 9:g.f4(d,4);break;case 3:return F=g.EO(d),q="PPE handleRefresh error: "+(F instanceof Error?F.message:"unknown error"),ec(q),d.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return d.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Z))}})},cC9=function(x,S){var Z,k,e,u,C,L,c,J;
return g.V(function(X){switch(X.S){case 1:return Z=JL(S),k=g.xl(S.entityKey).entityId,g.Nc(X,2),g.B(X,hB.getInstance(),4);case 4:e=X.Y;if(!e)throw Error("prefStorage is undefined");return g.B(X,e.get("psi"),5);case 5:u=X.Y;C=g.H(S.actionMetadata,LgH);if(((L=u)==null?void 0:L.isPaused)!==!1||(c=C)==null||!c.lastPlaybackPositionSeconds){X.OT(6);break}J={key:g.S5(k,"videoPlaybackPositionEntity"),videoId:k,lastPlaybackPositionSeconds:C.lastPlaybackPositionSeconds};return g.B(X,p5(x.S,J,"videoPlaybackPositionEntity"),
6);case 6:g.f4(X,3);break;case 2:return g.EO(X),X.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z))}})},JCv=function(x,S){var Z,k,e;
return g.V(function(u){switch(u.S){case 1:Z=JL(S);g.Nc(u,2);k=g.xl(S.entityKey).entityId;if(k==="!*$_ALL_ENTITIES_!*$")return g.B(u,IPn(x.S),5);e=g.S5(k,"videoPlaybackPositionEntity");return g.B(u,YRH(x.S,e),5);case 5:g.f4(u,3);break;case 2:return g.EO(u),u.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return u.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Z))}})},X8n=function(x,S){this.api=x;
this.S=S;this.logger=new g.Y4("woffle");this.Y=!1;this.S2={gR:this.gR}},aCt=function(x){return g.V(function(S){return S.return(G2R(x))})},FgS=function(x){var S;
return g.V(function(Z){if(Z.S==1)return g.B(Z,g.kMS(x),2);S=Z.Y;return Z.return(S.filter(function(k){return!!k.url}).map(function(k){return k.url}))})},of=function(x,S){var Z=g.CT(S);
if(Z===1||Z===0)return Promise.resolve();(Z=qgH(x,S))&&Z.stopVideo();x.D=0;return aCt(S)},Oi=function(x,S,Z,k){Z=Z===void 0?!1:Z;
k=k===void 0?!0:k;S=typeof S==="string"?S:S.videoDetails.videoId;if(g.CT(S)===2){var e=qgH(x,S);e&&e.stopVideo();g.t_(S,2);x.D=2;Z?dXR(x.S):k&&zqH(x.S)}},qgH=function(x,S){var Z;
return((Z=x.player)==null?void 0:Z.getVideoData().videoId)===S?x.player:null},TpS=function(x,S){this.S=x;
this.Sy=S},vNm=function(x,S){var Z,k;
return g.V(function(e){switch(e.S){case 1:return Z=JL(S),g.B(e,$i(x.S,S.entityKey,"transfer"),2);case 2:if(k=e.Y)return e.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z));g.Nc(e,3);return g.B(e,P$h(x,S),5);case 5:g.f4(e,4);break;case 3:return g.EO(e),e.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return e.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Z))}})},Wgn=function(x,S){var Z,k;
return g.V(function(e){switch(e.S){case 1:return Z=JL(S),g.B(e,$i(x.S,S.entityKey,"transfer"),2);case 2:k=e.Y;if(!k||k.transferState!=="TRANSFER_STATE_COMPLETE")return e.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z));g.Nc(e,3);return g.B(e,P$h(x,S,!0),5);case 5:g.f4(e,4);break;case 3:return g.EO(e),e.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return e.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z))}})},Ygt=function(x,S){var Z,k,e,u,C,L,c,J,X,a;
return g.V(function(F){switch(F.S){case 1:return Z=JL(S),k=g.xl(S.entityKey).entityId,g.B(F,y9(x.S,{mode:"readonly",tS:!0},function(q){var d=AB(q,S.entityKey,"transfer");q=AB(q,g.S5(k,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.WR.all([d,q])}),2);
case 2:e=F.Y;u=g.v(e);C=u.next().value;L=u.next().value;c=C;J=L;if(!c||c.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return F.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z));g.Nc(F,3);c.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.B(F,p5(x.S,c,"transfer"),5);case 5:X=g.xl(c.key).entityId;CCR({videoId:X,X8:c,offlineModeType:(a=J)==null?void 0:a.offlineModeType});g.f4(F,4);break;case 3:return g.EO(F),F.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
Z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return F.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z))}})},P$h=function(x,S,Z){Z=Z===void 0?!1:Z;
var k,e,u,C,L,c,J,X,a,F,q,d,W,I,f;return g.V(function(Q){switch(Q.S){case 1:return k=g.H(S.actionMetadata,ICv),e=g.xl(S.entityKey).entityId,u=g.S5(e,"downloadStatusEntity"),g.B(Q,y9(x.S,{mode:"readonly",tS:!0},function(n){var b=AB(n,u,"downloadStatusEntity");n=AB(n,g.S5(e,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.WR.all([b,n])}),2);
case 2:return C=Q.Y,L=g.v(C),c=L.next().value,J=L.next().value,X=c,a=J,F="TRANSFER_STATE_TRANSFER_IN_QUEUE",((q=X)==null?void 0:q.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(F="TRANSFER_STATE_PAUSED_BY_USER"),I={key:S.entityKey,transferState:F,cotn:g.PS(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(d=k)==null?void 0:d.maximumDownloadQuality,preferredAudioTrack:(W=k)==null?void 0:W.preferredAudioTrack,transferRetryCount:0,isRefresh:Z,hasLoggedFirstStarted:!1},g.B(Q,y9(x.S,
{mode:"readwrite",tS:!0},function(n){var b=[];Z&&b.push(M0(n,g.S5(e,"offlineVideoStreams")));b.push(D6(n,I,"transfer"));return g.WR.all(b)}),3);
case 3:if(!Z){Q.OT(4);break}return g.B(Q,aCt(e),4);case 4:e9m({videoId:e,X8:I,offlineModeType:(f=a)==null?void 0:f.offlineModeType}),g.Iq(Q)}})},rC9=function(x,S,Z,k){if(!x.action.entityKey)throw Error("entityKey is missing.");
var e=g.xl(x.action.entityKey);e={entityType:e.bf,entityId:e.entityId,offlineOrchestrationActionType:x.action.actionType,orchestrationAction:{orchestrationActionId:x.actionId}};S&&(e.offlineOrchestrationActionResult=S.status,e.isRetryable=Z?!1:S.S,S.D&&(e.offlineOrchestrationFailureReason=Npt(S.D,e.isRetryable)));var u,C;if((u=x.action.actionMetadata)==null?0:(C=u.offlineLoggingData)==null?0:C.offlineModeType)e.offlineModeType=x.action.actionMetadata.offlineLoggingData.offlineModeType;k&&(e.additionalOrchestrationActions=
k.map(function(L){return{orchestrationActionId:L.actionId}}));
return e},Npt=function(x,S){return x!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||S?x==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&S?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":x:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},i$9=function(x,S){var Z={offlineOrchestrationContext:rC9(x)};
S=UTH(S,Z);Az9(HRJ(),S,x.rootActionId)},Q3R=function(x,S,Z,k){k=k===void 0?[]:k;
S={offlineOrchestrationContext:rC9(x,S,Z,k)};S=UTH(3,S);Az9(HRJ(),S,x.rootActionId)},s3m=function(){this.actions=[]},fCH=function(x,S){S=g.v(S);
for(var Z=S.next();!Z.done;Z=S.next())Z=Z.value,i$9(Z,1),x.actions.push(Z);x.actions.sort(x.S)},ENb=function(x,S){if(S)for(var Z=0;Z<x.actions.length;Z++)if(S==="!*$_ALL_ENTITIES_!*$"&&x.actions[Z].actionId!==S||S!=="!*$_ALL_ENTITIES_!*$"&&x.actions[Z].rootActionId===S&&x.actions[Z].actionId!==S)x.actions.splice(Z,1),Z--},Bpm=function(x,S){x=g.v(x.actions);
for(var Z=x.next();!Z.done;Z=x.next())if(Z.value.actionId===S)return!0;return!1},hL=function(x,S,Z,k,e){g.m.call(this);
var u=this;this.Y=x;this.yN=S;this.DG=Z;this.N=k;this.Sy=e;this.S=new s3m;this.L=new g.Ay;this.D=new g.xN(function(){u.retry()});
this.X=NaN;this.B=!1;this.S2={LGG:function(){return u.S},
N7:function(){return u.L},
wjm:function(){return u.D},
retry:function(){return u.retry()}};
g.O(this,this.D);this.j=this.Y.observe(this.GS.bind(this))},Kgb=function(x,S,Z,k,e){var u;
return g.V(function(C){if(C.S==1)return u=new hL(x,S,Z,k,e),g.B(C,Vhx(u),2);nNn(u);return C.return(u)})},nNn=function(x){var S=x.S.actions[0];
return x.G?((S==null?void 0:S.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&x.G[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(x.B=!0),Promise.resolve()):Gch(x)},Gch=function(x){var S,Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I,f;
return g.V(function(Q){switch(Q.S){case 1:if(x.G)throw Error("Already processing an action");if(x.Jg())return Q.return();S=x.S.actions.shift();ZgR(x.DG,!S);if(S===void 0)return Q.return();S.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&S.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&ENb(x.S,S.actionId);Z="";S.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&S.rootActionId===S.actionId&&(Z=S.actionId);k=[S];x.G=k;if(e=x.yN[S.entityType]){Q.OT(2);break}x.G=
void 0;return g.B(Q,Gch(x),3);case 3:return Q.return();case 2:u=g.v(k);for(C=u.next();!C.done;C=u.next())L=C.value,i$9(L,2);g.Nc(Q,4,5);return g.B(Q,$hv(e,k.map(function(n){return n.action})),7);
case 7:c=Q.Y,J=g.v(k),X=J.next();case 8:if(X.done){Q.OT(10);break}a=X.value;F=c.get(a.action);return g.B(Q,b$h(x,a,F),9);case 9:X=J.next();Q.OT(8);break;case 10:ENb(x.S,Z);case 5:g.n4(Q);x.G=void 0;g.K4(Q,6);break;case 4:return q=g.EO(Q),ec("Orchestration error",q),g.Nc(Q,12),g.B(Q,mXS(x,k),14);case 14:g.f4(Q,5);break;case 12:d=g.EO(Q);ec("Orchestration retry error",d);W=g.v(k);for(I=W.next();!I.done;I=W.next())f=I.value,f.retryScheduleIndex<3&&fCH(x.S,[f]);Q.OT(5);break;case 6:return g.B(Q,Gch(x),
0)}})},b$h=function(x,S,Z){var k,e,u,C,L,c,J,X,a,F,q,d;
return g.V(function(W){switch(W.S){case 1:k=S.retryScheduleIndex+2===3;if(Z.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){W.OT(2);break}if(Z.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){W.OT(0);break}Q3R(S,Z,k);if(Z.S&&S.retryScheduleIndex+1<3)return g.B(W,mXS(x,[S]),0);u=((e=Z)==null?0:e.Y)?Z.Y:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";C={entityKey:S.action.entityKey,failureReason:u};L=void 0;g.iA(x.Sy)?L="mainVideoDownloadStateEntity":g.o4(x.Sy)&&(L="musicTrackDownloadMetadataEntity");
if(!L||!Z.downloadState){W.OT(7);break}c=g.xl(S.action.entityKey).entityId;return g.B(W,qP(c,L,x.Y,Z.downloadState),7);case 7:Cs(x.N,C);if(Z.downloadState==="DOWNLOAD_STATE_FAILED"&&x.Sy.Z("html5_auto_retry_failed_pde_actions")){W.OT(0);break}ec("Orchestration result is not retryable, deleting action");return g.B(W,YRH(x.Y,WL(S).key),0);case 2:J=void 0;try{J=(X=Z.G)==null?void 0:X.map(function(I){return x.createAction(I,S)})}catch(I){return Q3R(S,Z,k),a={entityKey:S.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Cs(x.N,a),ec("Orchestration subactions creation error",I),W.return()}Q3R(S,Z,k,J);if(!J){W.OT(12);break}F=J.map(function(I){return WL(I)});
q=0;case 13:if(!(q<J.length)||x.B){W.OT(15);break}return g.B(W,y9(x.Y,{mode:"readwrite",tS:!0},function(I){var f=[];f.push(X39(I,F.slice(q,q+10),"offlineOrchestrationActionWrapperEntity"));return g.WR.all(f)}),16);
case 16:q+=10;W.OT(13);break;case 15:if(x.B)return x.B=!1,W.return();case 12:return d=WL(S),g.B(W,YRH(x.Y,d.key),17);case 17:i$9(S,4),g.Iq(W)}})},H$v=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q;
return g.V(function(d){Z=[];k=Infinity;e=4E3;u=g.v(S);for(C=u.next();!C.done;C=u.next())L=C.value,c=Number(L.enqueueTimeSec),J=oNR(c),X=L.retryScheduleIndex,a=X!=null&&X>0,J>0&&a?(k=Math.min(k,c),e=Math.min(J,e)):Z.push(L);isFinite(k)&&(!x.D.isActive()||k<x.X)&&(x.X=k,x.D.start(e));x.L.Ok()||(F=Z.length,Z=Z.filter(function(W){var I;W=((I=W.actionProto)==null?void 0:I.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!O$R.includes(W)}),q=Z.length<F,!x.D.isActive()&&q&&x.D.start(1));
Z.length>0&&hqv(x,Z);return g.B(d,nNn(x),0)})},ACx=function(x){var S,Z,k,e,u,C,L;
return g.V(function(c){if(c.S==1)return g.B(c,UXs(x),2);S=c.Y;Z=[];k=g.v(S);for(e=k.next();!e.done;e=k.next())u=e.value,C=g.xl(u.key),L=C.entityId,Bpm(x.S,L)||Z.push(u);return g.B(c,H$v(x,Z),0)})},oNR=function(x){x=x*1E3-Date.now();
return x>4E3?4E3:x},mXS=function(x,S){var Z,k,e;
return g.V(function(u){Z=g.v(S);for(k=Z.next();!k.done;k=Z.next()){e=k.value;var C=void 0,L=void 0,c=((L=e.action)==null?void 0:(C=L.actionMetadata)==null?void 0:C.retryScheduleIntervalsInSeconds)||[1,2,4];C=1;e.retryScheduleIndex<c.length&&(C=c[e.retryScheduleIndex]);e.S=C*1E3+Date.now();e.retryScheduleIndex++}return g.B(u,Rqn(x,S),0)})},Vhx=function(x){var S;
return g.V(function(Z){if(Z.S==1)return g.B(Z,xq(x.Y,"offlineOrchestrationActionWrapperEntity"),2);S=Z.Y;return g.B(Z,H$v(x,S),0)})},hqv=function(x,S){S.length!==0&&S.forEach(function(Z){Z=vL(Z);
Z.retryScheduleIndex<3&&fCH(x.S,[Z])})},UXs=function(x,S){var Z;
return g.V(function(k){if(k.S==1)return g.B(k,xq(x.Y,"offlineOrchestrationActionWrapperEntity",S),2);Z=k.Y;return k.return(Z.filter(fPR))})},Rqn=function(x,S){if(S.length===0)return Promise.resolve([]);
S=S.map(function(Z){return WL(Z)});
return WXv(x.Y,S)},w8h=function(x){this.ET=x;
this.S=void 0},DXn=function(x,S){var Z,k,e,u;
return g.V(function(C){Z=S.videoId;k=!0;if(S.captionTracks.length)e=jix(S),x.S=new g.QP(x.ET,S,e);else if(S.pY)u=g.J3g(S),x.S=new g.fS(x.ET,S.pY,Z,u,S.d9,S.eventId),k=S.d9;else return C.return();return C.return(new Promise(function(L){var c;(c=x.S)==null||c.p_({U9:function(){return g.V(function(J){if(J.S==1)return g.B(J,x.U9(Z,k),2);L();g.Iq(J)})},
s$:function(){}})}))})},Mhh=function(x){var S;
return g.V(function(Z){if(Z.S==1)return g.B(Z,KXs(x),2);S=Z.Y;return Z.return(!!S&&S.length>0)})},HL=function(x){g.m.call(this);
this.S=x;this.Y=this.S.observe(this.D.bind(this))},gNJ=function(x,S){var Z,k,e,u,C,L,c;
return g.V(function(J){switch(J.S){case 1:if(S.length===0)return J.return([]);Z=S.map(function(X){return g.S5(X,"transfer")});
return g.B(J,xq(x.S,"transfer",Z),2);case 2:k=J.Y;e=k.filter(fPR).map(function(X){return g.xl(X.key).entityId});
u=S.filter(function(X){return e.indexOf(X)===-1});
if(u.length===0)return J.return([]);C=g.v(u);L=C.next();case 3:if(L.done){J.OT(5);break}c=L.value;return g.B(J,aCt(c),4);case 4:L=C.next();J.OT(3);break;case 5:return J.return(u)}})},p8H=function(x,S,Z,k,e,u){var C,L,c;
return g.V(function(J){C="STREAM_TYPE_UNKNOWN";Z.video&&Z.audio?(C="STREAM_TYPE_AUDIO_AND_VIDEO",ec("unexpected stream type")):Z.video&&!Z.audio?C="STREAM_TYPE_VIDEO":!Z.video&&Z.audio&&(C="STREAM_TYPE_AUDIO");L=g.S5(S,"offlineVideoStreams");c={numBytesDownloaded:e.toFixed(),numTotalBytes:u.toFixed(),streamType:C,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(k),itag:C==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(Z.itag):void 0};return g.B(J,y9(x,{mode:"readwrite",tS:!0},
function(X){var a=AB(X,L,"offlineVideoStreams"),F=AB(X,g.S5(S,"transfer"),"transfer");return g.WR.all([a,F]).then(function(q){q=g.v(q);var d=q.next().value;q=q.next().value;if(!q)return M0(X,L).then(function(){});
var W=lCx(d);d=yCv(d,k,c,L);var I=D6(X,d,"offlineVideoStreams");lCx(d)>W&&(q.lastProgressTimeMs=Date.now().toString());W=[I];q.offlineVideoStreams||(q.offlineVideoStreams=[]);q.offlineVideoStreams.indexOf(L)===-1&&(q.offlineVideoStreams.push(L),W.push(D6(X,q,"transfer")));return g.WR.all(W)})}),0)})},$XR=function(x,S){var Z,k,e,u,C;
return g.V(function(L){if(L.S==1)return Z=g.S5(S,"offlineVideoStreams"),g.B(L,$i(x,Z,"offlineVideoStreams"),2);k=L.Y;if(!k||!k.streamsProgress)return L.return();e=g.v(k.streamsProgress);for(u=e.next();!u.done;u=e.next())C=u.value,C.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",C.numTotalBytes!==C.numBytesDownloaded&&(C.numBytesDownloaded=C.numTotalBytes);return g.B(L,p5(x,k,"offlineVideoStreams"),0)})},yCv=function(x,S,Z,k){if(x&&x.streamsProgress){k=x;
a:{S=S.itag+";"+S.xtags;for(var e=x.streamsProgress,u=0;u<e.length;u++){var C=JSON.parse(e[u].formatStreamBytes);if(C.itag+";"+C.xtags===S){e[u]=Z;Z=e;break a}}e.push(Z);Z=e}k.streamsProgress=Z}else x={key:k,streamsProgress:[Z]};return x},lCx=function(x){if(x==null?0:x.streamsProgress){var S=0;
x=x.streamsProgress;for(var Z=0;Z<x.length;Z++){var k=x[Z];isNaN(Number(k.numBytesDownloaded))?ec("stream progress bytes number invalid"):S+=Number(k.numBytesDownloaded)}return S}return 0},xf9=function(x,S,Z,k){g.m.call(this);
var e=this;this.Y=x;this.api=S;this.WU=Z;this.GS=k;this.L=new g.Ay;this.G=new g.xN(function(){e.S&&e.S.transferState==="TRANSFER_STATE_TRANSFERRING"&&e.L.Ok()&&((e.S.transferRetryCount||0)<3?Oi(e.N,e.B,!1,!1):of(e.N,e.B.videoDetails.videoId),e.c7("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.DG=this.Mb=0;this.j=this.X=!1;this.Cy=g.CX(this.api.U().experiments,"html5_transfer_processing_logs_interval");this.Nb=new g.sz(this);this.S2={Utm:function(){return e.G},
T6G:function(){return e.GS},
N7:function(){return e.L}};
this.yN=this.Y.observe(this.i9.bind(this));this.N=new X8n(S,this);this.lr=new w8h(S);this.hg=new HL(this.Y);this.FL=this.L.listen("publicytnetworkstatus-online",this.aK.bind(this));this.R5=this.L.listen("publicytnetworkstatus-offline",this.vWG.bind(this));this.j=this.api.U().Z("html5_less_transfer_processing_logs");g.O(this,this.Nb);this.Nb.W(S,"offlinetransferpause",this.BK5);if(g.iA(this.api.U()))this.D="mainVideoDownloadStateEntity";else if(g.o4(this.api.U())||g.sb(this.api.U()))this.D="musicTrackDownloadMetadataEntity"},
Swv=function(x){return g.V(function(S){if(S.S==1)S=g.B(S,VEn(),2);
else{var Z=x.hg;var k=g.u5();k=Object.keys(k);Z=gNJ(Z,k);S=g.B(S,Z,0)}return S})},AL=function(x,S){S=S===void 0?!1:S;
var Z;return g.V(function(k){if(k.S==1){if(x.S)throw Error("Already downloading a video");x.DG=0;x.X=!1;return g.B(k,jrn(x),2)}return k.S!=4?(Z=k.Y,kyx(x.WU,!Z),Z&&x.L.Ok()?S?g.B(k,new Promise(function(e){g.Pv(e,1E3)}),4):k.OT(4):(!Z&&x.S&&Ui(x),k.OT(0))):g.B(k,ZYh(x,Z),0)})},kgS=function(x){return g.V(function(S){if(S.S==1)return x.B?g.B(S,of(x.N,x.B.videoDetails.videoId),3):S.OT(0);
Ui(x);g.Iq(S)})},ef$=function(x,S){var Z,k,e;
return g.V(function(u){switch(u.S){case 1:return g.Nc(u,2),(Z=!!S.captionTracks.length||!!S.pY)?g.B(u,Mhh(S.videoId),4):u.return();case 4:return(k=u.Y)?u.return():g.B(u,DXn(x.lr,S),5);case 5:g.f4(u,0);break;case 2:e=g.EO(u),ec("Caption downloading error",e,S.cotn),g.Iq(u)}})},ZYh=function(x,S){var Z,k,e,u,C,L;
return g.V(function(c){switch(c.S){case 1:if(x.X)return c.return();x.X=!0;x.S=S;Z=g.xl(x.S.key);k=Z.entityId;e=void 0;if(x.S.transferState==="TRANSFER_STATE_TRANSFERRING")return g.B(c,Rf(x,k),7);if(x.S.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||x.S.transferRetryCount||x.S.hasLoggedFirstStarted){c.OT(3);break}return g.B(c,Rf(x,k),5);case 5:return e=c.Y,x.S.hasLoggedFirstStarted=!0,g.B(c,uXS(x),6);case 6:uxh({videoId:k,X8:x.S,offlineModeType:e},void 0,void 0,!0);c.OT(3);break;case 7:e=c.Y,
cL({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:k,X8:x.S,offlineModeType:e});case 3:return g.B(c,Cdt(x),8);case 8:return u=null,g.Nc(c,9),g.B(c,tfR(x,S),11);case 11:u=c.Y;x.B=u;g.f4(c,10);break;case 9:return C=g.EO(c),ec("error getting player response",C,S.cotn),g.B(c,x.c7("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return c.return();case 10:return L=a$R(x.api.U(),S.cotn,u),g.B(c,ef$(x,L),13);case 13:return g.B(c,FgS(L.videoId),
14);case 14:L.KA=c.Y;var J=x.N,X=L,a=S.maximumDownloadQuality;X.getPlayerResponse();g.t_(X.videoId,2);J.D=2;J.Y=!1;var F;(F=J.player)==null||F.dispose();J.player=J.api.ST(X);X={};J.player.Pb((X.localmediachange=J.b5,X.signatureexpired=J.eP,X.statechange=J.K0r,X),J);J.Z("html5_generate_content_po_token")&&J.player.gt();a=J.gR(a);J.player.pu(g.fo(a,a,!0,"m"),!1);J.player.w6(!1);x.G.start(108E5);g.Iq(c)}})},jrn=function(x){var S,Z;
return g.V(function(k){if(k.S==1)return g.B(k,xq(x.Y,"transfer"),2);S=k.Y;Z=S.filter(LBx).sort(cpm);return Z.length===0?k.return():k.return(Z[0])})},Cdt=function(x){var S,Z,k;
return g.V(function(e){if(e.S==1){if(!x.S)return wM(x,"onTransferStart"),e.return();x.G.start(108E5);return g.B(e,DG(x,"TRANSFER_STATE_TRANSFERRING"),2)}S=x.S;return(k=((Z=S)==null?0:Z.key)?g.xl(S.key).entityId:"")&&x.D?g.B(e,qP(k,x.D,x.Y,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):e.OT(0)})},dXR=function(x){var S,Z,k,e;
g.V(function(u){switch(u.S){case 1:if(!x.S){wM(x,"onTransferPausedByUser");u.OT(2);break}S=x.S;x.G.stop();return g.B(u,DG(x,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:k=((Z=S)==null?0:Z.key)?g.xl(S.key).entityId:"";if(!k||!x.D){u.OT(4);break}return g.B(u,qP(k,x.D,x.Y,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.B(u,Rf(x,k),6);case 6:e=u.Y,t4R({videoId:k,X8:S,offlineModeType:e});case 2:Ui(x),AL(x),g.Iq(u)}})},zqH=function(x){var S,Z,k;
g.V(function(e){if(e.S==1){if(!x.S)return wM(x,"onTransferPausedByNetwork"),e.return();x.G.stop();return g.B(e,DG(x,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(e.S!=3)return S=x.S,(k=((Z=S)==null?0:Z.key)?g.xl(S.key).entityId:"")&&x.D?g.B(e,qP(k,x.D,x.Y,"DOWNLOAD_STATE_PAUSED"),3):e.OT(3);Ui(x);g.Iq(e)})},Jpx=function(x){var S,Z,k,e,u;
g.V(function(C){switch(C.S){case 1:if(!x.S)return wM(x,"onTransferComplete"),C.return();S=x.S;x.G.stop();if(!S||!x.B){C.OT(2);break}Z=a$R(x.api.U(),S.cotn,x.B);return g.B(C,ef$(x,Z),2);case 2:return g.B(C,DG(x,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:e=((k=S)==null?0:k.key)?g.xl(S.key).entityId:"";if(!e||!x.D){C.OT(5);break}return g.B(C,qP(e,x.D,x.Y,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.B(C,$XR(x.Y,e),7);case 7:return g.B(C,Rf(x,e),8);case 8:u=C.Y,cL({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:e,X8:S,offlineModeType:u}),Ui(x),AL(x),g.Iq(C)}})},Xwx=function(x,S,Z){var k,e;
g.V(function(u){switch(u.S){case 1:if(!x.S)return wM(x,"onTransferProgress: "+S),u.return();if(x.S.transferState==="TRANSFER_STATE_TRANSFERRING"){u.OT(2);break}return g.B(u,Cdt(x),2);case 2:k=Date.now();if(!(k-x.Mb>1E3)){u.OT(4);break}x.Mb=k;return g.B(u,p8H(x.Y,Z.videoId,Z.Y,Z.Zx,Z.bytesDownloaded,Z.S),5);case 5:if(x.j&&!(x.j&&k-x.DG>x.Cy)){u.OT(4);break}x.DG=k;return g.B(u,Rf(x,S),7);case 7:e=u.Y,uxh({videoId:S,X8:x.S,offlineModeType:e},Z.bytesDownloaded,Z.S);case 4:x.G.start(108E5),g.Iq(u)}})},
avs=function(x){var S=(x.S.transferRetryCount||0)<3;
S&&(x=x.S,x.transferRetryCount=(x.transferRetryCount||0)+1);return S},FBx=function(x,S){S=S===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":S;
var Z,k,e,u;return g.V(function(C){if(C.S==1)return x.S||wM(x,"setTransferToFailed: "+S),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S==="TRANSFER_FAILURE_REASON_NETWORK"?Z="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":S==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.B(C,DG(x,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",S),2);if(C.S!=3)return Cs(x.GS,{entityKey:(k=x.S)==null?void 0:k.key,failureReason:Z}),
e=x.S?g.xl(x.S.key).entityId:"",g.B(C,Rf(x,e),3);u=C.Y;var L={videoId:e,X8:x.S,offlineModeType:u},c=S,J={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};c&&(J.transferFailureReason=c,J.failureReason=Lkh(c));cL(J,L);g.Iq(C)})},DG=function(x,S,Z,k){var e;
return g.V(function(u){if(u.S==1){if(!x.S)return wM(x,"saveTransferState: "+S),u.return();x.S.transferState=S;x.S.failureReason=k;g.Nc(u,2);return g.B(u,uXS(x,function(C){return Z?RV(C,"offlineVideoStreams",x.S.offlineVideoStreams).then(function(L){for(var c=g.v(L),J=c.next();!J.done;J=c.next())if((J=J.value)&&J.streamsProgress){J=g.v(J.streamsProgress);for(var X=J.next();!X.done;X=J.next())X.value.streamState=Z}return X39(C,L.filter(function(a){return!!a}),"offlineVideoStreams")}):g.WR.resolve(void 0)}),
4)}if(u.S!=2)return g.f4(u,0);
e=g.EO(u);return e instanceof g.Ff&&e.type==="QUOTA_EXCEEDED"?g.B(u,x.c7("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):u.OT(0)})},uXS=function(x,S){var Z;
return g.V(function(k){if(!x.S)return k.return();Z=x.S;return g.B(k,y9(x.Y,{mode:"readwrite",tS:!0},function(e){var u=[D6(e,Z,"transfer")];S&&u.push(S(e));return g.WR.all(u)}),0)})},Ui=function(x){x.S=void 0;
x.B=void 0;x.G.stop()},tfR=function(x,S){var Z,k,e,u,C;
return g.V(function(L){if(L.S==1)return Z=g.xl(S.key),k=Z.entityId,e=g.S5(k,"playbackData"),g.B(L,$i(x.Y,e,"playbackData"),2);u=L.Y;if((C=u)==null?0:C.playerResponseJson)return L.return(JSON.parse(u.playerResponseJson));throw Error("No PlayerResponse found");})},wM=function(x,S){x.api.a5("woffle",{mcte:S});
ec("missing current transfer entity.")},Rf=function(x,S){var Z,k,e;
return g.V(function(u){if(u.S==1)return g.B(u,$i(x.Y,g.S5(S,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);Z=u.Y;return u.return((e=(k=Z)==null?void 0:k.offlineModeType)!=null?e:void 0)})},LBx=function(x){return qwm[x.transferState]!==void 0},cpm=function(x,S){var Z=qwm[x.transferState],k=qwm[S.transferState];
return Z!==k?Z-k:Number(x.enqueuedTimestampMs)-Number(S.enqueuedTimestampMs)},MP=function(x,S){var Z=this;
this.Sy=x;this.api=S;this.L=new g.Ay;this.B=new g.qT;this.S2={LJ:function(){return Z.D.S2.LJ()},
N7:function(){return Z.L},
hQr:function(){return Z.D},
XZ:function(){return Z.XZ()},
Be:function(){return Z.Be()},
Z5:function(){return Z.Z5()},
F_:function(){return Z.F_()},
Mj:function(){return Z.Mj()},
Vj:function(k){return Z.Vj(k)}};
this.D=new xhS(function(){return dfn(Z)},function(){Z.Z5()},this.api.HI(),this.api.Z.bind(this.api));
this.S=new ug(this.api);S4h(this.D)},dfn=function(x){return g.V(function(S){x.api.XL("onOrchestrationBecameLeader");
return g.B(S,x.Be(),0)})},TFJ=function(x){var S,Z;
return g.V(function(k){if(k.S==1)return g.B(k,Sc(),2);if(k.S!=3){S=k.Y;if(!S)return ec("PES is undefined"),k.return();x.Y=new xf9(S,x.api,x.D,x.S);Z=x.Em(S);return g.B(k,Kgb(S,Z,x.D,x.S,x.Sy),3)}x.N=k.Y;return g.B(k,zf$(x),0)})},zf$=function(x){var S;
return g.V(function(Z){switch(Z.S){case 1:if(!x.Y)return ec("transferManager is undefined"),Z.return();if(x.Y.S){Z.OT(2);break}return g.B(Z,AL(x.Y),2);case 2:if(!x.Sy.Z("woffle_enable_main_downloads_library")){Z.OT(4);break}return g.B(Z,x.sB(),4);case 4:if(!x.Sy.Z("html5_offline_playback_position_sync")){Z.OT(6);break}return g.B(Z,x.IF(),7);case 7:return g.B(Z,x.Vj(864E5),6);case 6:return g.B(Z,x.refreshAllStaleEntities(43200,!0),9);case 9:return g.B(Z,x.Z_(),10);case 10:if(!x.Sy.Z("html5_retry_downloads_for_expiration")){Z.OT(11);
break}return g.B(Z,x.Mj(),11);case 11:return x.X=g.vv(function(){x.refreshAllStaleEntities(43200,!0);x.Z_()},9E5),g.$K(g.Sy(),function(){return x.F_()}),g.B(Z,Sc(),13);
case 13:return S=Z.Y,g.B(Z,$TS(S),14);case 14:jNt(x.D),g.Iq(Z)}})},Pds=function(){var x,S,Z,k,e,u;
return g.V(function(C){switch(C.S){case 1:return g.B(C,Sc(),2);case 2:x=C.Y;if(!x)return C.return([]);S=Date.now()/1E3;return g.B(C,xq(x,"offlineVideoPolicy"),3);case 3:Z=C.Y,k=g.v(Z),e=k.next();case 4:if(e.done){C.OT(6);break}u=e.value;if(!(u.expirationTimestamp&&Number(u.expirationTimestamp)<S)){C.OT(5);break}u.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";u.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.B(C,p5(x,u,"offlineVideoPolicy"),5);
case 5:e=k.next();C.OT(4);break;case 6:return C.return(Z.map(function(L){return L.key}))}})},gM=function(x,S,Z,k,e){var u,C,L;
return g.V(function(c){if(c.S==1)return g.B(c,Sc(),2);u=c.Y;if(!u)return c.return([]);C=S.map(function(J){var X=g.S5(J,Z);X={actionType:k,entityKey:X,actionMetadata:Object.assign({},Fkt(),e)};k!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(X.actionMetadata.priority=0);J=new PL(Z,J,X);return WL(J)});
L=WXv(u,C);S4h(x.D);return c.return(L)})},vth=function(x,S,Z,k){var e,u,C,L,c,J,X,a;
return g.V(function(F){switch(F.S){case 1:e=[],u=g.v(S),C=u.next();case 2:if(C.done){F.OT(4);break}L=C.value;if(L.upToDate||Z&&!L.shouldAutoSyncMetadata||!L.playlistId){F.OT(3);break}c={};switch(k){case "mainPlaylistEntity":J={nextAutoRefreshIntervalSeconds:L.checkInSeconds,autoSync:Z};c={mainPlaylistEntityActionMetadata:J};break;case "musicPlaylist":X={autoSync:Z},c={musicPlaylistEntityActionMetadata:X}}return g.B(F,gM(x,[L.playlistId],k,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",c),6);case 6:(a=
F.Y)&&e.push.apply(e,g.qc(a));case 3:C=u.next();F.OT(2);break;case 4:return F.return(e)}})},WBt=function(x,S){var Z;
return g.V(function(k){return S.length?(Z=Fkt(),g.oa(Z,bg,{isEnqueuedForExpiredStreamUrlRefetch:!0}),x.api.a5("qrd",{v:S.length}),k.return(gM(x,S,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z))):k.return([])})},YwR=function(x,S,Z){this.S=x;
this.Sy=S;this.D=Z},rpm=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q;
return g.V(function(n){switch(n.S){case 1:return Z=JL(S),k=g.xl(S.entityKey),e=k.entityId,u=[],g.Nc(n,2),g.B(n,Ivv(x,e),4);case 4:u=n.Y;if(!(x.Sy.Z("woffle_enable_main_downloads_library")&&((C=u)==null?0:C.length))){n.OT(5);break}return g.B(n,QNh(x.S,[S.entityKey]),5);case 5:g.f4(n,3);break;case 2:return L=g.EO(n),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L instanceof g.Ff&&L.type==="QUOTA_EXCEEDED"?(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):ec("Playlist add error"),n.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,c,J));case 3:X=[];if(!x.Sy.Z("html5_offline_prevent_redownload_downloaded_video")){n.OT(7);break}return g.B(n,XZb(x.S,"mainVideoEntity",u),8);case 8:u=n.Y;case 7:if((a=u)==null?0:a.length)for(F=g.v(u),q=F.next();!q.done;q=F.next())if(d=q.value,W=d.offlineVideoData,I=void 0,(I=W)==null?0:I.videoId)f=void 0,Q=Number(((f=S.actionMetadata)==null?void 0:f.priority)||
0)+1,X.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",W.videoId,"mainVideoEntity",Q,lg,NFx(S,W,e)));return n.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z,X))}})},Qrv=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b,h,l,A,kb,cx,eQ,aq,SQ,Wx,ly,Xv,J$,hg,VR,kX,Km,UH,L2,E,n2,Qt,Zu,sH,Y,jQ,sV,$X,oh,Rq,jx,eb,D4,N,P,r,K,w,L4,R,p,G,QR,TS,tg,Lm,wb,iy,SB,ib,OH,sO,Nq,Bx,GS,fm;
return g.V(function(cM){switch(cM.S){case 1:return Z=JL(S),k=S.entityKey,e=g.xl(k).entityId,u=[],C=!1,e==="!*$_ALL_ENTITIES_!*$"?(C=!0,g.B(cM,xq(x.S,"mainPlaylistEntity"),5)):g.B(cM,$i(x.S,k,"mainPlaylistEntity"),4);case 4:(L=cM.Y)&&u.push(L);cM.OT(3);break;case 5:u=cM.Y;case 3:if((c=u)==null||!c.length)return cM.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z));J=g.H(S.actionMetadata,iYs);a=(X=J)==null?void 0:X.nextAutoRefreshIntervalSeconds;q=(F=J)==null?void 0:F.autoSync;d=[];I=W=
!0;f=!1;if(!C&&q===!1){cM.OT(6);break}g.Nc(cM,7);return g.B(cM,Hgs(0,!!q,!0,u),9);case 9:d=cM.Y;g.f4(cM,8);break;case 7:Q=g.EO(cM);if(!(Q instanceof Error&&Q.message==="No data")){Q instanceof Error&&Q.message==="Empty response body"&&ec(Q.message);cM.OT(8);break}return e==="!*$_ALL_ENTITIES_!*$"?g.B(cM,Wkm(x.S,S,x.D,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.B(cM,PCn(e,x.S,S,x.D),8);case 8:if(!d.length||!C&&d[0].playlistId!==e)return cM.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Z));case 6:if(C){n=[];b=g.v(d);for(h=b.next();!h.done;h=b.next())l=h.value,l.upToDate||q&&!l.shouldAutoSyncMetadata||!l.playlistId||(A={nextAutoRefreshIntervalSeconds:l.checkInSeconds,autoSync:q},n.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",l.playlistId,"mainPlaylistEntity",0,lg,{mainPlaylistEntityActionMetadata:A})));return cM.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z,n))}d.length&&(kb=d[0],f=!!kb.upToDate,q&&(W=(cx=kb.shouldAutoSyncMetadata)!=null?cx:!0,I=(eQ=kb.shouldAutoSyncVideos)!=
null?eQ:!0,kb.checkInSeconds&&(a=kb.checkInSeconds)));if(f||!W)return cM.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z));aq=[];SQ=u[0];if(!SQ.downloadState){Wx=void 0;cM.OT(15);break}return g.B(cM,$i(x.S,SQ.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:Wx=cM.Y;case 15:return ly=Wx,J$=((Xv=ly)==null?0:Xv.addedTimestampMillis)?String(ly.addedTimestampMillis):void 0,g.Nc(cM,17),g.B(cM,Ivv(x,e,J$,a),19);case 19:aq=cM.Y;g.f4(cM,18);break;case 17:hg=g.EO(cM);if(!(hg instanceof
Error&&hg.message==="No data for playlist")){if(hg instanceof Error&&hg.message==="Empty response body for playlist")ec(hg.message);else return VR="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",kX="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",hg instanceof g.Ff&&hg.type==="QUOTA_EXCEEDED"&&(VR="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",kX="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),cM.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,VR,kX));
cM.OT(18);break}return g.B(cM,PCn(e,x.S,S,x.D),18);case 18:if(!I)return cM.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z));Km=[];UH=new Map;if((L2=aq)==null?0:L2.length)for(E=g.v(aq),n2=E.next();!n2.done;n2=E.next())Qt=n2.value,Zu=Qt.offlineVideoData,sH=void 0,((sH=Zu)==null?0:sH.videoId)&&UH.set(Zu.videoId,Zu);Y=new Map;jQ=[];if((sV=SQ)==null?0:($X=sV.videos)==null?0:$X.length)for(oh=g.v(SQ.videos),Rq=oh.next();!Rq.done;Rq=oh.next())if(jx=Rq.value,eb=JSON.parse(g.xl(jx).entityId),
D4=eb.videoId)UH.has(D4)?(Y.set(D4,UH.get(D4)),UH.delete(D4)):jQ.push(D4);P=Number(((N=S.actionMetadata)==null?void 0:N.priority)||0)+1;r=g.v(UH.entries());for(K=r.next();!K.done;K=r.next())w=K.value,L4=g.v(w),R=L4.next().value,p=L4.next().value,G=R,QR=p,Km.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",G,"mainVideoEntity",P,lg,NFx(S,QR,e)));TS=g.v(Y.entries());for(tg=TS.next();!tg.done;tg=TS.next())Lm=tg.value,wb=g.v(Lm),iy=wb.next().value,SB=wb.next().value,ib=iy,OH=SB,Km.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
ib,"mainVideoEntity",P,lg,NFx(S,OH,e)));sO=g.v(jQ);for(Nq=sO.next();!Nq.done;Nq=sO.next())Bx=Nq.value,GS={playlistId:e},fm={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:GS},Km.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Bx,"mainVideoEntity",0,lg,fm));return cM.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z,Km))}})},srn=function(x,S){var Z,k,e,u;
return g.V(function(C){switch(C.S){case 1:return Z=JL(S),g.Nc(C,2),k=g.xl(S.entityKey).entityId,k==="!*$_ALL_ENTITIES_!*$"?g.B(C,Wkm(x.S,S,x.D,(e=S.actionMetadata)==null?void 0:(u=e.offlineLoggingData)==null?void 0:u.offlineDeleteReason),5):g.B(C,PCn(k,x.S,S,x.D),6);case 6:if(!x.Sy.Z("woffle_enable_main_downloads_library")){C.OT(5);break}return g.B(C,sNs(x.S,S.entityKey),5);case 5:g.f4(C,3);break;case 2:return g.EO(C),C.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return C.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z))}})},Ivv=function(x,S,Z,k){var e,u,C,L,c,J,X;
return g.V(function(a){switch(a.S){case 1:return g.B(a,Ogn([S]),2);case 2:return e=a.Y,g.B(a,fv$(x,e[0],Z,k),3);case 3:return u=a.Y,C=u.mainPlaylistEntity,L=u.sEU,J=z9v(C,(c=L)==null?void 0:c.avatar),g.Nc(a,4),g.B(a,If(J),6);case 6:g.f4(a,5);break;case 4:X=g.EO(a),X instanceof Error&&X.message==="Failed to fetch"&&ec(X.message);case 5:return a.return(e[0].videos)}})},fv$=function(x,S,Z,k){var e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b;
return g.V(function(h){switch(h.S){case 1:e=Date.now().toString();Z||(Z=e);u=S.videos;C=S.playlistId;L=[];c=[];if(u)for(J=g.v(u),X=J.next();!X.done;X=J.next()){a=X.value;F=a.offlineVideoData;if(!F||!F.videoId)throw ec("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");q=F.videoId;d={videoId:q,playlistId:C};W={id:g.S5(JSON.stringify(d),"mainPlaylistVideoEntity"),video:g.S5(q,"mainVideoEntity")};L.push(W);c.push(W.id)}f={key:g.S5(C,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:Z,lastSyncedTimestampMillis:e};Q={key:g.S5(C,"mainPlaylistEntity"),playlistId:C,videos:c,title:S.title,thumbnailStyleData:Ett(S),visibility:BFm(S),downloadState:f.key};S.channel&&(n=S.channel.offlineChannelData,I=Vf$(g.S5(C,"ytMainChannelEntity"),n),Q.channelOwner=I.id);((b=Q)==null?0:b.entityMetadata)?(Q.entityMetadata.offlineLastModifiedTimestampSeconds=S.lastModifiedTimestamp,k&&(Q.entityMetadata.nextAutoRefreshIntervalSeconds=String(k))):Q&&(Q.entityMetadata={nextAutoRefreshIntervalSeconds:k?
String(k):void 0,offlineLastModifiedTimestampSeconds:S.lastModifiedTimestamp});g.Nc(h,2);return g.B(h,y9(x.S,{mode:"readwrite",tS:!0},function(l){var A=D6(l,Q,"mainPlaylistEntity"),kb=D6(l,f,"mainPlaylistDownloadStateEntity");A=[A,kb];kb=g.v(L);for(var cx=kb.next();!cx.done;cx=kb.next())A.push(D6(l,cx.value,"mainPlaylistVideoEntity"));I&&A.push(D6(l,I,"ytMainChannelEntity"));return g.WR.all(A)}),4);
case 4:g.f4(h,3);break;case 2:throw g.EO(h),ec("PES failure for playlist"),Error("PES failure for playlist");case 3:return h.return({mainPlaylistEntity:Q,sEU:I,EQm:L})}})},Vf$=function(x,S){return{id:x,
channelId:S.channelId,title:S.title,avatar:S.thumbnail}},Ett=function(x){var S=[],Z=x.videos;
Z&&Z.length>0&&S.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:Z[0].offlineVideoData.thumbnail}}});if((x=x.additionalMetadadatas)&&x.length>0)for(x=g.v(x),Z=x.next();!Z.done;Z=x.next()){var k=Z.value.offlineBundleItemPlaylistData,e=void 0;Z=(e=k)==null?void 0:e.style;e=void 0;k={collageThumbnail:{coverThumbnail:(e=k)==null?void 0:e.coverThumbnail}};switch(Z){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":S.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:k});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":S.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:k});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":S.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:k});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":S.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:k})}}return S},BFm=function(x){switch(x.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},NFx=function(x,S,Z){S={offlineVideoData:S,
playlistId:Z};if(x=g.H(x.actionMetadata,iYs))S.maximumDownloadQuality=x.maximumDownloadQuality;return{mainVideoEntityActionMetadata:S}},ntn=function(x,S,Z){this.S=x;
this.Sy=S;this.D=Z},bYJ=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q,d;
return g.V(function(W){switch(W.S){case 1:return Z=JL(S),k=g.xl(S.entityKey),e=k.entityId,u=g.H(S.actionMetadata,y4),L=!((C=u)==null?0:C.playlistId),g.Nc(W,2),g.B(W,KBR(x,e,void 0,(c=u)==null?void 0:c.offlineVideoData,L),4);case 4:g.f4(W,3);break;case 2:return J=g.EO(W),X="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.Ff&&J.type==="QUOTA_EXCEEDED"&&(X="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
W.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,X,a));case 3:F=1;F=Number(((q=S.actionMetadata)==null?void 0:q.priority)||0)+1;var I=(I=g.H(S.actionMetadata,y4))?{playbackDataActionMetadata:{maximumDownloadQuality:I.maximumDownloadQuality}}:void 0;d=Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e,"playbackData",F,GgR,I);return W.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z,[d]))}})},mf9=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q;
return g.V(function(n){switch(n.S){case 1:return Z=JL(S),k=g.xl(S.entityKey),e=k.entityId,g.B(n,$i(x.S,S.entityKey,"mainVideoEntity"),2);case 2:u=n.Y;if(!u){C=void 0;n.OT(3);break}return g.B(n,$i(x.S,u.downloadState,"mainVideoDownloadStateEntity"),4);case 4:C=n.Y;case 3:L=C;if(!u||!L)return n.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z));g.Nc(n,5);return g.B(n,KBR(x,e,L.addedTimestampMillis,(J=g.H(S.actionMetadata,y4))==null?void 0:J.offlineVideoData),7);case 7:X=1;X=Number(((a=
S.actionMetadata)==null?void 0:a.priority)||0)+1;c=Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",e,"playbackData",X,GgR);g.f4(n,6);break;case 5:F=g.EO(n);if(!(F instanceof Error&&F.message==="No data")){if(F instanceof Error&&F.message==="Empty response body")ec(F.message);else return q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.Ff&&F.type==="QUOTA_EXCEEDED"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),n.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,q,d));n.OT(6);break}return g.B(n,ig(x.S,e),9);case 9:W=n.Y;I=g.H(S.actionMetadata,y4);if(Q=(f=I)==null?void 0:f.playlistId)W.playlistId=Q;W.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.B(n,NP(e,x.S,S,x.D,W),6);case 6:return n.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z,c?[c]:void 0))}})},otm=function(x,S){var Z,k,e,u,C,L,c,J,X,a;
return g.V(function(F){switch(F.S){case 1:return Z=JL(S),g.Nc(F,2),k=g.xl(S.entityKey).entityId,k==="!*$_ALL_ENTITIES_!*$"?g.B(F,Wkm(x.S,S,x.D,(X=S.actionMetadata)==null?void 0:(a=X.offlineLoggingData)==null?void 0:a.offlineDeleteReason),5):g.B(F,ig(x.S,k),6);case 6:e=F.Y;u=g.H(S.actionMetadata,y4);if(L=(C=u)==null?void 0:C.playlistId)e.playlistId=L;e.offlineDeleteReason=(c=S.actionMetadata)==null?void 0:(J=c.offlineLoggingData)==null?void 0:J.offlineDeleteReason;return g.B(F,NP(k,x.S,S,x.D,e),7);
case 7:if(!x.Sy.Z("woffle_enable_main_downloads_library")){F.OT(5);break}return g.B(F,sNs(x.S,S.entityKey),5);case 5:g.f4(F,3);break;case 2:return g.EO(F),F.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return F.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z))}})},KBR=function(x,S,Z,k,e){var u,C,L,c,J,X;
return g.V(function(a){switch(a.S){case 1:if(u=k){a.OT(2);break}return g.B(a,ohS([S]),3);case 3:C=a.Y,u=C[0];case 2:return g.B(a,OYt(x,u,Z,e),4);case 4:L=a.Y;c=L.mainVideoEntity;J=L.channelEntity;g.Nc(a,5);var F=T6(c.thumbnail),q=T6(J.avatar);return g.B(a,If(F.concat(q)),7);case 7:g.f4(a,0);break;case 5:X=g.EO(a),X instanceof Error&&X.message==="Failed to fetch"&&ec(X.message),g.Iq(a)}})},OYt=function(x,S,Z,k){var e,u,C,L,c,J,X,a,F,q,d,W,I;
return g.V(function(f){switch(f.S){case 1:Z||(Z=Date.now().toString());u=(e=S.channel)==null?void 0:e.offlineChannelData;C={id:g.S5(S.videoId,"ytMainChannelEntity"),channelId:u.channelId,title:u.title,avatar:u.thumbnail};L={key:g.S5(S.videoId,"mainVideoDownloadStateEntity"),playbackData:g.S5(S.videoId,"playbackData"),addedTimestampMillis:Z,videoDownloadContextEntity:g.S5(S.videoId,"videoDownloadContextEntity")};c={key:g.S5(S.videoId,"videoPlaybackPositionEntity"),videoId:S.videoId,lastPlaybackPositionSeconds:"0"};
x.Sy.Z("html5_offline_playback_position_sync")&&(J={playbackPosition:c.key});X=g.S5(S.videoId,"mainVideoEntity");a={key:X,videoId:S.videoId,title:S.title,thumbnail:S.thumbnail,localizedStrings:{viewCount:S.shortViewCountText},userState:J,lengthSeconds:S.lengthSeconds?Number(S.lengthSeconds):void 0,publishedTimestampMillis:S.publishedTimestamp?(Number(S.publishedTimestamp)*1E3).toString():void 0,formattedDescription:S.description,owner:C.id,downloadState:L.key};if(!x.Sy.Z("woffle_enable_main_downloads_library")||
!k){f.OT(2);break}return g.B(f,igm(x.S,[X]),3);case 3:if(d=f.Y)F=d.mainDownloadsLibraryEntity,q=d.mainDownloadsListEntity;case 2:return I=Jtt,W={key:g.S5(S.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.oa(L,I,W),g.B(f,y9(x.S,{mode:"readwrite",tS:!0},function(Q){var n=D6(Q,C,"ytMainChannelEntity"),b=D6(Q,L,"mainVideoDownloadStateEntity"),h=D6(Q,a,"mainVideoEntity");n=[n,b,h];x.Sy.Z("html5_offline_playback_position_sync")&&(b=D6(Q,c,"videoPlaybackPositionEntity"),
n.push(b));F&&(b=D6(Q,F,"mainDownloadsLibraryEntity"),n.push(b));q&&(b=D6(Q,q,"mainDownloadsListEntity"),n.push(b));W&&(Q=D6(Q,W,"downloadStatusEntity"),n.push(Q));return g.WR.all(n)}),4);
case 4:return f.return({mainVideoEntity:a,channelEntity:C})}})},hfh=function(x,S,Z){this.S=x;
this.Sy=S;this.D=Z},Ufs=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b,h,l,A,kb,cx,eQ,aq,SQ;
return g.V(function(Wx){switch(Wx.S){case 1:return Z=JL(S),k=[],g.B(Wx,hB.getInstance(),2);case 2:e=Wx.Y;if(!e){Wx.OT(3);break}return g.B(Wx,e.get("sdois"),4);case 4:return u=Wx.Y,g.B(Wx,(L=e)==null?void 0:L.get("lmqf"),5);case 5:C=Wx.Y;case 3:g.Nc(Wx,6);if(u===void 0)throw Error("prefStorage or opt-in state is undefined");c=[];if(u){Wx.OT(8);break}return g.B(Wx,rtx(x.S),9);case 9:c=Wx.Y,c.reverse();case 8:if(!c.length){Wx.OT(10);break}J=g.v(c);X=J.next();case 11:if(X.done){Wx.OT(10);break}a=X.value;
if(!a){Wx.OT(12);break}F=g.xl(a).entityId;return g.B(Wx,ig(x.S,F),14);case 14:return q=Wx.Y,q.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.B(Wx,NP(F,x.S,{entityKey:a,actionType:S.actionType},x.D,q),12);case 12:X=J.next();Wx.OT(11);break;case 10:return g.B(Wx,AtR(u,(d=C)!=null?d:"SD"),16);case 16:return W=Wx.Y,g.B(Wx,Y4h(W),17);case 17:I=Ni9(W);if(!x.Sy.Z("woffle_enable_main_downloads_library")){Wx.OT(18);break}if(u){Wx.OT(19);break}return g.B(Wx,sNs(x.S,g.mm),19);case 19:return g.B(Wx,
QNh(x.S,[g.mm]),18);case 18:if((f=I)==null?0:f.length)for(Q=g.v(I),n=Q.next();!n.done;n=Q.next())if(h=b=n.value,l=h.actionType,A=h.entityKey,kb=h.actionMetadata,l&&A&&kb&&!g.H(kb,HYb)){l==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(kb.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(cx=g.H(b.actionMetadata,y4))cx.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",b.actionMetadata=Object.assign({},b.actionMetadata,{mainVideoEntityActionMetadata:cx});k.push(b)}g.f4(Wx,
7);break;case 6:return eQ=g.EO(Wx),aq="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",SQ="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",eQ instanceof g.Ff&&eQ.type==="QUOTA_EXCEEDED"&&(aq="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",SQ="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Wx.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,aq,SQ));case 7:return Wx.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z,k))}})},Apt=function(){MP.apply(this,
arguments);
this.j="mainVideoEntity"},Rfh=function(x,S,Z){S=S===void 0?43200:S;
Z=Z===void 0?!0:Z;var k=k===void 0?!1:k;var e,u,C;return g.V(function(L){switch(L.S){case 1:if(!x.L.Ok())return L.return([]);e=[];g.Nc(L,2);return g.B(L,Hgs(S,Z,k),4);case 4:e=L.Y;g.f4(L,3);break;case 2:u=g.EO(L),u instanceof Error&&u.message==="No data"||u instanceof Error&&u.message==="Empty response body"&&ec(u.message);case 3:return C=vth(x,e,Z,"mainPlaylistEntity"),L.return(C)}})},ww9=function(x,S,Z,k){k=k===void 0?!1:k;
var e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q;return g.V(function(n){switch(n.S){case 1:return e=[],g.B(n,Uht(),2);case 2:return(u=n.Y)||k?g.B(n,R9m(S,Z),3):n.return([]);case 3:C=n.Y;if((L=C)==null||!L.length)return n.return([]);c={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};J=g.v(C);X=J.next();case 4:if(X.done){n.OT(6);break}F=a=X.value;q=F.actionType;d=F.entityKey;W=F.actionMetadata;if(!(q&&d&&W)||g.H(W,HYb)){n.OT(5);break}q==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(W.offlineLoggingData=
c);I=g.xl(d);f=I.entityId;return g.B(n,gM(x,[f],"mainVideoEntity",q,W),8);case 8:Q=n.Y,e=e.concat(Q);case 5:X=J.next();n.OT(4);break;case 6:return n.return(e)}})},Df9=function(x,S){this.S=x;
this.D=S},gtt=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I,f;
return g.V(function(Q){switch(Q.S){case 1:return Z=JL(S),k=g.xl(S.entityKey),e=k.entityId,u=[],g.Nc(Q,2),g.B(Q,MfR(x,e),4);case 4:u=Q.Y;if((C=u)==null||!C.length){Q.OT(5);break}return g.B(Q,nhx(x.S,S.entityKey),5);case 5:g.f4(Q,3);break;case 2:return L=g.EO(Q),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L instanceof g.Ff&&L.type==="QUOTA_EXCEEDED"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Q.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,c,J));case 3:return X=[],g.B(Q,XZb(x.S,"musicTrack",u),7);case 7:u=Q.Y;if(u.length)for(a=g.v(u),F=a.next();!F.done;F=a.next())if(q=F.value,d=q.offlineVideoData,W=void 0,(W=d)==null?0:W.videoId)I=void 0,f=Number(((I=S.actionMetadata)==null?void 0:I.priority)||0)+1,X.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",d.videoId,"musicTrack",f,ps,Ei(S,d,e)));return Q.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z,X))}})},
lvH=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b,h,l,A,kb,cx,eQ,aq,SQ,Wx,ly,Xv,J$,hg,VR,kX,Km,UH,L2,E,n2,Qt,Zu,sH,Y,jQ,sV,$X,oh,Rq,jx,eb,D4,N,P,r,K,w,L4,R,p;
return g.V(function(G){switch(G.S){case 1:return Z=JL(S),k=S.entityKey,e=g.xl(k).entityId,u=[],C=!1,e==="!*$_ALL_ENTITIES_!*$"?(C=!0,g.B(G,xq(x.S,"musicAlbumRelease"),5)):g.B(G,$i(x.S,k,"musicAlbumRelease"),4);case 4:(L=G.Y)&&u.push(L);G.OT(3);break;case 5:u=G.Y;case 3:if((c=u)==null||!c.length)return G.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z));if(C){J=[];X=g.v(u);for(a=X.next();!a.done;a=X.next())F=a.value,q=g.xl(F.id).entityId,J.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
q,"musicAlbumRelease",0,ps));return G.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z,J))}d=[];W=u[0];I=void 0;if(!W.downloadMetadata){G.OT(6);break}return g.B(G,$i(x.S,W.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:f=G.Y,I=Number((n=(Q=f)==null?void 0:Q.addedTimestampMillis)!=null?n:"0")/1E3;case 6:return g.Nc(G,8),g.B(G,MfR(x,e,(b=I)==null?void 0:b.toString()),10);case 10:d=G.Y;g.f4(G,9);break;case 8:h=g.EO(G);if(!(h instanceof Error&&h.message==="No data")){if(h instanceof
Error&&h.message==="Empty response body")ec(h.message);else return l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.Ff&&h.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),G.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,l,A));G.OT(9);break}return g.B(G,si(e,"musicAlbumRelease",x.S,S,x.D),9);case 9:kb=[];cx=new Map;
if((eQ=d)==null?0:eQ.length)for(aq=g.v(d),SQ=aq.next();!SQ.done;SQ=aq.next())Wx=SQ.value,ly=Wx.offlineVideoData,Xv=void 0,((Xv=ly)==null?0:Xv.videoId)&&cx.set(ly.videoId,ly);J$=new Map;hg=[];if((VR=W)==null?0:(kX=VR.tracks)==null?0:kX.length)for(Km=g.v(W.tracks),UH=Km.next();!UH.done;UH=Km.next())if(L2=UH.value,E=g.xl(L2).entityId)cx.has(E)?(J$.set(E,cx.get(E)),cx.delete(E)):hg.push(E);Qt=Number(((n2=S.actionMetadata)==null?void 0:n2.priority)||0)+1;Zu=g.v(cx.entries());for(sH=Zu.next();!sH.done;sH=
Zu.next())Y=sH.value,jQ=g.v(Y),sV=jQ.next().value,$X=jQ.next().value,oh=sV,Rq=$X,kb.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",oh,"musicTrack",Qt,ps,Ei(S,Rq)));jx=g.v(J$.entries());for(eb=jx.next();!eb.done;eb=jx.next())D4=eb.value,N=g.v(D4),P=N.next().value,r=N.next().value,K=P,w=r,kb.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",K,"musicTrack",Qt,ps,Ei(S,w)));L4=g.v(hg);for(R=L4.next();!R.done;R=L4.next())p=R.value,kb.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",p,"musicTrack",
0,ps));return G.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z,kb))}})},ypS=function(x,S){var Z,k;
return g.V(function(e){switch(e.S){case 1:return Z=JL(S),g.Nc(e,2),k=g.xl(S.entityKey).entityId,k==="!*$_ALL_ENTITIES_!*$"?g.B(e,fs(x.S,S,x.D),5):g.B(e,si(k,"musicAlbumRelease",x.S,S,x.D),6);case 6:return g.B(e,Kk$(x.S,S.entityKey),5);case 5:g.f4(e,3);break;case 2:return g.EO(e),e.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Z))}})},MfR=function(x,S,Z){var k,e,u;
return g.V(function(C){switch(C.S){case 1:return g.B(C,Ogn([S]),2);case 2:return k=C.Y,g.B(C,pwh(x,k[0],Z),3);case 3:return e=C.Y,u=T6(e.thumbnailDetails),g.B(C,If(u),4);case 4:return C.return(k[0].videos)}})},pwh=function(x,S,Z){var k,e,u,C,L,c,J,X,a,F,q,d,W,I;
return g.V(function(f){if(f.S==1){k=S.additionalMetadadatas;e=void 0;if(k&&k.length>0)for(u=g.v(k),C=u.next();!C.done;C=u.next())if(L=C.value,L.offlineMusicPlaylistData){e=L.offlineMusicPlaylistData;break}c=S.playlistId;J=Gym(S);X=J.t5;a=J.NI;F=Z?(Number(Z)*1E3).toString():Date.now().toString();q=S.lastModifiedTimestamp?(Number(S.lastModifiedTimestamp)*1E3).toString():"0";d={id:g.S5(c,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:a,lastModifiedTimestampMillis:q,addedTimestampMillis:F,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};W={id:g.S5(c,"musicAlbumRelease"),title:S.title,audioPlaylistId:c,trackCount:S.totalVideoCount,tracks:X,downloadMetadata:d.id};e&&(W.thumbnailDetails=(I=e.albumHqThumbnail)!=null?I:e.albumArtistThumbnail,W.artistDisplayName=e.albumArtistDisplayName,W.releaseDate=e.albumReleaseDate,W.contentRating={explicitType:e.albumReleaseExplicitType},W.releaseType=e.albumReleaseType);return g.B(f,y9(x.S,{mode:"readwrite",tS:!0},function(Q){var n=D6(Q,W,"musicAlbumRelease");
Q=D6(Q,d,"musicAlbumReleaseDownloadMetadataEntity");return g.WR.all([n,Q])}),2)}return f.return(W)})},$f$=function(x,S){this.S=x;
this.D=S},S0H=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I,f;
return g.V(function(Q){switch(Q.S){case 1:return Z=JL(S),k=g.xl(S.entityKey),e=k.entityId,u=[],g.Nc(Q,2),g.B(Q,xSx(x,e),4);case 4:u=Q.Y;if((C=u)==null||!C.length){Q.OT(5);break}return g.B(Q,nhx(x.S,S.entityKey),5);case 5:g.f4(Q,3);break;case 2:return L=g.EO(Q),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L instanceof g.Ff&&L.type==="QUOTA_EXCEEDED"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Q.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,c,J));case 3:return X=[],g.B(Q,XZb(x.S,"musicTrack",u),7);case 7:u=Q.Y;if(u.length)for(a=g.v(u),F=a.next();!F.done;F=a.next())if(q=F.value,d=q.offlineVideoData,W=void 0,(W=d)==null?0:W.videoId)I=void 0,f=Number(((I=S.actionMetadata)==null?void 0:I.priority)||0)+1,X.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",d.videoId,"musicTrack",f,$q,Ei(S,d,e)));return Q.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z,X))}})},
j8n=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b,h,l,A,kb,cx,eQ,aq,SQ,Wx,ly,Xv,J$,hg,VR,kX,Km,UH,L2,E,n2,Qt,Zu,sH,Y,jQ,sV,$X,oh,Rq,jx,eb,D4,N,P,r,K,w,L4,R,p,G,QR,TS,tg,Lm,wb,iy,SB,ib,OH,sO,Nq;
return g.V(function(Bx){switch(Bx.S){case 1:return Z=JL(S),k=S.entityKey,e=g.xl(k).entityId,u=[],C=!1,e==="!*$_ALL_ENTITIES_!*$"?(C=!0,g.B(Bx,xq(x.S,"musicPlaylist"),5)):g.B(Bx,$i(x.S,k,"musicPlaylist"),4);case 4:(L=Bx.Y)&&u.push(L);Bx.OT(3);break;case 5:u=Bx.Y;case 3:if((c=u)==null||!c.length)return Bx.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z));J=g.H(S.actionMetadata,bgR);a=(X=J)==null?void 0:X.autoSync;F=[];d=q=!0;W=!1;I=void 0;if(!C&&a===!1){Bx.OT(6);break}g.Nc(Bx,7);return g.B(Bx,
wZh(0,!!a,!0,u),9);case 9:F=Bx.Y;g.f4(Bx,8);break;case 7:f=g.EO(Bx);if(!(f instanceof Error&&f.message==="No data")){f instanceof Error&&f.message==="Empty response body"&&ec(f.message);Bx.OT(8);break}return e==="!*$_ALL_ENTITIES_!*$"?g.B(Bx,fs(x.S,S,x.D),8):g.B(Bx,si(e,"musicPlaylist",x.S,S,x.D),8);case 8:if(!F.length||!C&&F[0].playlistId!==e)return Bx.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z));case 6:if(C){Q=[];n=g.v(F);for(b=n.next();!b.done;b=n.next())h=b.value,h.upToDate||
a&&!h.shouldAutoSyncMetadata||!h.playlistId||(l={autoSync:a},Q.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",h.playlistId,"musicPlaylist",0,$q,{musicPlaylistEntityActionMetadata:l})));return Bx.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z,Q))}F.length&&(A=F[0],W=!!A.upToDate,a&&(q=(kb=A.shouldAutoSyncMetadata)!=null?kb:!0,d=(cx=A.shouldAutoSyncVideos)!=null?cx:!0,A.checkInSeconds&&(I=A.checkInSeconds)));if(W||!q)return Bx.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Z));eQ=[];aq=u[0];SQ=void 0;if(!aq.downloadMetadata){Bx.OT(15);break}return g.B(Bx,$i(x.S,aq.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:Wx=Bx.Y,SQ=Number((Xv=(ly=Wx)==null?void 0:ly.addedTimestampMillis)!=null?Xv:"0")/1E3;case 15:return g.Nc(Bx,17),g.B(Bx,xSx(x,e,(J$=SQ)==null?void 0:J$.toString(),I),19);case 19:eQ=Bx.Y;g.f4(Bx,18);break;case 17:hg=g.EO(Bx);if(!(hg instanceof Error&&hg.message==="No data")){if(hg instanceof Error&&hg.message==="Empty response body")ec(hg.message);
else return VR="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",kX="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",hg instanceof g.Ff&&hg.type==="QUOTA_EXCEEDED"&&(VR="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",kX="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Bx.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,VR,kX));Bx.OT(18);break}return g.B(Bx,si(e,"musicPlaylist",x.S,S,x.D),18);case 18:if(!d)return Bx.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Z));Km=[];UH=new Map;if((L2=eQ)==null?0:L2.length)for(E=g.v(eQ),n2=E.next();!n2.done;n2=E.next())Qt=n2.value,Zu=Qt.offlineVideoData,sH=void 0,((sH=Zu)==null?0:sH.videoId)&&UH.set(Zu.videoId,Zu);Y=new Map;jQ=[];if((sV=aq)==null?0:($X=sV.tracks)==null?0:$X.length)for(oh=g.v(aq.tracks),Rq=oh.next();!Rq.done;Rq=oh.next())if(jx=Rq.value,eb=g.xl(jx).entityId)UH.has(eb)?(Y.set(eb,UH.get(eb)),UH.delete(eb)):jQ.push(eb);N=Number(((D4=S.actionMetadata)==null?void 0:D4.priority)||0)+1;P=g.v(UH.entries());for(r=
P.next();!r.done;r=P.next())K=r.value,w=g.v(K),L4=w.next().value,R=w.next().value,p=L4,G=R,Km.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p,"musicTrack",N,$q,Ei(S,G)));QR=g.v(Y.entries());for(TS=QR.next();!TS.done;TS=QR.next())tg=TS.value,Lm=g.v(tg),wb=Lm.next().value,iy=Lm.next().value,SB=wb,ib=iy,Km.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",SB,"musicTrack",N,$q,Ei(S,ib)));OH=g.v(jQ);for(sO=OH.next();!sO.done;sO=OH.next())Nq=sO.value,Km.push(Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Nq,"musicTrack",0,$q));return Bx.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z,Km))}})},ZGs=function(x,S){var Z,k;
return g.V(function(e){switch(e.S){case 1:return Z=JL(S),g.Nc(e,2),k=g.xl(S.entityKey).entityId,k==="!*$_ALL_ENTITIES_!*$"?g.B(e,fs(x.S,S,x.D),5):g.B(e,si(k,"musicPlaylist",x.S,S,x.D),6);case 6:return g.B(e,Kk$(x.S,S.entityKey),5);case 5:g.f4(e,3);break;case 2:return g.EO(e),e.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Z))}})},xSx=function(x,S,Z,k){var e,u,C;
return g.V(function(L){switch(L.S){case 1:return g.B(L,Ogn([S]),2);case 2:return e=L.Y,g.B(L,kkH(x,e[0],Z,k),3);case 3:return u=L.Y,C=T6(u.thumbnailDetails),g.B(L,If(C),4);case 4:return L.return(e[0].videos)}})},kkH=function(x,S,Z,k){var e,u,C,L,c,J,X,a,F;
return g.V(function(q){return q.S==1?(e=S.playlistId,u=Gym(S),C=u.t5,L=u.NI,c=Z?(Number(Z)*1E3).toString():Date.now().toString(),J=S.lastModifiedTimestamp?(Number(S.lastModifiedTimestamp)*1E3).toString():"0",X={id:g.S5(e,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:L,lastModifiedTimestampMillis:J,addedTimestampMillis:c,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},a={id:g.S5(e,"musicPlaylist"),title:S.title,playlistId:e,thumbnailDetails:S.thumbnail,visibility:eTv(S),trackCount:S.totalVideoCount,
tracks:C,downloadMetadata:X.id},k&&(((F=a)==null?0:F.entityMetadata)?a.entityMetadata.nextAutoRefreshIntervalSeconds=String(k):a&&(a.entityMetadata={nextAutoRefreshIntervalSeconds:String(k)})),g.B(q,y9(x.S,{mode:"readwrite",tS:!0},function(d){var W=D6(d,a,"musicPlaylist");d=D6(d,X,"musicPlaylistDownloadMetadataEntity");return g.WR.all([W,d])}),2)):q.return(a)})},eTv=function(x){switch(x.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},uT$=function(x,S){this.S=x;
this.D=S},cDH=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q,d;
return g.V(function(W){switch(W.S){case 1:return Z=JL(S),k=g.xl(S.entityKey),e=k.entityId,u=g.H(S.actionMetadata,CHv),g.Nc(W,2),g.B(W,t6h(x,e,void 0,(C=u)==null?void 0:C.track,(L=u)==null?void 0:L.albumRelease),4);case 4:if((c=u)==null?0:c.playlistId){W.OT(5);break}return g.B(W,nhx(x.S,S.entityKey),5);case 5:g.f4(W,3);break;case 2:return J=g.EO(W),X="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.Ff&&J.type==="QUOTA_EXCEEDED"&&
(X="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),W.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,X,a));case 3:q=Number(((F=S.actionMetadata)==null?void 0:F.priority)||0)+1;var I=(I=g.H(S.actionMetadata,CHv))?{playbackDataActionMetadata:{maximumDownloadQuality:I.maximumDownloadQuality}}:void 0;d=Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e,"playbackData",q,L_R,I);return W.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Z,[d]))}})},JDx=function(x,S){var Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I;
return g.V(function(f){switch(f.S){case 1:return Z=JL(S),k=g.xl(S.entityKey),e=k.entityId,g.B(f,$i(x.S,S.entityKey,"musicTrack"),2);case 2:u=f.Y;if(!u){C=void 0;f.OT(3);break}return g.B(f,$i(x.S,u.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:C=f.Y;case 3:L=C;if(!u||!L)return f.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z));J=g.H(S.actionMetadata,CHv);g.Nc(f,5);return g.B(f,t6h(x,e,L.addedTimestampMillis,(X=J)==null?void 0:X.track,(a=J)==null?void 0:a.albumRelease),
7);case 7:q=Number(((F=S.actionMetadata)==null?void 0:F.priority)||0)+1;c=Ks("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",e,"playbackData",q,L_R);g.f4(f,6);break;case 5:d=g.EO(f);if(!(d instanceof Error&&d.message==="No data")){if(d instanceof Error&&d.message==="Empty response body")ec(d.message);else return W="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",I="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.Ff&&d.type==="QUOTA_EXCEEDED"&&(W="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
I="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),f.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,W,I));f.OT(6);break}return g.B(f,Q4(e,x.S,S,x.D),6);case 6:return f.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Z,c?[c]:void 0))}})},XvR=function(x,S){var Z,k;
return g.V(function(e){switch(e.S){case 1:return Z=JL(S),g.Nc(e,2),k=g.xl(S.entityKey).entityId,k==="!*$_ALL_ENTITIES_!*$"?g.B(e,fs(x.S,S,x.D),5):g.B(e,Q4(k,x.S,S,x.D),6);case 6:return g.B(e,Kk$(x.S,S.entityKey),5);case 5:g.f4(e,3);break;case 2:return g.EO(e),e.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Z,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new G6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Z))}})},t6h=function(x,S,Z,k,e){var u,C,L,c,J,X;
return g.V(function(a){switch(a.S){case 1:if(u=k){a.OT(2);break}return g.B(a,ohS([S]),3);case 3:C=a.Y,L=C[0],u=V4R(L);case 2:return g.B(a,aQ9(x,u,S,e,Z),4);case 4:c=a.Y;J=c.musicTrackEntity;X=c.EG;var F=T6(J.thumbnailDetails),q=[];X&&(q=T6(X.thumbnailDetails));return g.B(a,If(F.concat(q)),0)}})},aQ9=function(x,S,Z,k,e){var u;
return g.V(function(C){return C.S==1?(e||(e=Date.now().toString()),u={id:g.S5(Z,"musicTrackDownloadMetadataEntity"),playbackData:g.S5(Z,"playbackData"),addedTimestampMillis:e,videoDownloadContextEntity:g.S5(Z,"videoDownloadContextEntity")},k&&(S.albumRelease=k.id),g.B(C,y9(x.S,{mode:"readwrite",tS:!0},function(L){var c=[],J=D6(L,u,"musicTrackDownloadMetadataEntity");c.push(J);J=D6(L,S,"musicTrack");c.push(J);k&&(L=D6(L,k,"musicAlbumRelease"),c.push(L));return g.WR.all(c)}),2)):C.S!=3?g.B(C,qP(Z,"musicTrackDownloadMetadataEntity",
x.S,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):C.return({musicTrackEntity:S,
EG:k})})},xf=function(){MP.apply(this,arguments);
this.j="musicTrack"},F_x=function(x,S,Z){S=S===void 0?43200:S;
Z=Z===void 0?!0:Z;var k=k===void 0?!1:k;var e,u;return g.V(function(C){switch(C.S){case 1:if(!x.L.Ok())return C.return([]);e=[];g.Nc(C,2);return g.B(C,wZh(S,Z,k),4);case 4:e=C.Y;g.f4(C,3);break;case 2:g.EO(C);case 3:return u=vth(x,e,Z,"musicPlaylist"),C.return(u)}})},q0S=function(){g.Nx.apply(this,arguments);
var x=this;this.events=new g.sz(this);this.Sy=this.player.U();this.S2={OAN:function(){return x.S},
gs:function(){return x.gs()},
qc:function(S){return x.qc(S)}}},dSm=function(x){var S;
x=g.H((S=x.getWatchNextResponse())==null?void 0:S.currentVideoEndpoint,g.Q8);if(x==null?0:x.playlistId)var Z=x.playlistId;return Z},zTt=function(x,S){var Z,k,e,u;
return g.V(function(C){if(C.S==1){Z=S.clientPlaybackNonce;k={cpn:Z,offlineSourceVisualElement:g.vF(S.GS||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};S.Y&&(k.videoFmt=Number(S.Y.itag));S.G&&(k.audioFmt=Number(S.G.itag));if((e=dSm(S))&&S.videoId){var L=S.videoId;L=e!=="PPSV"?Promise.resolve(!1):x.S.KF(L);C=g.B(C,L,3)}else C=C.OT(2);return C}C.S!=2&&(u=C.Y)&&(k.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");x.Y=Z;g.TR("offlinePlaybackStarted",k);g.Iq(C)})};
g.M3.prototype.ST=g.uy(45,function(x){return this.app.ST(x)});
g.TF.prototype.ST=g.uy(44,function(x){return g.WEc(this,9,x)});
g.T(oV,m2);g.C4.Object.defineProperties(oV.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.S.entityMetadata},
set:function(x){this.S.entityMetadata=x}}});
g.T(kiH,oV);kiH.prototype.Y=function(){return[]};
g.T(ezH,oV);ezH.prototype.Y=function(){return[]};
g.T(us9,oV);us9.prototype.Y=function(){return[]};
g.T(CuH,oV);CuH.prototype.Y=function(){return[]};
g.T(tMv,oV);tMv.prototype.Y=function(){return[]};
g.T(Ljx,oV);Ljx.prototype.Y=function(){var x=[];this.S.alternateChannel&&x.push(this.S.alternateChannel);this.S.alternateChannelList&&x.push.apply(x,g.qc(this.S.alternateChannelList));this.S.oneofChannelEntity&&x.push(this.S.oneofChannelEntity);return[].concat(g.qc(new Set(x)))};
g.T(csJ,oV);csJ.prototype.Y=function(){var x=[];this.S.entryCollection&&x.push(this.S.entryCollection);return[].concat(g.qc(new Set(x)))};
g.T(Jst,m2);Jst.prototype.Y=function(){var x=[];this.S.video&&x.push(this.S.video);return[].concat(g.qc(new Set(x)))};
g.T(X_9,oV);X_9.prototype.Y=function(){var x=[];this.S.parentPlaylist&&x.push(this.S.parentPlaylist);if(this.S.entries)for(var S=g.v(this.S.entries),Z=S.next();!Z.done;Z=S.next())x.push.apply(x,g.qc((new Jst(Z.value)).Y()));return[].concat(g.qc(new Set(x)))};
g.T(alb,oV);alb.prototype.Y=function(){var x=[];this.S.descriptionEntity&&x.push(this.S.descriptionEntity);this.S.creators&&x.push.apply(x,g.qc(this.S.creators));this.S.theBiggestFan&&x.push(this.S.theBiggestFan);return[].concat(g.qc(new Set(x)))};
g.T(Fjt,oV);Fjt.prototype.Y=function(){return[]};
g.T(qn$,oV);qn$.prototype.Y=function(){return[]};
g.T(dMm,oV);dMm.prototype.Y=function(){return[]};
g.T(zz$,oV);zz$.prototype.Y=function(){return[]};
g.T(TUx,oV);TUx.prototype.Y=function(){return[]};
g.T(Puh,oV);Puh.prototype.Y=function(){return[]};
g.T(vL9,oV);vL9.prototype.Y=function(){return[]};
g.T(Wjs,oV);Wjs.prototype.Y=function(){return[]};
g.T(YnR,oV);YnR.prototype.Y=function(){return[]};
g.T(Ilt,oV);Ilt.prototype.Y=function(){var x=[];this.S.downloadsList&&x.push(this.S.downloadsList);this.S.smartDownloadsList&&x.push(this.S.smartDownloadsList);this.S.recommendedDownloadsList&&x.push(this.S.recommendedDownloadsList);this.S.refresh&&x.push(this.S.refresh);return[].concat(g.qc(new Set(x)))};
g.T(NUx,m2);NUx.prototype.Y=function(){var x=[];this.S.video&&x.push(this.S.video);this.S.playlist&&x.push(this.S.playlist);this.S.videoItem&&x.push(this.S.videoItem);this.S.playlistItem&&x.push(this.S.playlistItem);return[].concat(g.qc(new Set(x)))};
g.T(rsH,oV);rsH.prototype.Y=function(){var x=[];this.S.refresh&&x.push(this.S.refresh);if(this.S.downloads)for(var S=g.v(this.S.downloads),Z=S.next();!Z.done;Z=S.next())x.push.apply(x,g.qc((new NUx(Z.value)).Y()));return[].concat(g.qc(new Set(x)))};
g.T(iMb,oV);iMb.prototype.Y=function(){var x=[];this.S.localImageEntities&&x.push.apply(x,g.qc(this.S.localImageEntities));return[].concat(g.qc(new Set(x)))};
g.T(Qin,oV);Qin.prototype.Y=function(){var x=[];this.S.playbackData&&x.push(this.S.playbackData);this.S.localImageEntities&&x.push.apply(x,g.qc(this.S.localImageEntities));this.S.videoDownloadContextEntity&&x.push(this.S.videoDownloadContextEntity);return[].concat(g.qc(new Set(x)))};
g.T(siJ,oV);siJ.prototype.Y=function(){return[]};
g.T(flt,oV);flt.prototype.Y=function(){var x=[];this.S.fakeChildren&&x.push.apply(x,g.qc(this.S.fakeChildren));return[].concat(g.qc(new Set(x)))};
g.T(ELv,oV);ELv.prototype.Y=function(){var x=[];this.S.video&&x.push(this.S.video);this.S.playbackData&&x.push(this.S.playbackData);this.S.offlineVideoPolicy&&x.push(this.S.offlineVideoPolicy);return[].concat(g.qc(new Set(x)))};
g.T(BUJ,oV);BUJ.prototype.Y=function(){return[]};
g.T(VMb,oV);VMb.prototype.Y=function(){var x=[];this.S.channelOwner&&x.push(this.S.channelOwner);this.S.videos&&x.push.apply(x,g.qc(this.S.videos));this.S.collaboratorChannels&&x.push.apply(x,g.qc(this.S.collaboratorChannels));this.S.downloadState&&x.push(this.S.downloadState);this.S.refresh&&x.push(this.S.refresh);return[].concat(g.qc(new Set(x)))};
g.T(nL$,oV);nL$.prototype.Y=function(){var x=[];this.S.video&&x.push(this.S.video);this.S.channelContributor&&x.push(this.S.channelContributor);return[].concat(g.qc(new Set(x)))};
g.T(KjR,m2);KjR.prototype.Y=function(){var x=[];this.S.localImageEntities&&x.push.apply(x,g.qc(this.S.localImageEntities));this.S.videoDownloadContextEntity&&x.push(this.S.videoDownloadContextEntity);return[].concat(g.qc(new Set(x)))};
g.T(GiR,m2);GiR.prototype.Y=function(){var x=[];this.S.recommendedVideoMetadata&&x.push.apply(x,g.qc((new KjR(this.S.recommendedVideoMetadata)).Y()));return[].concat(g.qc(new Set(x)))};
g.T(bMJ,m2);bMJ.prototype.Y=function(){var x=[];this.S.playbackPosition&&x.push(this.S.playbackPosition);return[].concat(g.qc(new Set(x)))};
g.T(mM$,oV);mM$.prototype.Y=function(){var x=[];this.S.owner&&x.push(this.S.owner);this.S.downloadState&&x.push(this.S.downloadState);this.S.userState&&x.push.apply(x,g.qc((new bMJ(this.S.userState)).Y()));this.S.additionalMetadata&&x.push.apply(x,g.qc((new GiR(this.S.additionalMetadata)).Y()));return[].concat(g.qc(new Set(x)))};
g.T(oLh,oV);oLh.prototype.Y=function(){var x=[];this.S.userChannelDetails&&x.push(this.S.userChannelDetails);return[].concat(g.qc(new Set(x)))};
g.T(OMt,oV);OMt.prototype.Y=function(){var x=[];this.S.channelOwner&&x.push(this.S.channelOwner);this.S.playbackPosition&&x.push(this.S.playbackPosition);this.S.localImageEntities&&x.push.apply(x,g.qc(this.S.localImageEntities));this.S.downloadStatus&&x.push(this.S.downloadStatus);return[].concat(g.qc(new Set(x)))};
g.T(hzt,oV);hzt.prototype.Y=function(){return[]};
g.T(HMm,oV);HMm.prototype.Y=function(){return[]};
g.T(UMH,oV);UMH.prototype.Y=function(){return[]};
g.T(Asx,oV);Asx.prototype.Y=function(){return[]};
g.T(RzH,oV);RzH.prototype.Y=function(){return[]};
g.T(w_R,oV);w_R.prototype.Y=function(){return[]};
g.T(DMJ,oV);DMJ.prototype.Y=function(){return[]};
g.T(MMJ,oV);MMJ.prototype.Y=function(){return[]};
g.T(gLs,oV);gLs.prototype.Y=function(){return[]};
g.T(llJ,oV);llJ.prototype.Y=function(){return[]};
g.T(ysb,oV);ysb.prototype.Y=function(){return[]};
g.T(p_J,oV);p_J.prototype.Y=function(){return[]};
g.T($MS,oV);$MS.prototype.Y=function(){return[]};
g.T(x5J,oV);x5J.prototype.Y=function(){var x=[];this.S.compositeSourceKeys&&x.push.apply(x,g.qc(this.S.compositeSourceKeys));return[].concat(g.qc(new Set(x)))};
g.T(SD9,oV);SD9.prototype.Y=function(){var x=[];this.S.trackDownloadMetadatas&&x.push.apply(x,g.qc(this.S.trackDownloadMetadatas));return[].concat(g.qc(new Set(x)))};
g.T(jLt,oV);
jLt.prototype.Y=function(){var x=[];this.S.downloadedTracks&&x.push.apply(x,g.qc(this.S.downloadedTracks));this.S.smartDownloadedTracks&&x.push.apply(x,g.qc(this.S.smartDownloadedTracks));this.S.downloadedEpisodes&&x.push.apply(x,g.qc(this.S.downloadedEpisodes));this.S.downloadedAlbumReleases&&x.push.apply(x,g.qc(this.S.downloadedAlbumReleases));this.S.smartDownloadedAlbumReleases&&x.push.apply(x,g.qc(this.S.smartDownloadedAlbumReleases));this.S.downloadedPlaylists&&x.push.apply(x,g.qc(this.S.downloadedPlaylists));this.S.smartDownloadedPlaylists&&
x.push.apply(x,g.qc(this.S.smartDownloadedPlaylists));this.S.metadataOnlyTracks&&x.push.apply(x,g.qc(this.S.metadataOnlyTracks));return[].concat(g.qc(new Set(x)))};
g.T(ZW9,oV);ZW9.prototype.Y=function(){var x=[];this.S.trackDownloadMetadatas&&x.push.apply(x,g.qc(this.S.trackDownloadMetadatas));return[].concat(g.qc(new Set(x)))};
g.T(kh9,oV);kh9.prototype.Y=function(){var x=[];this.S.playbackData&&x.push(this.S.playbackData);this.S.localImageEntities&&x.push.apply(x,g.qc(this.S.localImageEntities));this.S.videoDownloadContextEntity&&x.push(this.S.videoDownloadContextEntity);return[].concat(g.qc(new Set(x)))};
g.T(eGb,oV);eGb.prototype.Y=function(){var x=[];this.S.musicLibraryStatusEntity&&x.push(this.S.musicLibraryStatusEntity);this.S.primaryArtists&&x.push.apply(x,g.qc(this.S.primaryArtists));this.S.details&&x.push(this.S.details);this.S.userDetails&&x.push(this.S.userDetails);this.S.tracks&&x.push.apply(x,g.qc(this.S.tracks));this.S.share&&x.push(this.S.share);this.S.downloadMetadata&&x.push(this.S.downloadMetadata);this.S.refresh&&x.push(this.S.refresh);return[].concat(g.qc(new Set(x)))};
g.T(uit,oV);uit.prototype.Y=function(){var x=[];this.S.albumRelease&&x.push(this.S.albumRelease);this.S.tracks&&x.push.apply(x,g.qc(this.S.tracks));return[].concat(g.qc(new Set(x)))};
g.T(CDJ,oV);CDJ.prototype.Y=function(){var x=[];this.S.albumRelease&&x.push(this.S.albumRelease);return[].concat(g.qc(new Set(x)))};
g.T(trh,oV);trh.prototype.Y=function(){var x=[];this.S.details&&x.push(this.S.details);this.S.userDetails&&x.push(this.S.userDetails);return[].concat(g.qc(new Set(x)))};
g.T(LGR,oV);LGR.prototype.Y=function(){var x=[];this.S.parentArtist&&x.push(this.S.parentArtist);return[].concat(g.qc(new Set(x)))};
g.T(ch$,oV);ch$.prototype.Y=function(){var x=[];this.S.parentArtist&&x.push(this.S.parentArtist);return[].concat(g.qc(new Set(x)))};
g.T(JhJ,oV);JhJ.prototype.Y=function(){return[]};
g.T(Xut,oV);Xut.prototype.Y=function(){return[]};
g.T(aab,m2);aab.prototype.Y=function(){var x=[];this.S.creatorEntity&&x.push(this.S.creatorEntity);return[].concat(g.qc(new Set(x)))};
g.T(FGb,oV);
FGb.prototype.Y=function(){var x=[];this.S.tracks&&x.push.apply(x,g.qc(this.S.tracks));this.S.refresh&&x.push(this.S.refresh);this.S.musicLibraryStatusEntity&&x.push(this.S.musicLibraryStatusEntity);this.S.details&&x.push(this.S.details);this.S.downloadMetadata&&x.push(this.S.downloadMetadata);this.S.sideloadMetadata&&x.push(this.S.sideloadMetadata);this.S.userDetails&&x.push(this.S.userDetails);this.S.entryCollection&&x.push(this.S.entryCollection);this.S.share&&x.push(this.S.share);this.S.podcastShowAdditionalMetadata&&
x.push.apply(x,g.qc((new aab(this.S.podcastShowAdditionalMetadata)).Y()));return[].concat(g.qc(new Set(x)))};
g.T(qD9,oV);qD9.prototype.Y=function(){return[]};
g.T(d5H,oV);
d5H.prototype.Y=function(){var x=[];this.S.musicLibraryStatusEntity&&x.push(this.S.musicLibraryStatusEntity);this.S.artists&&x.push.apply(x,g.qc(this.S.artists));this.S.audioModeVersion&&x.push(this.S.audioModeVersion);this.S.videoModeVersion&&x.push(this.S.videoModeVersion);this.S.userDetails&&x.push(this.S.userDetails);this.S.details&&x.push(this.S.details);this.S.albumRelease&&x.push(this.S.albumRelease);this.S.share&&x.push(this.S.share);this.S.libraryEdit&&x.push(this.S.libraryEdit);this.S.downloadMetadata&&
x.push(this.S.downloadMetadata);this.S.playbackPosition&&x.push(this.S.playbackPosition);this.S.lyrics&&x.push(this.S.lyrics);return[].concat(g.qc(new Set(x)))};
g.T(zGs,oV);zGs.prototype.Y=function(){var x=[];this.S.parentTrack&&x.push(this.S.parentTrack);return[].concat(g.qc(new Set(x)))};
g.T(TOH,oV);TOH.prototype.Y=function(){var x=[];this.S.parentTrack&&x.push(this.S.parentTrack);return[].concat(g.qc(new Set(x)))};
g.T(PDR,oV);PDR.prototype.Y=function(){return[]};
g.T(v$v,oV);v$v.prototype.Y=function(){return[]};
g.T(WG$,oV);WG$.prototype.Y=function(){return[]};
g.T(YDs,oV);YDs.prototype.Y=function(){return[]};
g.T(Ian,oV);Ian.prototype.Y=function(){var x=[];this.S.transfer&&x.push(this.S.transfer);this.S.adsPlaybackData&&x.push.apply(x,g.qc(this.S.adsPlaybackData));this.S.drmLicense&&x.push(this.S.drmLicense);this.S.offlineVideoPolicy&&x.push(this.S.offlineVideoPolicy);this.S.videoDownloadContextEntity&&x.push(this.S.videoDownloadContextEntity);return[].concat(g.qc(new Set(x)))};
g.T(NOn,oV);NOn.prototype.Y=function(){return[]};
g.T(rhR,oV);rhR.prototype.Y=function(){var x=[];this.S.offlineVideoStreams&&x.push.apply(x,g.qc(this.S.offlineVideoStreams));this.S.captionTrack&&x.push.apply(x,g.qc(this.S.captionTrack));return[].concat(g.qc(new Set(x)))};
g.T(iW9,oV);iW9.prototype.Y=function(){return[]};
g.T(QL$,oV);QL$.prototype.Y=function(){return[]};
g.T(sLS,oV);sLS.prototype.Y=function(){return[]};
g.T(fa$,oV);fa$.prototype.Y=function(){return[]};
g.T(E$R,oV);E$R.prototype.Y=function(){return[]};
g.T(BOJ,oV);BOJ.prototype.Y=function(){return[]};
g.T(Vr9,oV);Vr9.prototype.Y=function(){return[]};
g.T(n$R,oV);n$R.prototype.Y=function(){return[]};
g.T(KGm,oV);KGm.prototype.Y=function(){return[]};
g.T(GhR,oV);GhR.prototype.Y=function(){return[]};
g.T(bWs,oV);bWs.prototype.Y=function(){return[]};
g.T(m5t,oV);m5t.prototype.Y=function(){return[]};
g.T(o$x,oV);o$x.prototype.Y=function(){return[]};
g.T(OWm,oV);OWm.prototype.Y=function(){return[]};
g.T(hGH,oV);hGH.prototype.Y=function(){return[]};
g.T(HWm,oV);HWm.prototype.Y=function(){return[]};
g.T(U5s,oV);U5s.prototype.Y=function(){return[]};
g.T(Aht,oV);Aht.prototype.Y=function(){return[]};
g.T(RGx,oV);RGx.prototype.Y=function(){return[]};
g.T(wub,oV);wub.prototype.Y=function(){return[]};
g.T(D5x,oV);D5x.prototype.Y=function(){return[]};
g.T(MrR,oV);MrR.prototype.Y=function(){return[]};
var Dhb=["browse","music/browse","unplugged/browse"],pZH=["offline/playlist_sync_check"],mhH=["offline"],M49=["offline/offline_video_playback_position_sync"],l$x=["offline/get_playback_data_entity"],OW;hB.getInstance=function(){return g.V(function(x){return x.return(new Promise(function(S){g.pQ().then(function(Z){Z?(hB.instance||(hB.instance=new hB(Z)),S(hB.instance)):S(void 0)})}))})};
hB.prototype.get=function(x){var S=this,Z,k,e;return g.V(function(u){if(u.S==1)return g.B(u,put(S.token),2);if(u.S!=3)return Z=u.Y,g.B(u,Z.get("prefs",x),3);k=u.Y;if(!k)return u.return();e=(0,g.rr)();return k.expirationTimestampMs<=e?u.return():u.return(k.value)})};
hB.prototype.set=function(x,S,Z){Z=Z===void 0?31536E3:Z;var k=this,e,u,C;return g.V(function(L){if(L.S==1)return e=(0,g.rr)(),u={key:x,value:S,expirationTimestampMs:e+Z*1E3},g.B(L,put(k.token),2);C=L.Y;return g.B(L,g.nQ(C,"prefs",u),0)})};
hB.prototype.remove=function(x){var S=this,Z;return g.V(function(k){if(k.S==1)return g.B(k,put(S.token),2);Z=k.Y;return g.B(k,Z.delete("prefs",x),0)})};
g.T(H0,g.MG);g.T(UW,ZRb);UW.prototype.D=function(x,S){S=en$(S);x=(new TextEncoder).encode(JSON.stringify(x));return this.S.encrypt(x,S)};
UW.prototype.Y=function(x,S){if(!(x instanceof Uint8Array))throw $5J(1);var Z=new TextDecoder;S=en$(S);x=this.S.decrypt(x,S);return JSON.parse(Z.decode(x))};
var uFn={accountLinkStatusEntity:dMm,booleanEntity:CuH,buttonEntity:hGH,captionTrack:PDR,channelHandle:kiH,chipEntity:Vr9,commerceAcquisitionClientPayloadEntity:U5s,commerceCartListEntity:Aht,compositeSourceEntity:$MS,multiviewStagingEntity:x5J,contextNoteFeedEntityPayload:ezH,contextNoteUserRatingEntityPayload:us9,continuationTokenEntity:BUJ,downloadQualityPickerEntity:vL9,downloadsPageRefreshTokenEntity:YnR,downloadsPageViewConfigurationEntity:hzt,downloadStatusEntity:Wjs,dismissState:n$R,sfvAudioItemCurrentlyPlayingEntity:fa$,
emojiFountainDataEntity:o$x,emojiCustomizationSetEntity:m5t,fakeChannel:Ljx,fakePlaylist:csJ,fakePlaylistEntryCollection:X_9,fakeVideo:alb,fakeVideoDescription:Fjt,featuredProductsEntity:llJ,flowStateEntity:qn$,iconBadgeEntity:RGx,interstitialInteractionStateEntity:TUx,likeButtonAnimationEntity:HMm,liveChatPollStateEntity:Puh,dataFreshnessEntity:bWs,liveViewerLeaderboardChatEntryPointStateEntity:QL$,liveViewerLeaderboardPointsEntity:sLS,liveReactionsDataEntity:OWm,logoEntity:zz$,macroMarkerEntity:UMH,
mainDownloadsLibraryEntity:Ilt,mainDownloadsListEntity:rsH,mainPlaylistDownloadStateEntity:iMb,mainPlaylistEntity:VMb,mainPlaylistVideoEntity:nL$,mainVideoDownloadStateEntity:Qin,mainVideoEntity:mM$,markersEngagementPanelSyncEntity:Asx,markersVisibilityOverrideEntity:RzH,musicAlbumReleaseDetail:uit,musicAlbumReleaseDownloadMetadataEntity:SD9,musicAlbumRelease:eGb,musicAlbumReleaseUserDetail:CDJ,musicArtistDetail:LGR,musicArtist:trh,musicArtistUserDetail:ch$,musicDownloadsLibraryEntity:jLt,musicLibraryEdit:JhJ,
musicLibraryStatusEntity:Xut,musicPlaylist:FGb,musicPlaylistDownloadMetadataEntity:ZW9,musicShare:qD9,musicTrackDetail:zGs,musicTrackDownloadMetadataEntity:kh9,musicTrack:d5H,musicTrackUserDetail:TOH,offlineOrchestrationActionWrapperEntity:v$v,offlineVideoPolicy:WG$,offlineVideoStreams:YDs,offlineabilityEntity:siJ,orchestrationWebSamplingEntity:flt,pageHeaderEntity:KGm,pdpStateEntity:wub,pinnedProductEntity:ysb,playbackData:Ian,playerStateEntity:w_R,quantityIncrementerEntity:D5x,refresh:NOn,saveToPlaylistListEntity:E$R,
selectedChipIndexEntityPayload:DMJ,settingEntity:BOJ,stringEntity:tMv,suggestedFeedbackChipStateEntity:MMJ,transfer:rhR,trendingOfferEntity:p_J,videoDownloadContextEntity:iW9,videoOverviewAsyncDataEntity:MrR,videoPlaybackPositionEntity:HWm,votingEntity:GhR,ytMainChannelEntity:oLh,youchatPendingResponseEntity:gLs,ytMainDownloadedVideoEntity:ELv,ytMainVideoEntity:OMt};g.T(gf,ZRb);gf.prototype.D=function(x){return x};
gf.prototype.Y=function(x){if(x instanceof Uint8Array)throw $5J(0);return x};
g.T(la,g.m);la.prototype.observe=function(x){var S=this;this.observers.push(x);return function(){var Z=S.observers.indexOf(x);Z>=0&&S.observers.splice(Z,1)}};
la.prototype.Y=function(x){v0R(this,x.data)};
la.prototype.VN=function(){this.channel.close()};
var rzH,I$H=new g.Ew("elementsCommand");var rM=new g.Ew("entityBatchUpdate");var Jtt=new g.Ew("downloadStatusEntity");var iYs=new g.Ew("mainPlaylistEntityActionMetadata");var y4=new g.Ew("mainVideoEntityActionMetadata");var bgR=new g.Ew("musicPlaylistEntityActionMetadata");var CHv=new g.Ew("musicTrackEntityActionMetadata");var HYb=new g.Ew("localImageEntityActionMetadata");var bg=new g.Ew("playbackDataActionMetadata");var ICv=new g.Ew("transferEntityActionMetadata");var LgH=new g.Ew("videoPlaybackPositionEntityActionMetadata");var hnx;new g.qT;new g.qT;w3R.prototype.request=function(x,S,Z){S=S===void 0?{}:S;return this.locks.request(x,S,function(k){return Z(k)})};var kq=g.$b.caches,ZG,yzS;jc.prototype.open=function(x){return kq.open(g0v(x))};
jc.prototype.has=function(x){return kq.has(g0v(x))};
jc.prototype.delete=function(x){return kq.delete(g0v(x))};
jc.prototype.match=function(x,S){var Z=this,k,e,u,C,L,c;return g.V(function(J){switch(J.S){case 1:return g.B(J,Z.keys(),2);case 2:k=J.Y,e=g.v(k),u=e.next();case 3:if(u.done){J.OT(5);break}C=u.value;return g.B(J,Z.open(C),6);case 6:return L=J.Y,g.B(J,L.match(x,S),7);case 7:if(c=J.Y)return J.return(c);u=e.next();J.OT(3);break;case 5:return J.return()}})};
g.T(MEH,jc);MEH.prototype.keys=function(){var x,S,Z,k,e,u,C,L,c;return g.V(function(J){if(J.S==1)return x=[],S=g.g3("CacheStorage keys"),g.B(J,kq.keys(),2);Z=J.Y;k=g.v(Z);for(e=k.next();!e.done;e=k.next()){u=e.value;var X=u.indexOf(":");C=X===-1?{U1:u}:{U1:u.substring(0,X),datasyncId:u.substring(X+1)};L=C.U1;c=C.datasyncId;c===S&&x.push(L)}return J.return(x)})};g.T(ug,g.m);ug.prototype.D=function(x){this.api.XL("onOfflineOperationFailure",x.data)};
ug.prototype.G=function(x){this.api.publish("offlinetransferpause",x.data)};
ug.prototype.VN=function(){var x;(x=this.S)==null||x.close();var S;(S=this.Y)==null||S.close()};xhS.prototype.Kb=function(){this.S&&tL(this)};
xhS.prototype.MA=function(){this.Y&&this.Y.resolve();this.D=this.S=!1;this.j()};var O$R=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var vhS="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var BiJ="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.T(xXh,ns);xXh.prototype.Y=function(x){return Xd(x)?Z$$(this,x):af(x)?uLn(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};g.T(C$H,ns);C$H.prototype.Y=function(x){return af(x)?thR(this,x):cts(x)?cC9(this,x):Fd(x)?JCv(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};g.z=X8n.prototype;g.z.K0r=function(x){var S=this,Z,k,e,u;return g.V(function(C){if(!g.D(x.state,128))return C.OT(0);Z=x.state.gH;var L=(k=Z)==null?void 0:k.errorCode,c=(e=Z)==null?void 0:e.Od;u=L==="net.connect"&&c===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(L==null?0:L.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.B(C,S.c7(S.player.getVideoData().videoId,u),0)})};
g.z.c7=function(x,S){var Z=this;return g.V(function(k){if(k.S==1){if(Z.Y)return k.return();Z.Y=!0;return S==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Oi(Z,x,!1,!0),k.OT(0)):g.B(k,of(Z,x),3)}g.t_(x,4);return g.B(k,Z.S.c7(S),0)})};
g.z.b5=function(x){x.status===2?(x.status!==this.D&&(Cdt(this.S),g.t_(x.videoId,2)),x.W2&&Xwx(this.S,x.videoId,x.W2)):x.status===4?(of(this,x.videoId),this.c7(x.videoId,x.TA?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):x.status===1&&Jpx(this.S);this.D=x.status;this.api.XL("localmediachange",{videoId:x.videoId,status:x.status})};
g.z.eP=function(){var x=this,S;return g.V(function(Z){if(Z.S==1){if(x.Y)return Z.return();x.Y=!0;S=x.player.getVideoData().videoId;return g.B(Z,of(x,S),2)}return g.B(Z,x.S.eP(),0)})};
g.z.gR=function(x){switch(x){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.z.Z=function(x){return this.api.U().Z(x)};g.T(TpS,ns);TpS.prototype.Y=function(x){return Xd(x)?vNm(this,x):af(x)?Wgn(this,x):cts(x)?Ygt(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};s3m.prototype.S=function(x,S){var Z=x.action.actionMetadata.priority-S.action.actionMetadata.priority;Z===0&&(x.S<S.S?Z=-1:x.S>S.S&&(Z=1));return Z};g.T(hL,g.m);hL.prototype.VN=function(){this.j&&this.j();g.m.prototype.VN.call(this)};
hL.prototype.createAction=function(x,S){var Z=g.xl(x.entityKey).entityType,k=g.PS(16);return new PL(Z,k,x,S.actionId,S.rootActionId)};
hL.prototype.GS=function(x){var S=this,Z,k,e,u,C,L,c,J,X;return g.V(function(a){if(a.S==1){if(S.Jg())return a.return();k=(Z=x.offlineOrchestrationActionWrapperEntity)!=null?Z:new Set;e=[];u=g.v(k);for(C=u.next();!C.done;C=u.next())L=C.value,c=g.xl(L),J=c.entityId,Bpm(S.S,J)||e.push(L);return g.B(a,UXs(S,e),2)}X=a.Y;return g.B(a,H$v(S,X),0)})};
hL.prototype.retry=function(){var x=this;return g.V(function(S){return g.B(S,ACx(x),0)})};w8h.prototype.U9=function(x,S){S=S===void 0?!0:S;var Z=this,k,e,u,C,L,c,J,X;return g.V(function(a){switch(a.S){case 1:if(!Z.S)return a.return();k=[];e=g.j9(Z.S.Y,S);u=[];for(C={wO:0};C.wO<e.length;C={wO:C.wO},C.wO++)L=e[C.wO],c=Z.S.Ei(L,"json3"),J=g.nG(c,{withCredentials:!0,format:"RAW"},3,500).then(function(F){return function(q){q={metadata:g.DD(e[F.wO]),trackData:q.xhr.responseText};u.push(q)}}(C)).r0(function(F){ec("Caption fetch error",F)}),k.push(J);
return g.B(a,ZMt(k),2);case 2:return g.Nc(a,3),g.B(a,n0b(x,u),5);case 5:g.f4(a,0);break;case 3:X=g.EO(a),ec("Caption DB transaction error",X),g.Iq(a)}})};g.T(HL,g.m);HL.prototype.VN=function(){this.Y&&this.Y();g.m.prototype.VN.call(this)};
HL.prototype.D=function(x){var S=this,Z,k,e,u,C,L,c,J;return g.V(function(X){k=(Z=x.transfer)!=null?Z:new Set;e=[];u=g.v(k);for(C=u.next();!C.done;C=u.next())L=C.value,c=g.xl(L),J=c.entityId,e.push(J);return e.length===0?X.return():g.B(X,gNJ(S,e),0)})};g.T(xf9,g.m);g.z=xf9.prototype;g.z.VN=function(){this.yN&&this.yN();this.hg.dispose();this.G.dispose();this.FL&&g.Sr(this.L.On,this.FL);this.R5&&g.Sr(this.L.On,this.R5);g.m.prototype.VN.call(this)};
g.z.BK5=function(x){var S=this,Z,k,e;return g.V(function(u){switch(u.S){case 1:Z=g.S5(x,"transfer");if(S.S&&Z===S.S.key){Oi(S.N,S.B,!0);S.G.stop();u.OT(0);break}return g.B(u,y9(S.Y,{mode:"readwrite",tS:!0},function(C){return AB(C,Z,"transfer").then(function(L){if(L&&L.transferState!=="TRANSFER_STATE_COMPLETE"&&L.transferState!=="TRANSFER_STATE_FAILED")return L.transferState="TRANSFER_STATE_PAUSED_BY_USER",D6(C,L,"transfer").then(function(){return L})})}),3);
case 3:k=u.Y;if(!k){u.OT(0);break}if(!x||!S.D){u.OT(5);break}return g.B(u,qP(x,S.D,S.Y,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.B(u,Rf(S,x),7);case 7:e=u.Y,t4R({videoId:x,X8:k,offlineModeType:e}),g.Iq(u)}})};
g.z.vWG=function(){var x=this;if(this.S&&this.B){Oi(this.N,this.B,!1);var S=this.S,Z=(S==null?0:S.key)?g.xl(S.key).entityId:"";Z&&this.D&&(new Promise(function(k,e){qP(Z,x.D,x.Y,"DOWNLOAD_STATE_PAUSED").catch(function(u){e(u)})})).catch(function(k){ec("Download state setting error",k)})}this.G.stop()};
g.z.aK=function(){this.S?ZYh(this,this.S):AL(this)};
g.z.i9=function(x){var S=this;return g.V(function(Z){switch(Z.S){case 1:if(!S.S){Z.OT(2);break}if(S.S.transferState==="TRANSFER_STATE_COMPLETE"||S.S.transferState==="TRANSFER_STATE_FAILED"||!x.transfer||!x.transfer.has(S.S.key)){Z.OT(3);break}return g.B(Z,$i(S.Y,S.S.key,"transfer"),4);case 4:S.S=Z.Y;if(S.S){Z.OT(3);break}return g.B(Z,kgS(S),3);case 3:if(S.S)return Z.return();case 2:return g.B(Z,AL(S),0)}})};
g.z.c7=function(x,S){var Z=this,k,e,u,C,L;return g.V(function(c){switch(c.S){case 1:if(!Z.S){wM(Z,"onTransferFailure: "+x);c.OT(2);break}k=Z.S;u=((e=k)==null?0:e.key)?g.xl(k.key).entityId:"";a:switch(x){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var J=!1;break a;default:J=!0}return J&&avs(Z)?g.B(c,DG(Z,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.B(c,
FBx(Z,x),5);case 5:if(!u||!Z.D){c.OT(2);break}return g.B(c,qP(u,Z.D,Z.Y,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.B(c,Rf(Z,u),9);case 9:C=c.Y;cL({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:u,X8:k,offlineModeType:C});if(!u||!Z.D){c.OT(2);break}return g.B(c,qP(u,Z.D,Z.Y,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Ui(Z),L=AL(Z,!0),S&&S(L),g.Iq(c)}})};
g.z.eP=function(x){var S=this,Z,k,e,u,C,L,c,J,X,a,F,q;return g.V(function(d){switch(d.S){case 1:if(!S.S){wM(S,"onMaybeTransferStreamsExpired");d.OT(2);break}return avs(S)?g.B(d,DG(S,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.B(d,FBx(S,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!S.D){d.OT(2);break}Z=S.S;e=((k=Z)==null?0:k.key)?g.xl(Z.key).entityId:"";if(!e){d.OT(2);break}return g.B(d,qP(e,S.D,S.Y,"DOWNLOAD_STATE_FAILED"),2);case 9:return S.S||wM(S,"onMaybeTransferStreamsExpiredRetryAttempting"),
u=S.S,L=((C=u)==null?0:C.key)?g.xl(u.key).entityId:"",g.B(d,Rf(S,L),10);case 10:return c=d.Y,cL({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:L,X8:u,offlineModeType:c}),J=Fkt(),g.oa(J,bg,{isEnqueuedForExpiredStreamUrlRefetch:!0}),X=g.S5(L,"playbackData"),a={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:X,actionMetadata:J},F=WL(new PL("playbackData",L,a)),g.B(d,p5(S.Y,F,"offlineOrchestrationActionWrapperEntity"),2);case 2:Ui(S),q=AL(S,!0),
x&&x(q),g.Iq(d)}})};
var TNh={},qwm=(TNh.TRANSFER_STATE_TRANSFERRING=1,TNh.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,TNh);g.z=MP.prototype;g.z.XZ=function(){return this.B.promise};
g.z.Be=function(){if(this.Y&&this.N)return this.B.promise;TFJ(this).then(this.B.resolve).catch(this.B.reject);return this.B.promise};
g.z.Em=function(x){var S={};return S.playbackData=new xXh(x,this.Sy,this.S),S.transfer=new TpS(x,this.Sy),S.videoPlaybackPositionEntity=new C$H(x,this.Sy),S};
g.z.F_=function(){var x=this;return g.V(function(S){return x.Y?g.B(S,Swv(x.Y),0):S.OT(0)})};
g.z.Z5=function(){var x=this,S,Z;return g.V(function(k){if(k.S==1)return x.Y||x.N?g.B(k,x.XZ(),2):k.return();x.X!==void 0&&(g.YV(x.X),x.X=void 0);x.G!==void 0&&(g.YV(x.G),x.G=void 0);(S=x.Y)==null||S.dispose();x.Y=void 0;(Z=x.N)==null||Z.dispose();x.N=void 0;x.api.XL("onOrchestrationLostLeader");x.B=new g.qT;g.Iq(k)})};
g.z.isOrchestrationLeader=function(){return this.D.S};
g.z.KF=function(){return g.V(function(x){return x.return(!1)})};
g.z.UP=function(x){var S=this.S;S.api.publish("offlinetransferpause",x);var Z;(Z=S.Y)==null||Z.postMessage(x)};
g.z.aK=function(x){var S,Z;return g.V(function(k){if(k.S==1)return g.B(k,Sc(),2);S=k.Y;if(!S)return k.return();Z=g.S5(x,"transfer");return g.B(k,y9(S,{mode:"readwrite",tS:!0},function(e){var u=AB(e,Z,"transfer"),C=AB(e,g.S5(x,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.WR.all([u,C]).then(function(L){L=g.v(L);var c=L.next().value;var J=L.next().value;return c&&c.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(c.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",D6(e,c,"transfer").then(function(){cL({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:x,X8:c,offlineModeType:J==null?void 0:J.offlineModeType});return g.WR.resolve(null)})):g.WR.resolve(null)})}),0)})};
g.z.DH=function(x){x=x===void 0?43200:x;var S=this,Z,k,e,u,C,L,c,J;return g.V(function(X){if(X.S==1)return S.L.Ok()?g.B(X,Sc(),2):X.return(Pds());if(X.S!=3){Z=X.Y;if(!Z)return X.return([]);k=Date.now()/1E3;return g.B(X,xq(Z,"offlineVideoPolicy"),3)}e=X.Y;u=[];C=g.v(e);for(L=C.next();!L.done;L=C.next())c=L.value,Number(c.lastUpdatedTimestampSeconds)+x<=k&&(J=g.xl(c.key).entityId,u.push(J));return u.length?X.return(gM(S,u,S.j,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):X.return([])})};
g.z.deleteAll=function(){return gM(this,["!*$_ALL_ENTITIES_!*$"],this.j,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.z.refreshAllStaleEntities=function(x){var S=this;return g.V(function(Z){return Z.S==1?g.B(Z,S.DH(x),2):Z.return(Z.Y)})};
g.z.setUpPositionSyncInterval=function(x){var S=this;this.G!==void 0&&(g.YV(this.G),this.G=void 0);var Z=x!=null?x:864E5;this.G=g.vv(function(){S.Vj(Z)},Z)};
g.z.Vj=function(x){var S=this,Z,k,e,u,C,L;return g.V(function(c){switch(c.S){case 1:return g.Nc(c,2),g.B(c,hB.getInstance(),4);case 4:Z=c.Y;if(!Z)throw Error("prefStorage is undefined");return g.B(c,Z.get("psi"),5);case 5:k=c.Y;u=((e=k)==null?0:e.Bs)?Number(k.Bs)/1E3:0;C=Date.now();if(!(u+x<=C)){c.OT(6);break}return g.B(c,gM(S,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.f4(c,0);break;case 2:L=g.EO(c),ec("Offline manager error",L),
g.Iq(c)}})};
g.z.Mj=function(){var x=this,S,Z,k,e,u,C,L;return g.V(function(c){if(c.S==1)return g.B(c,Sc(),2);if(c.S!=3)return(S=c.Y)?g.B(c,xq(S,"transfer"),3):c.return([]);Z=c.Y;k=[];e=g.v(Z);for(u=e.next();!u.done;u=e.next())C=u.value,C.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&C.key&&(L=g.xl(C.key).entityId,k.push(L));return c.return(WBt(x,k))})};
g.z.Z_=function(){return g.V(function(x){return x.return([])})};
g.z.sB=function(){return g.V(function(x){g.Iq(x)})};
g.z.IF=function(){return g.V(function(x){g.Iq(x)})};g.T(YwR,ns);YwR.prototype.Y=function(x){return Xd(x)?rpm(this,x):af(x)?Qrv(this,x):Fd(x)?srn(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var lg=[10];g.T(ntn,ns);ntn.prototype.Y=function(x){return Xd(x)?bYJ(this,x):af(x)?mf9(this,x):Fd(x)?otm(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var GgR=[10];g.T(hfh,ns);hfh.prototype.Y=function(x){return af(x)?Ufs(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};g.T(Apt,MP);g.z=Apt.prototype;g.z.Em=function(x){var S=MP.prototype.Em.call(this,x);S.mainVideoEntity=new ntn(x,this.Sy,this.S);S.mainPlaylistEntity=new YwR(x,this.Sy,this.S);S.mainDownloadsListEntity=new hfh(x,this.Sy,this.S);return S};
g.z.refreshAllStaleEntities=function(x,S){var Z=this,k,e,u,C,L,c,J,X,a,F,q;return g.V(function(d){switch(d.S){case 1:k=[];if(!Z.Sy.Z("web_player_offline_playlist_auto_refresh")){d.OT(2);break}return g.B(d,Rfh(Z,x,S),3);case 3:k=d.Y;case 2:return g.B(d,hB.getInstance(),4);case 4:return e=d.Y,g.B(d,(u=e)==null?void 0:u.get("sdois"),5);case 5:return C=d.Y,g.B(d,(L=e)==null?void 0:L.get("lmqf"),6);case 6:c=d.Y;if(!C){d.OT(7);break}X=k;a=X.concat;return g.B(d,ww9(Z,C,(J=c)!=null?J:"SD",x===0),8);case 8:k=
a.call(X,d.Y);case 7:return F=k,q=F.concat,g.B(d,MP.prototype.refreshAllStaleEntities.call(Z,x,S),9);case 9:return k=q.call(F,d.Y),d.return(k)}})};
g.z.KF=function(x){var S,Z,k,e,u,C,L,c;return g.V(function(J){if(J.S==1)return g.B(J,Sc(),2);if(J.S!=3)return(S=J.Y)?g.B(J,$i(S,g.mm,"mainDownloadsListEntity"),3):J.return(!1);Z=J.Y;if((k=Z)==null?0:(e=k.downloads)==null?0:e.length)for(u=g.S5(x,"mainVideoEntity"),C=g.v(Z.downloads),L=C.next();!L.done;L=C.next())if(c=L.value,c.videoItem===u)return J.return(!0);return J.return(!1)})};
g.z.Z_=function(){var x=this,S,Z,k,e,u,C,L,c;return g.V(function(J){if(J.S==1)return g.B(J,Sc(),2);if(J.S!=3)return(S=J.Y)?g.B(J,xq(S,"downloadStatusEntity"),3):J.return([]);Z=J.Y;k=[];e=g.v(Z);for(u=e.next();!u.done;u=e.next())C=u.value,C.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&C.key&&(L=g.xl(C.key).entityId,k.push(L));return k.length?(c={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},J.return(gM(x,k,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
c))):J.return([])})};
g.z.IF=function(){var x;return g.V(function(S){return S.S==1?g.B(S,Sc(),2):(x=S.Y)?g.B(S,y9(x,{mode:"readwrite",tS:!0},function(Z){return RV(Z,"mainVideoEntity").then(function(k){var e=[];k=g.v(k);for(var u=k.next();!u.done;u=k.next()){u=u.value;var C=void 0;(C=u.userState)!=null&&C.playbackPosition||(C=g.xl(u.key).entityId,C={key:g.S5(C,"videoPlaybackPositionEntity"),videoId:C,lastPlaybackPositionSeconds:"0"},e.push(D6(Z,C,"videoPlaybackPositionEntity")),u.userState={playbackPosition:C.key},e.push(D6(Z,
u,"mainVideoEntity")))}return g.WR.all(e)})}),0):S.return()})};
g.z.sB=function(){var x,S,Z,k,e,u,C,L,c,J,X,a,F,q,d,W,I,f,Q,n,b,h,l,A,kb,cx,eQ,aq,SQ,Wx,ly,Xv,J$,hg,VR,kX,Km,UH;return g.V(function(L2){if(L2.S==1)return g.B(L2,Sc(),2);if(L2.S!=3){x=L2.Y;if(!x)return L2.return();S=g.S5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.B(L2,y9(x,{mode:"readonly",tS:!0},function(E){return g.WR.all([AB(E,S,"mainDownloadsListEntity"),AB(E,g.mm,"mainDownloadsListEntity"),RV(E,"mainVideoEntity"),RV(E,"mainPlaylistEntity")])}),3)}Z=L2.Y;
k=g.v(Z);e=k.next().value;u=k.next().value;C=k.next().value;L=k.next().value;c=e;J=u;X=C;a=L;F=new Set;if((q=c)==null?0:(d=q.downloads)==null?0:d.length)for(W=g.v(c.downloads),I=W.next();!I.done;I=W.next())f=I.value,Q=void 0,(n=(Q=f.videoItem)!=null?Q:f.playlistItem)&&F.add(n);if((b=J)==null?0:(h=b.downloads)==null?0:h.length)for(l=g.v(J.downloads),A=l.next();!A.done;A=l.next())kb=A.value,kb.videoItem&&F.add(kb.videoItem);cx=new Set;eQ=[];aq=g.v(a);for(SQ=aq.next();!SQ.done;SQ=aq.next()){Wx=SQ.value;
if(Wx.videos)for(ly=g.v(Wx.videos),Xv=ly.next();!Xv.done;Xv=ly.next())J$=Xv.value,(hg=JSON.parse(g.xl(J$).entityId).videoId)&&cx.add(hg);Wx.key&&!F.has(Wx.key)&&eQ.push(Wx.key)}VR=g.v(X);for(kX=VR.next();!kX.done;kX=VR.next())Km=kX.value,Km.key&&!F.has(Km.key)&&(UH=g.xl(Km.key).entityId,cx.has(UH)||eQ.push(Km.key));return eQ.length?g.B(L2,QNh(x,eQ),0):L2.OT(0)})};g.T(Df9,ns);Df9.prototype.Y=function(x){return Xd(x)?gtt(this,x):af(x)?lvH(this,x):Fd(x)?ypS(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var ps=[10];g.T($f$,ns);$f$.prototype.Y=function(x){return Xd(x)?S0H(this,x):af(x)?j8n(this,x):Fd(x)?ZGs(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var $q=[10];g.T(uT$,ns);uT$.prototype.Y=function(x){return Xd(x)?cDH(this,x):af(x)?JDx(this,x):Fd(x)?XvR(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var L_R=[10];g.T(xf,MP);xf.prototype.Em=function(x){var S=MP.prototype.Em.call(this,x);S.musicTrack=new uT$(x,this.S);S.musicPlaylist=new $f$(x,this.S);S.musicAlbumRelease=new Df9(x,this.S);return S};
xf.prototype.refreshAllStaleEntities=function(x,S){var Z=this,k,e,u;return g.V(function(C){if(C.S==1)return g.B(C,F_x(Z,x,S),2);if(C.S!=3)return e=k=C.Y,u=e.concat,g.B(C,MP.prototype.refreshAllStaleEntities.call(Z,x,S),3);k=u.call(e,C.Y);return C.return(k)})};g.T(q0S,g.Nx);g.z=q0S.prototype;g.z.create=function(){var x=this;g.O(this,this.events);if(g.iA(this.Sy))this.S=new Apt(this.Sy,this.player);else if(g.o4(this.Sy)||g.sb(this.Sy))this.S=new xf(this.Sy,this.player);this.events.W(this.player,"onPlaybackStartExternal",function(){x.gs()});
this.events.W(this.player,"videodatachange",function(){x.gs()});
this.Sy.Z("html5_offline_playback_position_sync")&&this.events.W(this.player,"presentingplayerstatechange",this.qc)};
g.z.l1=function(){return!1};
g.z.AT=function(x,S,Z,k){var e=this;return g.V(function(u){return e.S?u.return(gM(e.S,x,S,Z,k)):u.return(Promise.reject())})};
g.z.deleteAll=function(){return this.S.deleteAll()};
g.z.DH=function(x){return this.S.DH(x)};
g.z.refreshAllStaleEntities=function(x){return this.S.refreshAllStaleEntities(x)};
g.z.setUpPositionSyncInterval=function(x){this.S.setUpPositionSyncInterval(x)};
g.z.UP=function(x){this.S.UP(x)};
g.z.aK=function(x){return this.S.aK(x)};
g.z.gs=function(){var x=this,S;return g.V(function(Z){S=x.player.getVideoData();return g.WV(S)?dSm(S)&&x.Y!==S.clientPlaybackNonce?g.B(Z,zTt(x,S),0):Z.OT(0):Z.return()})};
g.z.qc=function(x){var S=this,Z,k,e,u,C,L,c;return g.V(function(J){if(J.S==1)return Z=S.player.getVideoData(),k=Z.BC,g.dX(x,2)||g.dX(x,512)?g.B(J,Sc(),2):J.return();if(J.S!=3){e=J.Y;if(!e)return ec("PES is undefined"),J.return();u=Z.videoId;return g.B(J,$i(e,g.S5(u,"mainVideoEntity"),"mainVideoEntity"),3)}C=J.Y;if(!C)return J.return();L=Math.floor(k).toString();c={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:L}};return g.B(J,S.AT([u],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
c),0)})};
g.z.isOrchestrationLeader=function(){return this.S.isOrchestrationLeader()};
g.z.updateDownloadState=function(x,S){var Z,k,e,u;return g.V(function(C){if(C.S==1)return g.B(C,Sc(),2);Z=C.Y;if(!Z)return ec("PES is undefined"),C.return();k=g.xl(x);e=k.entityType;u=k.entityId;return g.B(C,qP(u,e,Z,S,!0),0)})};g.IR("offline",q0S);})(_yt_player);
